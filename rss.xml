<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Coding with Thomas Blog RSS Feed]]></title><description><![CDATA[Coding with Thomas Blog RSS Feed]]></description><link>https://blog.thomasjungblut.com</link><generator>GatsbyJS</generator><lastBuildDate>Fri, 05 Jan 2024 18:43:15 GMT</lastBuildDate><item><title><![CDATA[Fixing Braava M6 stuck wheels and grip issues]]></title><description><![CDATA[Since the last time I tried to fix the Braava M6 to come out of its base station on its own again, I had a couple more encounters with Error…]]></description><link>https://blog.thomasjungblut.com/random/fixing-braava-m6-wheel-mod/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/random/fixing-braava-m6-wheel-mod/</guid><pubDate>Thu, 30 Jun 2022 20:04:20 GMT</pubDate><content:encoded>&lt;p&gt;Since the last time I tried to fix the &lt;a href=&quot;https://blog.thomasjungblut.com/random/fixing-braava-m6/&quot;&gt;Braava M6 to come out of its base station on its own again&lt;/a&gt;, I had a couple more encounters with Error 7 and 10.&lt;/p&gt;
&lt;p&gt;These error codes are officially described as “Wheel problem. See the app for help”, one error for each of the wheels respectively. The official documentation will tell you to clean the wheels.
For Roomba-experienced users, you’ll find yourself screwing the wheels off and cleaning any debris and hair from the wheel bases. And for the most part it does work for a normal Roomba.&lt;/p&gt;
&lt;p&gt;Now even with wheel and base cleaned, my Braava continued to refuse its service with either of those errors, what to do? Similar to the issue in my previous blog post, this was caused by general issues of grip on the wheels.
I found the rubber tyres to be in terrible shape after straight two years of usage and having virtually no grip on the floor anymore:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fbf50f07679ffa858a0617a7193048c0/2ed0a/20220628_201952.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 74.0506329113924%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAUIAQb/xAAVAQEBAAAAAAAAAAAAAAAAAAADAv/aAAwDAQACEAMQAAABn/EvfDTMt4Bf/8QAHRAAAQQCAwAAAAAAAAAAAAAABQEDBAYAAgcSE//aAAgBAQABBQKPv5CQk4tMPOjk7uCLVEyqs8j3Ug5RlRf/xAAeEQACAgAHAAAAAAAAAAAAAAABEQASAhMhMWGh0f/aAAgBAwEBPwGhOIq7YqiEBpv7Ms89T//EAB0RAAICAQUAAAAAAAAAAAAAAAERABICEyEyUXH/2gAIAQIBAT8BBFd6INvkfJqY9if/xAAkEAACAgEEAgEFAAAAAAAAAAABAgMEEQAFEhMUIQYVMlFhcf/aAAgBAQAGPwKe6gM7Q2hV6+lrTRcouSSLVRlE0sznhW7mWtyRjYZV1R2u/tNjquuRyl2+jC8EGcyzw3NtAEQqjLNHbWSAwIUDrMwbTYYEZOGwcMM+mH6I9jSbt8XvCrZClZYS8fRcrk56rMNgPXlCuOSLKjAHOCpOdfS9wt1qVJW57h4ce3Uu2DkDLG3hDulE2MMnYIyPvRh60AvVhVA9n8fzX//EABsQAQADAAMBAAAAAAAAAAAAAAEAESExQVGx/9oACAEBAAE/IVZKYcnUJYn6wQUMi9VqlMTupl5PiMKyO0k7HyDNfggWWY3Mk4qAor4Jtmi+7KuoQJ82a7UHh84n/9oADAMBAAIAAwAAABDH7//EABsRAQEAAgMBAAAAAAAAAAAAAAERIWEAMVHw/9oACAEDAQE/EFhR0ENkwZvbRj2R1fRrRz//xAAbEQEBAAIDAQAAAAAAAAAAAAABEUFhITFR8P/aAAgBAgEBPxDBHQ2nCRFJQhnxqJMl1h1vf3M//8QAGBABAQEBAQAAAAAAAAAAAAAAAREAITH/2gAIAQEAAT8QfPDBUh3aEdppcvuB8XQtBVPJCobXM5HopwOD68Sww3aVvwcgCMSpUUdHOwtZyKpYHKAQIHgg/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;dirty rubber tyre&quot;
        title=&quot;&quot;
        src=&quot;/static/fbf50f07679ffa858a0617a7193048c0/828fb/20220628_201952.jpg&quot;
        srcset=&quot;/static/fbf50f07679ffa858a0617a7193048c0/ff44c/20220628_201952.jpg 158w,
/static/fbf50f07679ffa858a0617a7193048c0/a6688/20220628_201952.jpg 315w,
/static/fbf50f07679ffa858a0617a7193048c0/828fb/20220628_201952.jpg 630w,
/static/fbf50f07679ffa858a0617a7193048c0/0ede0/20220628_201952.jpg 945w,
/static/fbf50f07679ffa858a0617a7193048c0/3ac88/20220628_201952.jpg 1260w,
/static/fbf50f07679ffa858a0617a7193048c0/2ed0a/20220628_201952.jpg 2079w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;You can test this yourself by trying to push the wheel over your floor, if it just slides over it your tyres are done.
As you can also see there is lot of gross debris stuck on the inside and the color got much brighter. Check their elasticity too, mine were very solid and brittle.&lt;/p&gt;
&lt;p&gt;How can we fix this? Let’s take some inspiration from cars or bikes, what can you do to increase your grip on a tyre again? Obviously you could buy a new one: I contacted the iRobot support and they send them via mail in a couple of days. However, since mine are kinda done and the new ones are on the way, I’ve done a little experiment and tried to cutout a tyre tread pattern you would normally see in RC cars.&lt;/p&gt;
&lt;p&gt;You can see on the picture above that there is already a little bit of tread, the individual pattern is very close together. This tread pattern didn’t seem very efficient to me, after all the higher grip tyres you see on cars usually have larger holes on the tread to increase the surface and absorb water or other stuff on the road. Let’s try this out here too:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c600a5ecca2f7e4c57d5d2671e81a31e/bf439/20220628_201940.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 64.55696202531645%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAUIA//EABUBAQEAAAAAAAAAAAAAAAAAAAMB/9oADAMBAAIQAxAAAAGWlr9AVxKIDX//xAAbEAACAgMBAAAAAAAAAAAAAAACBAEFAAMGFP/aAAgBAQABBQLRu9eID1B2OxGRNjkVbtHlKW0vGirwif/EAB4RAAAFBQEAAAAAAAAAAAAAAAABESFBEiIxYYHw/9oACAEDAQE/AaVNsw6FEC7XuD//xAAcEQABBAMBAAAAAAAAAAAAAAABABGB8BIxYZH/2gAIAQIBAT8BYNsSC8ULK+dX/8QAJhAAAgIABQMEAwAAAAAAAAAAAQIDBAAFERIhExQxBiJBgSMyUf/aAAgBAQAGPwK1GkSz5nHSMmX1WAlktSLoZFghkKpPZji98MB3K59zI4UjFSlm1CSXLbTstgv28kdGJd5mmNiGpUfL5IASySlzVcxJDKCPLiF+pHubY7DQsupAJGz5AB+8b+6mp2qy9WC1CNXR4uVP7IeP6GUj4IOJq2a+ps1uU8v/ACGrLJM0djpHVUffacBdQCdyyHjgjzjQNwPAK66fZbH/xAAbEAEBAQADAQEAAAAAAAAAAAABEQAhMUFR8f/aAAgBAQABPyGVyidNany0HDwYt1pWWVgkhMIh0gp1MMz5iFCEAxMHyDtoQdHW0VrwiMEACDEMdhCVeOTP33f/2gAMAwEAAgADAAAAELTP/8QAGhEBAAIDAQAAAAAAAAAAAAAAAREhADFRgf/aAAgBAwEBPxCdBlsAAtKVd22vHAiWvc//xAAcEQEBAAICAwAAAAAAAAAAAAABEQAhMVFBYfH/2gAIAQIBAT8QgrAd0JQAR7iVArXVxhjaTv6a8d64M//EABkQAQEAAwEAAAAAAAAAAAAAAAERACExQf/aAAgBAQABPxAs3LxNpGioD0qCBcnZLYOA48uRomYhgdJDscIRRqkE8KRSGBOclmkXcuRiYKExJ6waQvvVVtZ//9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;braava wheel with a tread pattern&quot;
        title=&quot;&quot;
        src=&quot;/static/c600a5ecca2f7e4c57d5d2671e81a31e/828fb/20220628_201940.jpg&quot;
        srcset=&quot;/static/c600a5ecca2f7e4c57d5d2671e81a31e/ff44c/20220628_201940.jpg 158w,
/static/c600a5ecca2f7e4c57d5d2671e81a31e/a6688/20220628_201940.jpg 315w,
/static/c600a5ecca2f7e4c57d5d2671e81a31e/828fb/20220628_201940.jpg 630w,
/static/c600a5ecca2f7e4c57d5d2671e81a31e/0ede0/20220628_201940.jpg 945w,
/static/c600a5ecca2f7e4c57d5d2671e81a31e/3ac88/20220628_201940.jpg 1260w,
/static/c600a5ecca2f7e4c57d5d2671e81a31e/bf439/20220628_201940.jpg 2691w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;It cost me two hours to cut the little rubber “pins” out of the wheel in an alternating pattern, you can take a Electronics Diagonal Cutter or any other plier that might cut through those little holes. Afterwards I took a Dremel to smoothen the edges off a bit and also roughen up the tread surface a little.&lt;/p&gt;
&lt;p&gt;And it worked like a charm, it leaves the home base like never before and has no issues in moving around the house.&lt;/p&gt;
&lt;p&gt;Hope it helps!&lt;/p&gt;
&lt;p&gt;Cheers,&lt;br&gt;
Thomas&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Running a Nvidia Tesla K80 at home]]></title><description><![CDATA[I was busy over the last couple months by not only rebuilding my gaming PC, but salvaging the old one into a new desktop server setup.
What…]]></description><link>https://blog.thomasjungblut.com/random/running-tesla-k80/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/random/running-tesla-k80/</guid><pubDate>Wed, 26 May 2021 17:49:33 GMT</pubDate><content:encoded>&lt;p&gt;I was busy over the last couple months by not only rebuilding my gaming PC, but salvaging the old one into a new desktop server setup.
What’s usually missing in a great home server? Obviously a great GPGPU to do that sweet machine learning and crypto mining.
I’m writing about some of the challenges I faced to get it running in a desktop case and how to overcome them.&lt;/p&gt;
&lt;h2 id=&quot;table-of-contents&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#table-of-contents&quot; aria-label=&quot;table of contents permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Table of Contents&lt;/h2&gt;
&lt;div class=&quot;table-of-contents&quot;&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#whats-a-nvidia-tesla-k80&quot;&gt;What’s a Nvidia Tesla K80?&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#how-to-run-it&quot;&gt;How to run it?&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;#power-supply&quot;&gt;Power supply&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#bios-tweaks&quot;&gt;BIOS Tweaks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#cooling-it&quot;&gt;Cooling it&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#can-it-mine-crypto&quot;&gt;Can it mine Crypto?&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#hows-the-machine-learning-performance&quot;&gt;How’s the Machine Learning performance?&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#undervolting&quot;&gt;Undervolting&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#temperatures&quot;&gt;Temperatures&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#closing-thoughts&quot;&gt;Closing Thoughts&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;h2 id=&quot;whats-a-nvidia-tesla-k80&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#whats-a-nvidia-tesla-k80&quot; aria-label=&quot;whats a nvidia tesla k80 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What’s a Nvidia Tesla K80?&lt;/h2&gt;
&lt;p&gt;The Tesla K80 is a server compute card (GPGPU) from Nov’2014. It’s usually used in datacenters and server setups, most prominently featured in AWS where they are part of the p2 instance offering.&lt;/p&gt;
&lt;p&gt;Why is it great? It actually has two GPUs (2× GK210) in a single card, each with a massive 12GB of VRAM - yes that’s a whopping 24GB in total!&lt;/p&gt;
&lt;p&gt;What’s even better? It’s really cheap, you can get a &lt;a href=&quot;https://www.ebay.de/itm/164862718429&quot;&gt;refurbished card for about 280€&lt;/a&gt;. That’s really really cheap, for a card that used to cost several thousands just a couple years back. So I actually bought one, originally to do a bit of machine learning.&lt;/p&gt;
&lt;h2 id=&quot;how-to-run-it&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#how-to-run-it&quot; aria-label=&quot;how to run it permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;How to run it?&lt;/h2&gt;
&lt;p&gt;Given it’s a server card, it comes in that state:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://tpucdn.com/gpu-specs/images/c/2616-front.jpg&quot; alt=&quot;k80 picture&quot;&gt;&lt;/p&gt;
&lt;p&gt;The GPU experts among us will spot it: the fans are missing. This card is supposed to be cooled externally, basically via the airflow in a server rack like this and thus has no fan installed:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.broadberry.co.uk/system_files/images/system_images/cut/1028GQ-TR-angle.jpg&quot; alt=&quot;server rack&quot;&gt;&lt;/p&gt;
&lt;p&gt;You can see the little and powerful fans in two rows at the bottom. Now obviously I don’t really want to retrofit my old gaming desktop into a server rack due to the acoustics of such a rack setup, so can we make the Tesla K80 run in a plain desktop?&lt;/p&gt;
&lt;h3 id=&quot;power-supply&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#power-supply&quot; aria-label=&quot;power supply permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Power supply&lt;/h3&gt;
&lt;p&gt;The first challenge is to actually power the card with plain PCIe PSU cables. It’s actually not possible, they won’t fit even though you would think they do. In consumer gaming cards from Nvidia it’s actually common to plug two 6-pin or 8-pin plugs into your card.&lt;/p&gt;
&lt;p&gt;Back in 2014 Nvidia used, for the first time, a &lt;a href=&quot;https://www.nvidia.com/content/dam/en-zz/Solutions/Data-Center/tesla-product-literature/Tesla-K80-BoardSpec-07317-001-v05.pdf&quot;&gt;8-pin CPU power connector instead of a 8-pin PCIe connector.&lt;/a&gt; If your PSU has support for two CPU connectors, then you’re good to go. My old consumer PSU from 2014 certainly didn’t and I had to get a breakout cable that joins two 8-pin PCIe connectors into an 8-pin CPU connector.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f69a3529f4288bce4d87aa52ce7608d3/d2602/k80_power.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAPABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAYDBQcJ/8QAFQEBAQAAAAAAAAAAAAAAAAAABQb/2gAMAwEAAhADEAAAAWnm7RZYO4ikAzO//8QAGhAAAgMBAQAAAAAAAAAAAAAAAgUDBAYSE//aAAgBAQABBQLUbnNpj3LVC+Xe4cwCmrA4mDmJQwsj/8QAIhEAAwABAgYDAAAAAAAAAAAAAQIDEQRSAAYTIkNhcZHw/9oACAEDAQE/AdXzHbWwfStCAj0mCiiC1VcuuHnWgzNlU+PGSWO0L27gPWfj3+++P//EACIRAAIBAgUFAAAAAAAAAAAAAAECAxESAAQTITEFIkHh8P/aAAgBAgEBPwGHpa5V4Hhke7VGo3CmMROSCq07WYKNyfG3N1D8PWP/xAAiEAACAgICAgMBAQAAAAAAAAABAgMRBBIFIQATFCIxM0L/2gAIAQEABj8CXFHKN8s1JLJxHxc6TEX2IimWOa8ebZn2OMjiR41c7pQufNkwHi5uLLbHxuVxMVONh5OEMzRS5+Ahlx9p8YO20RTJxZUVXky4GBEf9nOgur6Nn63XdCu/Bm5c3rzjIZY4xBNKgZ7uEAD1BIw9hrtmA/yKZmO5hczMXWvo8z9AQtqpBvVm+rqqDUm68Lww7qDrfsiTsAH8aYH8I78//8QAGhABAQADAQEAAAAAAAAAAAAAAREAITFBgf/aAAgBAQABPyHegEalKWFXgRMOPBsHMA8wyeh8QFzlwIVCHd+ZIFsRlCosJpcctVc9nSGin5AUwrr7UignEj8z/9oADAMBAAIAAwAAABD4P//EABwRAAEEAwEAAAAAAAAAAAAAAAEAESFRMUFxwf/aAAgBAwEBPxCLeXOfCeGZOBBRzvbQ1OZ9T//EABsRAQACAgMAAAAAAAAAAAAAAAERMQAhQXHw/9oACAECAQE/EFYU5CyeOD4FK1GDRVF2qHtPoc//xAAZEAEBAQADAAAAAAAAAAAAAAABEQAQIUH/2gAIAQEAAT8Qmz/Ahixqq8OHIRGfZSOOPdXKgtjm0DEAiMRHT5Gp7dOmcCHcQoDHzg0dSUN1zlG0q2UQqQVW/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;k80 power cable&quot;
        title=&quot;&quot;
        src=&quot;/static/f69a3529f4288bce4d87aa52ce7608d3/828fb/k80_power.jpg&quot;
        srcset=&quot;/static/f69a3529f4288bce4d87aa52ce7608d3/ff44c/k80_power.jpg 158w,
/static/f69a3529f4288bce4d87aa52ce7608d3/a6688/k80_power.jpg 315w,
/static/f69a3529f4288bce4d87aa52ce7608d3/828fb/k80_power.jpg 630w,
/static/f69a3529f4288bce4d87aa52ce7608d3/0ede0/k80_power.jpg 945w,
/static/f69a3529f4288bce4d87aa52ce7608d3/3ac88/k80_power.jpg 1260w,
/static/f69a3529f4288bce4d87aa52ce7608d3/d2602/k80_power.jpg 4032w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Apparently they were part of the original package, the refurbished card I got didn’t come with it - yet you can still buy them &lt;a href=&quot;https://www.ebay.de/itm/193564253502&quot;&gt;“NVIDIA dual 8 to 8 Graphics Card Power Cable Tesla K80 M40 Grid M60 P40 P100 GPU”&lt;/a&gt; for example. It’s also important to plug the two PCIe PSU cables into different power rails, keep in mind that each GPU will draw up to 150W - so 300W in total.&lt;/p&gt;
&lt;h3 id=&quot;bios-tweaks&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#bios-tweaks&quot; aria-label=&quot;bios tweaks permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;BIOS Tweaks&lt;/h3&gt;
&lt;p&gt;Once powered, you most likely will run into compatibility issues with the BIOS. My X99 board complained about the PCIe power on the x16 lane (“System is running with Insufficient PCI Resources! PCI devices were set to disabled state! It is strongly recommended to Power Off the system and remove some PCI/PCI Express cards from the system!”), but turned out that this wasn’t quite the issue.&lt;/p&gt;
&lt;p&gt;I had to enable the following two settings:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/65dca65a17164e075f378234e09ddf70/72e01/k80_bios.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAPABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAcDBQYJ/8QAFAEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB5E4+RWi4C5E//8QAHBAAAgICAwAAAAAAAAAAAAAAAgMBBAAFBhET/9oACAEBAAEFAt9TtCyXJHL+h8H8ifYgFsLu46Qb/8QAGhEBAAEFAAAAAAAAAAAAAAAAEcEBECExUf/aAAgBAwEBPwHBqr1gm3//xAAZEQACAwEAAAAAAAAAAAAAAAARIRAxUcH/2gAIAQIBAT8BZtYOmP/EACUQAAIBAwMEAgMAAAAAAAAAAAECAwQREgATIQUiMUEjsRRCUf/aAAgBAQAGPwKkyLRlhDDWJKZ1NTU0AAmr0/OpoVVKrL46WO8KFeSwvokvLth9uPbXpsbKxky7ttQ8jqLkHE4MFCWW41gvVt8Yht0wSoWvf9WTLjxz9W1Q5TyOcZSA7NLisixe5S/c1ubW8aVL9pdCRYf0e/OsWEpOC8/GfNz7kv8AWv/EABoQAQEAAgMAAAAAAAAAAAAAAAERITEAQVH/2gAIAQEAAT8hTst+BFzUIP1yK5UBNhYlZaEgqoU1WaoBQ0aynAE3NXIRjsKGkvC+4wFPJ41Y9nCIWjgtBE4BDJkOO3//2gAMAwEAAgADAAAAEAPP/8QAGBEBAQADAAAAAAAAAAAAAAAAAREQQZH/2gAIAQMBAT8QGwppEDpcP//EABkRAQACAwAAAAAAAAAAAAAAAAEhcRBBYf/aAAgBAgEBPxBJgENj2ysf/8QAGRABAQADAQAAAAAAAAAAAAAAAREAIUEx/9oACAEBAAE/EJVx+15aZWTo5eQQtx7muqP517W3cKaRSBXJg8yJJ8FxXvkK2IU5JKpzkAg9hXBNZeAXeZbFBMw//9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;x99 bios setting&quot;
        title=&quot;&quot;
        src=&quot;/static/65dca65a17164e075f378234e09ddf70/828fb/k80_bios.jpg&quot;
        srcset=&quot;/static/65dca65a17164e075f378234e09ddf70/ff44c/k80_bios.jpg 158w,
/static/65dca65a17164e075f378234e09ddf70/a6688/k80_bios.jpg 315w,
/static/65dca65a17164e075f378234e09ddf70/828fb/k80_bios.jpg 630w,
/static/65dca65a17164e075f378234e09ddf70/0ede0/k80_bios.jpg 945w,
/static/65dca65a17164e075f378234e09ddf70/72e01/k80_bios.jpg 1024w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Namely the 4G decoding to support the 24GB of VRAM and the PCIe generation setting to Gen2. Then it would boot flawlessly into your favorite Linux distribution and would let you install the Nvidia drivers along with CUDA. On the CUDA note: the current driver generation (462.31) and CUDA release 11.2 will be the last to actually support the K80.&lt;/p&gt;
&lt;h3 id=&quot;cooling-it&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#cooling-it&quot; aria-label=&quot;cooling it permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Cooling it&lt;/h3&gt;
&lt;p&gt;After booting it and installing the drivers, most likely it would already run into enough heating issue to turn itself off.&lt;/p&gt;
&lt;p&gt;First off, checkout the following video, I was mostly following the ideas in there - basically a fan + tons of aluminium tape:&lt;/p&gt;
&lt;p&gt;&lt;div class=&quot;gatsby-resp-iframe-wrapper&quot; style=&quot;padding-bottom: 56.49999999999999%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem&quot; &gt; &lt;div class=&quot;embedVideo-container&quot;&gt; &lt;iframe title=&quot;&quot; src=&quot;https://www.youtube.com/embed/I2zYOdfASFE?rel=0&quot; class=&quot;embedVideo-iframe&quot; style=&quot;border:0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; &quot; loading=&quot;lazy&quot; allowfullscreen=&quot;&quot; sandbox=&quot;allow-same-origin allow-scripts allow-popups&quot;&gt;&lt;/iframe&gt; &lt;/div&gt; &lt;/div&gt;&lt;/p&gt;
&lt;p&gt;Instead of the custom fan control and the industrial fan I used two Noctua NF-A9 92mm fans and a custom shroud that you can mount on the right side of the card:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/917678fc796ca4a97522c7d8363cf9bb/d2602/k80_fans.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAgEBwn/xAAWAQEBAQAAAAAAAAAAAAAAAAACBAX/2gAMAwEAAhADEAAAAUja3O+7iHlI5nUf/8QAGRAAAwEBAQAAAAAAAAAAAAAAAwQFAQcS/9oACAEBAAEFAkpE1aXnPEo0RTn/AD0wQ6/g508HqVflQVf/xAAgEQACAQMEAwAAAAAAAAAAAAABAgMREiEABBMxFCMy/9oACAEDAQE/AUWLji49ns1kicPeULNMcU5qm0oDkBQDUfWvGDZc7UOctbE1tT3T3da//8QAIBEAAgIABgMAAAAAAAAAAAAAAQIDEQQSEyEiMQAUUf/aAAgBAgEBPwFpcrPnnxBSVSpAYKsdmxpVuHriS12D18OLcEiL3NIHhcwvLtV1DXXn/8QAJBAAAgICAQMEAwAAAAAAAAAAAgMBBAUSEQATIQYUIiQxMkH/2gAIAQEABj8C9O2r2Kzl2zlqFnIPthfiMazXIPq16VRCAS5crUmGXnOsyyCYPbWsfM4/JVzw129dv1rFvHZFjDsVK9tRgjEUX1LVtLmxZIPtXqRMsxE6koQOShvq2XpzbJI3ow+WsDTSqZ+uvSK0yDITrsJTMxEjx8NOoW27ZZUCJ4r+5fCk+fyoFsXqPEzuoNYPz/eOqfyMYdbrAwEkxa3l5iGODee6xae4CTdJmsSkRmImY69lXWlAkZPOIqyUsYcCEsMoVPJcLEOef1Aev//EABgQAQEBAQEAAAAAAAAAAAAAAAERADEh/9oACAEBAAE/IUJID2CNMguHb7e4L5xKBU4kc6srTK2r3QMBF7HG+w+PoDTde6rlJLMNMsdIIuyxVMvcVBwN/9oADAMBAAIAAwAAABCv/wD/xAAYEQEBAQEBAAAAAAAAAAAAAAABESEAcf/aAAgBAwEBPxAAREEVAgwjvR3jVhiYMILYGy7Dyf/EABkRAQEBAQEBAAAAAAAAAAAAAAERITEAQf/aAAgBAgEBPxAIER4hoSDCcdDw2RAZBepr6inddv8A/8QAGBABAQEBAQAAAAAAAAAAAAAAAREAEDH/2gAIAQEAAT8QI+y+H4YedOMmHSIheKOhPvJgmBs6noxs0BbsO8rRUPYd4cHSLQSaYGXFAMEjQOi+vAWp/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;k80 fans&quot;
        title=&quot;&quot;
        src=&quot;/static/917678fc796ca4a97522c7d8363cf9bb/828fb/k80_fans.jpg&quot;
        srcset=&quot;/static/917678fc796ca4a97522c7d8363cf9bb/ff44c/k80_fans.jpg 158w,
/static/917678fc796ca4a97522c7d8363cf9bb/a6688/k80_fans.jpg 315w,
/static/917678fc796ca4a97522c7d8363cf9bb/828fb/k80_fans.jpg 630w,
/static/917678fc796ca4a97522c7d8363cf9bb/0ede0/k80_fans.jpg 945w,
/static/917678fc796ca4a97522c7d8363cf9bb/3ac88/k80_fans.jpg 1260w,
/static/917678fc796ca4a97522c7d8363cf9bb/d2602/k80_fans.jpg 4032w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The custom shroud and the Noctua NF-A6 60mm can be seen here in the already assembled state:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/85b6226d59c95cfe43a76a598dbdc7f0/d2602/k80_shroud_front.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAPABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAkFBgcI/8QAFQEBAQAAAAAAAAAAAAAAAAAAAwT/2gAMAwEAAhADEAAAAUiNc4NtsjQZjBSH/8QAGRABAAMBAQAAAAAAAAAAAAAABQMEBgEC/9oACAEBAAEFAhKHVkVu6ZUdCvk0kKhIakkpzuSgs+ZJrH//xAAdEQEAAgICAwAAAAAAAAAAAAABAhEDIRITAEFC/9oACAEDAQE/AYOHryxlF7WnHk5NFJceNfQu/TWzY+f/xAAeEQACAwABBQAAAAAAAAAAAAABAgMREgATIlGx0f/aAAgBAgEBPwGTrmaB42BiDVNHkWVIPftmWgjYJChiRYyb0ljz6+c//8QAJhAAAgIBAwMDBQAAAAAAAAAAAgMBBBEFExQABhIhIkEVIzJRcf/aAAgBAQAGPwJGncmrSXZLDbt93Ho0kjEk21adMFtpWHlmYEiIpFYCRnETT7Kp/TNV0un2qnVq5cp1ie4Ch5VxmnsOsNjTZVFZ0VpMwVwXZZVCTTFy1b71tLfLRQc29NuXLD+IhVTkG9cQshbsZSIQIrRtrxHj1sHDdMvHGFvqeRJI/wBlWn2Z+fQlf3qvfRbaewywmrqGmNWiIXa/Ks+lc+3CrBGzmKitYS4fSZmWMPpxlVr+cn79siUuCxGYWsZwA/PjHpmZ8cRiI//EABgQAQEBAQEAAAAAAAAAAAAAAAERIQAx/9oACAEBAAE/IVO4DweNHrgJQxRibzQXxjhcjuMDMFs4FIhdcuVLWUeJsxvXc4RlYXoqPS3/AMShmBW+S2uGZXI//9oADAMBAAIAAwAAABDgH//EABoRAQADAAMAAAAAAAAAAAAAAAEAESFxgbH/2gAIAQMBAT8QDUiQm1S9FulDpIULdXlb719n/8QAGREBAQEAAwAAAAAAAAAAAAAAARExACFh/9oACAECAQE/ELUETfYLQIIXXOAAEkDrBmXGTy+8/8QAGBABAQEBAQAAAAAAAAAAAAAAAREAQVH/2gAIAQEAAT8QxJsY6zAwX72NOAk6JU332tJc+LErMw0z0YlXfWAk7pP8MHPFLk2C2yoRP6IVDiuYguB2/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;k80 fans&quot;
        title=&quot;&quot;
        src=&quot;/static/85b6226d59c95cfe43a76a598dbdc7f0/828fb/k80_shroud_front.jpg&quot;
        srcset=&quot;/static/85b6226d59c95cfe43a76a598dbdc7f0/ff44c/k80_shroud_front.jpg 158w,
/static/85b6226d59c95cfe43a76a598dbdc7f0/a6688/k80_shroud_front.jpg 315w,
/static/85b6226d59c95cfe43a76a598dbdc7f0/828fb/k80_shroud_front.jpg 630w,
/static/85b6226d59c95cfe43a76a598dbdc7f0/0ede0/k80_shroud_front.jpg 945w,
/static/85b6226d59c95cfe43a76a598dbdc7f0/3ac88/k80_shroud_front.jpg 1260w,
/static/85b6226d59c95cfe43a76a598dbdc7f0/d2602/k80_shroud_front.jpg 4032w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7e1f95871a6c20fa25283283729f4e60/d2602/k80_shroud_back.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAcJCP/EABUBAQEAAAAAAAAAAAAAAAAAAAMC/9oADAMBAAIQAxAAAAGTdGZU60C0KLAQ/wD/xAAcEAACAgIDAAAAAAAAAAAAAAAEBQIDBgcBERP/2gAIAQEAAQUCAb+DTAtmzOi/J6ajsKaVMNy2wxe4zkm7/8QAHxEAAAYDAAMAAAAAAAAAAAAAAQIDESFBABIiMlFx/9oACAEDAQE/AUkyTusVONvE5nZ+eQFjVPt8mgihao+5/8QAHxEAAgICAQUAAAAAAAAAAAAAARECIQADEgQiMkFx/9oACAECAQE/AduzYFw6ee0iRhUtcF4nn3kMfLdLBGStgmyKKJsh01foZ//EACQQAAICAgEDBAMAAAAAAAAAAAIDAQQFEhEABiETFCMxIlFi/9oACAEBAAY/AsPkwnZtYqTSj+l8QUc8T9+f31juxK6M9Rib15IdwY0nNauW2GW6FFdEVStxEw3JI/cAxokKlqLx1cAfEqtXkkNmolTwJWQtr0alyzNDIER9RG3xHsH3EzL68pWVojJamEvmQE+J2g+fxkI2148xPHVDt4sRbh+KUs6d2tmjxyPeLXMJedTG06+q1tkW6IYl5aemVn5GkTbFoidYew3NaclJGxpSbDmeZmZM5IpkpkpKZkpmZ6//xAAaEAEBAQADAQAAAAAAAAAAAAABESEAMVFB/9oACAEBAAE/IVqQjBXufLFwpnp3tRfWLD160CtPonEht4h9OcphaZtoGJYtROzPNqtCMwRkuOdQJukakFudVL//2gAMAwEAAgADAAAAECQ//8QAFxEBAQEBAAAAAAAAAAAAAAAAAREhMf/aAAgBAwEBPxCoDpFW4gXMuMAaEL1KCCIogY4psVmmxv8A/8QAFxEBAQEBAAAAAAAAAAAAAAAAAREhMf/aAAgBAgEBPxAJuNBC0Qc8lLDQWJDxhQgAmCQOkGGz/8QAGBABAQEBAQAAAAAAAAAAAAAAAQARITH/2gAIAQEAAT8QemW5rsQeBhxYJBQDMy/w9CI4wBQ6zh15jHcAOdQy/umzUh8Q4KoqsnV4BLl1MHrEEYslyb//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;k80 fans&quot;
        title=&quot;&quot;
        src=&quot;/static/7e1f95871a6c20fa25283283729f4e60/828fb/k80_shroud_back.jpg&quot;
        srcset=&quot;/static/7e1f95871a6c20fa25283283729f4e60/ff44c/k80_shroud_back.jpg 158w,
/static/7e1f95871a6c20fa25283283729f4e60/a6688/k80_shroud_back.jpg 315w,
/static/7e1f95871a6c20fa25283283729f4e60/828fb/k80_shroud_back.jpg 630w,
/static/7e1f95871a6c20fa25283283729f4e60/0ede0/k80_shroud_back.jpg 945w,
/static/7e1f95871a6c20fa25283283729f4e60/3ac88/k80_shroud_back.jpg 1260w,
/static/7e1f95871a6c20fa25283283729f4e60/d2602/k80_shroud_back.jpg 4032w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;All fans blow, so the airflow comes from the front all the way into the back. I plugged all three fans into a single PWM using the merger cables coming with every Noctua fan and keep them running at 100%. They are extremely quiet, so I don’t actually bother that much about getting the temperature control working.&lt;/p&gt;
&lt;p&gt;You can find the shroud still on &lt;a href=&quot;https://www.ebay.com/itm/124287700989&quot;&gt;Ebay&lt;/a&gt;. If you have a 3D printer at home it is actually simple to print yourself and I would certainly recommend doing this instead of paying the outrageous price plus shipping across the pond for that.&lt;/p&gt;
&lt;p&gt;Alternatively checkout the stuff at &lt;a href=&quot;https://gpumods.com/&quot;&gt;gpumods.com&lt;/a&gt;, which is having all that stuff already pre-manufactured and ready to buy so you just have to screw the fans in.&lt;/p&gt;
&lt;h2 id=&quot;can-it-mine-crypto&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#can-it-mine-crypto&quot; aria-label=&quot;can it mine crypto permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Can it mine Crypto?&lt;/h2&gt;
&lt;p&gt;Short answer: not anymore and certainly not profitably.&lt;/p&gt;
&lt;p&gt;I did &lt;a href=&quot;https://github.com/ethereum-mining/ethminer/issues/472#issuecomment-833780809&quot;&gt;benchmarks&lt;/a&gt; with mining Ether, but at the time of writing and a 4.2GB DAG size and 4.29Gh difficulty it has a mere 4Mh/s. In comparison my 2080TI makes 50Mh/s, which generates roughly $6 per day at the current ETH price of $2k - not including the energy cost here!&lt;/p&gt;
&lt;p&gt;Other coins that are supposed to work well with GPUs are similar in performance, so it’s not really a viable mining card (anymore).&lt;/p&gt;
&lt;h2 id=&quot;hows-the-machine-learning-performance&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#hows-the-machine-learning-performance&quot; aria-label=&quot;hows the machine learning performance permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;How’s the Machine Learning performance?&lt;/h2&gt;
&lt;p&gt;Since I bought it originally for machine learning, it’s not any different than the K80s you get in the cloud.
I’m using the &lt;a href=&quot;https://github.com/pytorch/examples/tree/master/imagenet&quot;&gt;PyTorch ImageNet example&lt;/a&gt; and train it with &lt;a href=&quot;https://www.kaggle.com/c/imagenet-object-localization-challenge/data?select=imagenet_object_localization_patched2019.tar.gz&quot;&gt;ImageNet subset data from Kaggle&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Effectively it’s a single node and multi GPU training, so running this using &lt;a href=&quot;https://developer.nvidia.com/nccl&quot;&gt;NCCL&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;python3 main.py -a resnet50 -b 220 --dist-url &apos;tcp://localhost:22222&apos; --dist-backend &apos;nccl&apos; --multiprocessing-distributed --world-size 1 --rank 0 ILSVRC/Data/CLS-LOC/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;I had to reduce the batch size from 256 to 220 to make it work with the amount of VRAM, but the batch time is around 2s when auto-boost kicks in - so that’s 100 images/s which is still absolutely &lt;a href=&quot;https://www.leadergpu.com/tensorflow_resnet50_benchmark&quot;&gt;competitive for training a resnet50 from scratch&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;undervolting&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#undervolting&quot; aria-label=&quot;undervolting permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Undervolting&lt;/h2&gt;
&lt;p&gt;You can reduce the voltage of the card to save energy and reduce temperature. You can easily achieve this via nvidia-smi:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ sudo nvidia-smi -i 0 -pl 125
Power limit for GPU 00000000:05:00.0 was set to 125.00 W from 149.00 W.
$ sudo nvidia-smi -i 1 -pl 125
Power limit for GPU 00000000:06:00.0 was set to 125.00 W from 149.00 W.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here we reduced by 24W (-16%), from the default of 149W on both GPUs, the card will adjust its clocking and perf modes accordingly so there will be a performance loss. You have to experiment what works better for you in terms of temperature/energy efficiency and performance. I’m running mine on about 135W the whole time.&lt;/p&gt;
&lt;h2 id=&quot;temperatures&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#temperatures&quot; aria-label=&quot;temperatures permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Temperatures&lt;/h2&gt;
&lt;p&gt;IDLE at 30W I can report 30°C on both GPUs, with the one towards the back of the case to be 5-10% higher in temperature.&lt;/p&gt;
&lt;p&gt;Mining crypto using ethminer can get up to 85°C, with the resnet50 training run above, I can get up to around 87°C in constant usage. I believe with industrial, or even just higher RPM fans, you can get it down to 60°C-70°C at the higher cost of acoustics.&lt;/p&gt;
&lt;p&gt;Using the undervolting to 125W I can cap the heat to about 63°C constantly. At 100W it seems to cap out at 53°C at 10x the performance loss and my default of 135W goes closer towards 75°C with minor 1-5% loss of performance (measured by the resnet50 training).&lt;/p&gt;
&lt;h2 id=&quot;closing-thoughts&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#closing-thoughts&quot; aria-label=&quot;closing thoughts permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Closing Thoughts&lt;/h2&gt;
&lt;p&gt;The Tesla K80 is still a great card and a total bargain if you can get your hands on a refurbished version. At ~350€ (including fans and shrouds and cables) you get plenty of VRAM and good machine learning performance.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Fixing Logitech G920 Blinking White Light]]></title><description><![CDATA[Hey there, Today is about a topic that I spent the better half of my Saturday on, in order to fix my beloved Logitech G920. What’s happening…]]></description><link>https://blog.thomasjungblut.com/random/fixing-g920-blinking/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/random/fixing-g920-blinking/</guid><pubDate>Sat, 13 Mar 2021 21:06:41 GMT</pubDate><content:encoded>&lt;p&gt;Hey there,&lt;/p&gt;
&lt;p&gt;Today is about a topic that I spent the better half of my Saturday on, in order to fix my beloved Logitech G920.&lt;/p&gt;
&lt;h2 id=&quot;whats-happening&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#whats-happening&quot; aria-label=&quot;whats happening permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What’s happening?&lt;/h2&gt;
&lt;p&gt;When you plug your G920 into your PC it will start calibrating: it goes 450° left, 450° right and then comes back into the middle.
Today for the first time, it stops half-way through and suddenly flashes its white LED fast.&lt;/p&gt;
&lt;p&gt;I tried to reinstall the drivers, plugin all cables in and out. Tried the same thing on my Xbox, the wheel can even be used as a controller.
It exhibits the same problem of calibration.&lt;/p&gt;
&lt;h2 id=&quot;what-can-be-the-issue&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#what-can-be-the-issue&quot; aria-label=&quot;what can be the issue permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What can be the issue?&lt;/h2&gt;
&lt;p&gt;In several forums you’ll find people with similar issues, the most common one seems to be the missing power plug. For that you need to know that it will flash the white LED the same way, but not very fast (once a second vs. every 200ms or so).&lt;/p&gt;
&lt;p&gt;If that doesn’t fix it, I have bad news for you: you most likely have to tear it down.&lt;/p&gt;
&lt;h2 id=&quot;how-to-tear-down&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#how-to-tear-down&quot; aria-label=&quot;how to tear down permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;How to tear down?&lt;/h2&gt;
&lt;p&gt;Screw the wheel off first, there are the six lug nuts in the middle - screw them off. There are several small screws on the back too, once it comes off try to take the cable off carefully.&lt;/p&gt;
&lt;p&gt;Next step is the wheel base mount, there you only have to unscrew the three long ones on the triangle. The others are for the paddles, which you don’t need to remove.&lt;/p&gt;
&lt;p&gt;Once you have the wheel base off as well, you can take the whole base and unscrew everything from the bottom. The case should open very easy after that, if not, you’ve probably missed a screw.&lt;/p&gt;
&lt;h2 id=&quot;what-happened&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#what-happened&quot; aria-label=&quot;what happened permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What happened?&lt;/h2&gt;
&lt;p&gt;Apparently the force feedback was too hard at one point and the plastic mount of the servos just cracked:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fa2e1ce67c9c5fa0a8f66e1c92e780f7/d2602/20210313_204906.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAUIAwr/xAAVAQEBAAAAAAAAAAAAAAAAAAADAf/aAAwDAQACEAMQAAABuPno2QNExUQD/wD/xAAbEAACAwADAAAAAAAAAAAAAAADBQIEBgESF//aAAgBAQABBQLW9/I76R0jpAnwSBGzdHbMV5o7WDxFjSpv/8QAIREAAgAFBAMAAAAAAAAAAAAAAQIAAxESMQQiQVFSYYH/2gAIAQMBAT8Bmo01l2kWLYBT3kH71xCaUlVNMjxEf//EACIRAAIBAgUFAAAAAAAAAAAAAAECEQADBBMiI2ExUYHR8P/aAAgBAgEBPwG05sK+4pW4+Y5iDMDT1iD7p8XDsOe54+8V/8QAJhAAAQMDBAEEAwAAAAAAAAAAAQIDBAUREgATIVEkBiIxMiMzQf/aAAgBAQAGPwIUmkJj1aej05EgRmafhLQ5KaiJY8fDcTgFpJQ5lilHJXbReqdPmU95R2WETGVx1HHDcWkOD3NhC+DcBThsnLFWrqaSSDiT8cgDrjTjbDj0Ujnw5r8X73IvsOAEH7Ed9HSpUiS/Ndb/ACeZNfkDFKbY3kvL+B1Y6fmuBrx6i/BR+oWS0zGdI/hVZx9YyVdR7ta3/8QAGRABAQEBAQEAAAAAAAAAAAAAAREhADFB/9oACAEBAAE/IcOqiGZc0BAJCvK0cqAkLhQ3ATFs19ltBQlV9DevfAwiomWYvpqME5bEUD8AQRR2gHTQr29fTMaMDzPP/9oADAMBAAIAAwAAABAAP//EABoRAQACAwEAAAAAAAAAAAAAAAERIQAxcWH/2gAIAQMBAT8QsIAFMWdBEsEJpuTEbNBnhb7qecz/xAAZEQEBAQADAAAAAAAAAAAAAAABESEAQdH/2gAIAQIBAT8QLp8hJkq7LWsuJo5DhB5id8f/xAAYEAEBAQEBAAAAAAAAAAAAAAABEQAhMf/aAAgBAQABPxA2yX3+dASB6AcP9VX2kM2KHV4FuirNpVAVe+5oShGZoqvZLbGe2YtpqQFrtVCVgAIOHk5PIQW9/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;broken plastic&quot;
        title=&quot;&quot;
        src=&quot;/static/fa2e1ce67c9c5fa0a8f66e1c92e780f7/828fb/20210313_204906.jpg&quot;
        srcset=&quot;/static/fa2e1ce67c9c5fa0a8f66e1c92e780f7/ff44c/20210313_204906.jpg 158w,
/static/fa2e1ce67c9c5fa0a8f66e1c92e780f7/a6688/20210313_204906.jpg 315w,
/static/fa2e1ce67c9c5fa0a8f66e1c92e780f7/828fb/20210313_204906.jpg 630w,
/static/fa2e1ce67c9c5fa0a8f66e1c92e780f7/0ede0/20210313_204906.jpg 945w,
/static/fa2e1ce67c9c5fa0a8f66e1c92e780f7/3ac88/20210313_204906.jpg 1260w,
/static/fa2e1ce67c9c5fa0a8f66e1c92e780f7/d2602/20210313_204906.jpg 4032w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;As you can see there is this unhinged screw, which ended up in the rail of the steering axle. That prevented the wheel from calibrating and thus made it fail.
I removed the screw, tried to duct tape the plastic together again and put everything together.&lt;/p&gt;
&lt;p&gt;Needless to say, the wheel no initializes properly again.&lt;/p&gt;
&lt;p&gt;Hope it helps!&lt;br&gt;
Thomas&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Fixing Black Screen with fan running at 100% using a Nvidia GPU]]></title><description><![CDATA[Hey there, Today is about a topic that I spent the better half of my Saturday on, in order to fix my rig. I wanted to write it down, not…]]></description><link>https://blog.thomasjungblut.com/random/fixing-black-screen-fan-100/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/random/fixing-black-screen-fan-100/</guid><pubDate>Mon, 23 Nov 2020 19:06:41 GMT</pubDate><content:encoded>&lt;p&gt;Hey there,&lt;/p&gt;
&lt;p&gt;Today is about a topic that I spent the better half of my Saturday on, in order to fix my rig. I wanted to write it down, not just for my future self but also for others - I’ve seen hundreds of similar report in the usual hardware forums.&lt;/p&gt;
&lt;h2 id=&quot;table-of-contents&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#table-of-contents&quot; aria-label=&quot;table of contents permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Table of Contents&lt;/h2&gt;
&lt;div class=&quot;table-of-contents&quot;&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#whats-happening&quot;&gt;What’s happening?&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#what-can-be-the-culprit&quot;&gt;What can be the culprit?&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#things-to-check-on&quot;&gt;Things to check on&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;#gpu-temperature&quot;&gt;GPU Temperature&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#gpu-voltage-and-clock&quot;&gt;GPU Voltage and Clock&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#psu&quot;&gt;PSU&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#swapping-cards&quot;&gt;Swapping cards&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#drivers&quot;&gt;Drivers&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#the-fix-for-me&quot;&gt;The fix for me&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;h2 id=&quot;whats-happening&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#whats-happening&quot; aria-label=&quot;whats happening permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What’s happening?&lt;/h2&gt;
&lt;p&gt;I was playing a game and suddenly out of nowhere:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Black Screen&lt;/li&gt;
&lt;li&gt;GPU fan gets pretty loud (100% Fan Speed)&lt;/li&gt;
&lt;li&gt;Game continues in the background, evident by control input being honored and continued sound output&lt;/li&gt;
&lt;li&gt;Screen turns off for lost signal after some time and does not come back&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;No way to bring it back alive, hard restart needed.&lt;/p&gt;
&lt;h2 id=&quot;what-can-be-the-culprit&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#what-can-be-the-culprit&quot; aria-label=&quot;what can be the culprit permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What can be the culprit?&lt;/h2&gt;
&lt;p&gt;There are plenty of things that can go wrong and in the worst case it is a combination of many. Below we will walk through a couple of these to rule them out as a potential source of issues.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Power supply unit (PSU)&lt;/li&gt;
&lt;li&gt;GPU&lt;/li&gt;
&lt;li&gt;Drivers&lt;/li&gt;
&lt;li&gt;Mainboard&lt;/li&gt;
&lt;li&gt;Cosmic Rays&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;things-to-check-on&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#things-to-check-on&quot; aria-label=&quot;things to check on permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Things to check on&lt;/h2&gt;
&lt;p&gt;Try to reproduce it reliably first, I used up a synthetic benchmark for that (3D Mark 4k TimeSpy) in stress mode and 20 loops. After 2-3 minutes of runtime it would turn off consistently.&lt;/p&gt;
&lt;p&gt;If you can’t reproduce it might not actually be an issue of your hardware, maybe it was the game you are running. Try to find something that is in common: running with DX11? DX12? Finding a good reproduction is the first step in finding the root cause.&lt;/p&gt;
&lt;h3 id=&quot;gpu-temperature&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#gpu-temperature&quot; aria-label=&quot;gpu temperature permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GPU Temperature&lt;/h3&gt;
&lt;p&gt;The most common thing with GPUs blowing their fan at 100% and denying service would be temperature. If the card gets too hot, it will be loud due to the fan increasing speed and if that doesn’t help it will just shut off.&lt;/p&gt;
&lt;p&gt;This is however very easy to figure out: install a monitoring app, ideally one that also logs to disk or opens a webserver (as we have a black screen and can’t see it!). For me &lt;a href=&quot;https://openhardwaremonitor.org/&quot;&gt;Open Hardware Monitor&lt;/a&gt; is my tool of choice and has support for both. Flip the switch to 1s sensor logging intervals, run the benchmark and look at the numbers at the time of the crash.&lt;/p&gt;
&lt;p&gt;Nvidia cards usually turn off at around 97-100°C already, so if you’re a good few degrees  away then it’s not the issue. Otherwise, try to cool your card better and see if it fixes your problem. You can also try to reduce the voltage and clock of the GPU in order to make it cooler.&lt;/p&gt;
&lt;h3 id=&quot;gpu-voltage-and-clock&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#gpu-voltage-and-clock&quot; aria-label=&quot;gpu voltage and clock permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GPU Voltage and Clock&lt;/h3&gt;
&lt;p&gt;Since the GPU turns off, it might also relate to the power it receives. I’m using a card from EVGA, so I used &lt;a href=&quot;https://www.evga.com/precisionx1/&quot;&gt;EVGA Precision X1&lt;/a&gt; to adjust the voltage.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/abeea7029648dd1ca688d456968d4169/2c95d/evga_precision_main.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 74.0506329113924%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADTUlEQVR42o1TzY7cRBB2u7vd7fb/39ge75jZDbuz2d1ECzsTNihRlANZJCKBOHALN3gB4Algc0LzMBG3SHNE4sJ75DASEhICZO9H2bORcsRSqcvV1V/9fFWW9fyVufj+16+/evHbd0+KX84t+mCBWf/zu7y8dMuynJMqR4PJDn+YnFzhYP85ztqrN3mWv2aWvRG23jCLbZgMNm5Yb2xGui03tnA2TMi38poL9XvTtn9GfvXK2NULS3K1FtyGxay/oyS8cY2HMUmLIc0ytO0dNM0+9mYz+L6/u7Pt8X4nFrTrds3k8Ob96eqlxZlac6mglNsppW+4ED0XsifgPi8Kkkk/Kcu+qptR167phZS90u7o4yjV27bokzT9q503P1mMyfUQOY7jrmkaHB0dIaPMtNbwPA/GmPGcz+dYLBYUWCFNU+TkUxQF6moKV3t9Eqdb8rm22FCyEASgusFZKQc2leS6mh6lkIKD2wy+ZyjYIaQUCMMAcRTSSYlEEd3LPkneAbztR8eYAGUMxjWkDuGFBbSXQeiEJEW9dwjXLyHdHI7JofwKXEWwuOljAmzbdgfIKCPqS8dsTuRwBGkBN86p+Q6Y0LCFASPdyQ8g/AmUDmCCDEFEfiake93bXGw5YwOgXDvSQZoknRYe9aOlMu7QgxYymkO3H8DN70JZGcrzL5EWH8IIhbouqYf52Brb5j3jfEvDe01jY9ZauYiiuAtEiip/gjx8hDh7hOjoMwT3vkBIEjdPUX/0LeryCr4doZpWRGQykiTEwLreBp5HgEyvtaORUIaBiNCkj1GaFbLkY6T7n8IrH8BbfIJg8QzF42+Q1k8R8BrTSYs8LiG4M8xiPymq7dnZ/evdHFLvjGs6TWQk0QKhmiHwDxAU9+BmC7h79+HUdxE++BymOoGiDJWMYYi4qqxGQBqfPy4uLoYe6luWrW44ma2Iaed2CwSRtCNm0JkeGHWgqCLu+OQraU6HzbK7AZhm+KXlGv/nNC9Am/BPGCfdIDQC3d7svS7Piy4K4y6OkvGkPe/2mlkXjrZ4tJVl3RV5+a/jqDeU1I/WbDabHh8fX65WqyVFWL2Vh8vl6vT0dPWu7fT8fLV8uNz9n+5sy+X5qPupf2IsU/0HYR41pZY+W/AAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;evga precision x1 screenshot&quot;
        title=&quot;&quot;
        src=&quot;/static/abeea7029648dd1ca688d456968d4169/f058b/evga_precision_main.png&quot;
        srcset=&quot;/static/abeea7029648dd1ca688d456968d4169/c26ae/evga_precision_main.png 158w,
/static/abeea7029648dd1ca688d456968d4169/6bdcf/evga_precision_main.png 315w,
/static/abeea7029648dd1ca688d456968d4169/f058b/evga_precision_main.png 630w,
/static/abeea7029648dd1ca688d456968d4169/40601/evga_precision_main.png 945w,
/static/abeea7029648dd1ca688d456968d4169/2c95d/evga_precision_main.png 1099w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;There is a “Power” target on the top right that you can increase, I tried to go at 10% increments all the way to 140% and it didn’t fix the issue.&lt;/p&gt;
&lt;p&gt;Conversely you can also argue that clocking the GPU &lt;strong&gt;down&lt;/strong&gt; will help to stabilize it. I tried to also clock it down all the way to half the original clock and at higher voltage - didn’t fix it.&lt;/p&gt;
&lt;h3 id=&quot;psu&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#psu&quot; aria-label=&quot;psu permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;PSU&lt;/h3&gt;
&lt;p&gt;Again, where does the voltage come from? The PSU! Unless your whole PC shuts down by full power loss, it is unlikely that this is broken completely. Maybe a single rail is broken?&lt;/p&gt;
&lt;p&gt;Here are a couple things you can try:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Check the cables, are they loose or dirty? Try to clean the pins on both ends with compressed air. Wiggle them and see if it reproduces it already.&lt;/li&gt;
&lt;li&gt;Use different rails for your GPU, maybe one rail is actually broken&lt;/li&gt;
&lt;li&gt;Try different cables and different rails&lt;/li&gt;
&lt;li&gt;Swap with another PSU you know works in some other rig&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;swapping-cards&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#swapping-cards&quot; aria-label=&quot;swapping cards permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Swapping cards&lt;/h3&gt;
&lt;p&gt;Ultimately, if another card works as a replacement then you at least know that the rest of the system works fine and you have a good reason to return your GPU.&lt;/p&gt;
&lt;h3 id=&quot;drivers&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#drivers&quot; aria-label=&quot;drivers permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Drivers&lt;/h3&gt;
&lt;p&gt;Especially when you have just recently installed a new version, the Nvidia driver is a hot candidate for causing such issues.
What would we see if the driver crashes though?&lt;br&gt;
Normally this manifests itself as dwm.exe (Desktop Window Manager) crashing:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 458px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0e59c70aedd5f1afe87d850051c3a6a4/f7a31/dvm_2ITgK.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACFklEQVR42l2SyU/bYBDF/Yf3VPXUS6UK9dJeOPRQwaF0U4FCAyExIXZYQhYv8RLbcRJAFEhix0t+/eK0VNTS05t5M/O+GcnSh1Kdb4cqWz+O2dhVebsls7ZZ4d12h1dbCq+/qKyXNNZ/dnhfNtg8cfgoa3wvq+yrHUo7JeQXz1BePufT2hukrh+guyFty+OiF1LrBlRaPjV9TLntc9T2kPWQqjYocNQJRC3k3AxpOSO6VojR0nF1i71DBSkYzQhGE4Y3gscTBgLXtxH+8AFPYJmHVxPs4J6h4Cxf8P+3WKy0xqWB9DDN+PUwX2GScHufcDeZE17PGN/GIl5qc27uYq7EQ2mWP5osfVa8MjxtCcOr4QDXdfD6LqNhiG1Z+L5HOPBxHXulj4YiD4rYEZpt26LHp9/vY1k201lUGNbOdSRD69JsNtF0Hc/zMA0DVzSapkmv16OraULv0xODlnjMEHXbdhiEoTB3itwVc8k8ptY0kcbhAF03igZxgFg/fzwjz/MCRb7kxzx/Uk+zrNiweiZOzrO0WDmKY6LoH8eC/2IaxczmCXGaMf1TT5KENE0LJEnKQvgc1NtIi1Q0TydEs+kTxEtEs2K46Y3ZPVbZripFrBkmJ3KVhqpwUpORq1U8x6JUv0RqtC3qlz1Ou+4TqC2T+oVGvamxr7T4Wjnl8/JnFnFZuWC/ohTYq6jsVhrIZxobOzK/AQ/j2XmJoTr8AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;dvm.exe crash&quot;
        title=&quot;&quot;
        src=&quot;/static/0e59c70aedd5f1afe87d850051c3a6a4/f7a31/dvm_2ITgK.png&quot;
        srcset=&quot;/static/0e59c70aedd5f1afe87d850051c3a6a4/c26ae/dvm_2ITgK.png 158w,
/static/0e59c70aedd5f1afe87d850051c3a6a4/6bdcf/dvm_2ITgK.png 315w,
/static/0e59c70aedd5f1afe87d850051c3a6a4/f7a31/dvm_2ITgK.png 458w&quot;
        sizes=&quot;(max-width: 458px) 100vw, 458px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;And after some time the screen appears again with a notification that the Nvidia driver has crashed.&lt;/p&gt;
&lt;p&gt;When in doubt - driver sweeper. It’s nowadays called &lt;a href=&quot;https://www.guru3d.com/files-details/display-driver-uninstaller-download.html&quot;&gt;Display Driver Uninstaller (DDU)&lt;/a&gt; and you still have to boot into safe-mode to get it to uninstall everything correctly. After a clean install and/or a rollback to a previous version you can see whether this has fixed your issue.&lt;/p&gt;
&lt;p&gt;In my case that didn’t happen and so the re-installation had no effect.&lt;/p&gt;
&lt;h2 id=&quot;the-fix-for-me&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-fix-for-me&quot; aria-label=&quot;the fix for me permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The fix for me&lt;/h2&gt;
&lt;p&gt;It was a loose PSU cable on the GPU itself:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/28c6317afcbeeb77ca84c488562bee4f/d2602/20201123_204333.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAPABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAcCBQYJ/8QAFwEAAwEAAAAAAAAAAAAAAAAABAUGB//aAAwDAQACEAMQAAAB46zZuHW50kC1D7v/xAAbEAABBQEBAAAAAAAAAAAAAAAEAQIDBQYAE//aAAgBAQABBQJgUpxGgpCgY0VvWeuzkkxNqOUwjxfL/8QAIBEAAgIBAwUAAAAAAAAAAAAAAQIDBAUAEhQREzJBkf/aAAgBAwEBPwHF5rNduvyMBLRVjEBybFKWwiPIrWYY1q5d4HkkcqxeWAbNpMQ8Y9IwZVYrIhYAlC6kr19EhyPh1//EAB4RAAICAQUBAAAAAAAAAAAAAAECESEAAxJRYXHR/9oACAECAQE/AVfXDITtVJtKLMfag3z8wGbsdSuf/8QAJhAAAgEDBAEDBQAAAAAAAAAAAQIDBBESABMhIgUGIzFBQlFhof/aAAgBAQAGPwKAQA9IV9xz3mkJZ5JB85ctioHOMYOhWO+aSOA5H0kYE3OVm7WPIFsv1rkfy+t6g9I7KkINqXyjxU11AHWkooI0QPiC1pMssmuSx0xrfHiKnDR7MNBPPtwLhbawqZnaWxbO5bG5svTromniZIrAJuvlIQPucpiuR/Ciw1//xAAcEAEBAAMBAAMAAAAAAAAAAAABEQAhMUFRcZH/2gAIAQEAAT8hR9lOA4heoF0GYWc5MmHAQKPCbY42WzRP7SfW584h6oDnQZ7rNLAF3AA16eTHELGQFCI5Jg9XgAXP/9oADAMBAAIAAwAAABAHz//EABcRAQEBAQAAAAAAAAAAAAAAAAERITH/2gAIAQMBAT8QhjuY2DyLDG1ZefAYA2Yl2h3cZ//EABoRAQACAwEAAAAAAAAAAAAAAAERIQAxQbH/2gAIAQIBAT8QJqkmVMgUA06VpLQDaBkkarb6965//8QAGBABAQEBAQAAAAAAAAAAAAAAAREhAEH/2gAIAQEAAT8QvElLV3AYKJVuU+i2njYWkYRoC/lLWgiNOtRdI8IE0OJ4N6XghvPK8+pldTB6MhiJ3Lb5iR4yIBX/2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;loose cable on the rtx2080&quot;
        title=&quot;&quot;
        src=&quot;/static/28c6317afcbeeb77ca84c488562bee4f/828fb/20201123_204333.jpg&quot;
        srcset=&quot;/static/28c6317afcbeeb77ca84c488562bee4f/ff44c/20201123_204333.jpg 158w,
/static/28c6317afcbeeb77ca84c488562bee4f/a6688/20201123_204333.jpg 315w,
/static/28c6317afcbeeb77ca84c488562bee4f/828fb/20201123_204333.jpg 630w,
/static/28c6317afcbeeb77ca84c488562bee4f/0ede0/20201123_204333.jpg 945w,
/static/28c6317afcbeeb77ca84c488562bee4f/3ac88/20201123_204333.jpg 1260w,
/static/28c6317afcbeeb77ca84c488562bee4f/d2602/20201123_204333.jpg 4032w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;(no flex intended)&lt;/p&gt;
&lt;p&gt;You can clearly see the right PCI-E connector that is hanging a bit off the slot. Turns out the cable is a bit old and I already ordered a couple new ones to replace it. Actually wiggling on the cable for a bit has revealed exactly the same symptoms that happen during gaming.&lt;/p&gt;
&lt;p&gt;Why does it happen only after some time? I assume that the slot gets warmer and a bit more elastic such that the cable does not sit tight anymore. Also interesting is the fact that a reboot brings back the display, that most likely means it cools down just enough to keep the contact.&lt;/p&gt;
&lt;p&gt;I also remember when installing the card and it would not have enough voltage (one of the cables was actually broken), it would show no picture and just run at 100% fan speed.&lt;/p&gt;
&lt;p&gt;Hope it helps to troubleshoot this!&lt;br&gt;
Thomas&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Adding Kubernetes Clusters to GitLab Instances using Ansible]]></title><description><![CDATA[Hey there, I wanted to quickly share an automation step that you might want to find useful in your Ansible Playbooks.
It’s about adding a…]]></description><link>https://blog.thomasjungblut.com/cloud/ansible-gitlab-kubernetes/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/cloud/ansible-gitlab-kubernetes/</guid><pubDate>Mon, 16 Nov 2020 19:11:57 GMT</pubDate><content:encoded>&lt;p&gt;Hey there,&lt;/p&gt;
&lt;p&gt;I wanted to quickly share an automation step that you might want to find useful in your Ansible Playbooks.
It’s about adding a Kubernetes cluster to a Gitlab instance (eg installed via Omnibus) using Ansible.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.gitlab.com/ee/user/project/clusters/add_remove_clusters.html#existing-kubernetes-cluster&quot;&gt;The documentation tells you about a lot of manual steps&lt;/a&gt; to do it, but one can also do it via the API and a couple of shell scripts in Ansible.&lt;/p&gt;
&lt;h2 id=&quot;prerequisites&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#prerequisites&quot; aria-label=&quot;prerequisites permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Prerequisites&lt;/h2&gt;
&lt;p&gt;You need only two things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;kubectl&lt;/code&gt; should be installed and ready to talk with the Kubernetes cluster you want to integrate&lt;/li&gt;
&lt;li&gt;the Gitlab API should be available under a valid domain name, although localhost:port would also work&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;overview&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#overview&quot; aria-label=&quot;overview permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Overview&lt;/h2&gt;
&lt;p&gt;Effectively it’s a four step process:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;add a new admin token to the instance (can be skipped if already exists)&lt;/li&gt;
&lt;li&gt;adding the service account and cluster role bindings to the K8s cluster&lt;/li&gt;
&lt;li&gt;retrieve the k8s api url, certificate and token&lt;/li&gt;
&lt;li&gt;register using the gitlab API&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;ansible-script&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ansible-script&quot; aria-label=&quot;ansible script permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Ansible Script&lt;/h2&gt;
&lt;p&gt;Before we start, it needs two files to run: namely &lt;code class=&quot;language-text&quot;&gt;gitlab-admin-service-account.yaml&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;gitlab_add_k8s.j2&lt;/code&gt; template.&lt;/p&gt;
&lt;p&gt;The first looks like that, but can &lt;a href=&quot;https://docs.gitlab.com/ee/user/project/clusters/add_remove_clusters.html#existing-kubernetes-cluster&quot;&gt;ultimately come from the documentation&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ServiceAccount
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; gitlab
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kube&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;system
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; rbac.authorization.k8s.io/v1beta1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterRoleBinding
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; gitlab&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;admin
&lt;span class=&quot;token key atrule&quot;&gt;roleRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;apiGroup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; rbac.authorization.k8s.io
  &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterRole
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cluster&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;admin
&lt;span class=&quot;token key atrule&quot;&gt;subjects&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ServiceAccount
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; gitlab
    &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kube&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;system&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The latter just encodes the REST request body, which is akin to what is documented in the &lt;a href=&quot;https://docs.gitlab.com/ee/api/project_clusters.html#add-existing-cluster-to-project&quot;&gt;API documentation&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;cluster-name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;platform_kubernetes_attributes&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;token property&quot;&gt;&quot;api_url&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;{{k8s_api_url.stdout}}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
       &lt;span class=&quot;token property&quot;&gt;&quot;token&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;{{k8s_gitlab_token.stdout}}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
       &lt;span class=&quot;token property&quot;&gt;&quot;ca_cert&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;{{k8s_cert.stdout}}&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here’s the full script:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; integrate gitlab with kubernetes
  &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; all
  &lt;span class=&quot;token key atrule&quot;&gt;become&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;vars&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;gitlab_admin_token&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;SUPER_SeCuRE_P4SSWORD_1237&apos;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;gitlab_url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https://{{ gitlab_domain }}&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; install railties
      &lt;span class=&quot;token key atrule&quot;&gt;apt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;pkg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ruby&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;railties
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; add admin token
      &lt;span class=&quot;token key atrule&quot;&gt;become&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token scalar string&quot;&gt;
          echo &quot;token = User.find_by_username(&apos;root&apos;).personal_access_tokens.create(scopes: [:api, :sudo], name: &apos;Automation token&apos;); token.set_token(&apos;{{ gitlab_admin_token }}&apos;); token.save!&quot; | gitlab-rails console --environment=production&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; store k8s api url
      &lt;span class=&quot;token key atrule&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kubectl config view &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;o jsonpath=&apos;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;.clusters&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;.cluster.server&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&apos;
      &lt;span class=&quot;token key atrule&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; k8s_api_url
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; add service account
      &lt;span class=&quot;token key atrule&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kubectl apply &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;f gitlab&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;admin&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;service&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;account.yaml
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; set token secret
      &lt;span class=&quot;token key atrule&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token scalar string&quot;&gt;
        SECRET_NAME=$(kubectl -n kube-system get secret -o name | grep gitlab)
        kubectl -n kube-system get ${SECRET_NAME} -o jsonpath=&quot;{[&apos;data&apos;][&apos;token&apos;]}&quot; | base64 -d&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; k8s_gitlab_token
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; store k8s certificate
      &lt;span class=&quot;token key atrule&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kubectl get secrets &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;o=name &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt; xargs kubectl get &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;o jsonpath=&quot;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;data&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ca\.crt&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&quot; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt; base64 &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;d &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt; sed &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;E &apos;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;a;N;$&lt;span class=&quot;token tag&quot;&gt;!ba;s/&lt;/span&gt;\r&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n/\\n/g&apos;
      &lt;span class=&quot;token key atrule&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; k8s_cert
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; add k8s cluster to gitlab
      &lt;span class=&quot;token key atrule&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;{{gitlab_url}}/api/v4/admin/clusters/add&quot;&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; POST
        &lt;span class=&quot;token key atrule&quot;&gt;body_format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; json
        &lt;span class=&quot;token key atrule&quot;&gt;return_content&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; yes
        &lt;span class=&quot;token key atrule&quot;&gt;status_code&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;201&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;Private-Token&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;{{ gitlab_admin_token }}&quot;&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;Accept&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; application/json
          &lt;span class=&quot;token key atrule&quot;&gt;Content-Type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; application/json
        &lt;span class=&quot;token key atrule&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;{{ lookup(&apos;template&apos;, &apos;./gitlab_add_k8s.j2&apos;) }}&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The most notable aspect is really how to set the token, let’s take a look at the script with proper Ruby formatting:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;token &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; User&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;find_by_username&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;root&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;personal_access_tokens&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;scopes&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:api&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:sudo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Automation token&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; 
token&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;set_token&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;{{ gitlab_admin_token }}&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; 
token&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;save&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The whole thing you just pipe into the gitlab-rails console &lt;code class=&quot;language-text&quot;&gt;gitlab-rails console --environment=production&lt;/code&gt; to persist it in the database.&lt;/p&gt;
&lt;h2 id=&quot;bonus-localhost-clusters&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#bonus-localhost-clusters&quot; aria-label=&quot;bonus localhost clusters permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Bonus: Localhost clusters&lt;/h2&gt;
&lt;p&gt;If you find yourself having the cluster running on the same host as the gitlab instance (eg for development purposes) you might find yourself hitting that error:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;gitlab Import url is blocked: “Requests to the local network are not allowed”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This is somewhat explained in this &lt;a href=&quot;https://gitlab.com/gitlab-org/gitlab/-/issues/26845&quot;&gt;GitLab issue&lt;/a&gt;, the TL;DR; is that it’s a security feature.&lt;/p&gt;
&lt;p&gt;You can turn it off however, using the admin token we created above the Ansible script basically just becomes:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; allow localhost communication
    &lt;span class=&quot;token key atrule&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;{{gitlab_url}}/api/v4/application/settings?allow_local_requests_from_hooks_and_services=true&quot;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;Private-Token&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;{{ gitlab_admin_token }}&quot;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; PUT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Hope it helps!&lt;/p&gt;
&lt;p&gt;Cheers,&lt;br&gt;
Thomas&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Apache Hama - why it didn't become successful]]></title><description><![CDATA[Apache Hama moved in April 2020 to the Apache Attic, which is the final resting place for Apache projects that reached their end of life…]]></description><link>https://blog.thomasjungblut.com/open-source/apache-hama-why-it-didnt-become-successful/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/open-source/apache-hama-why-it-didnt-become-successful/</guid><pubDate>Sat, 14 Nov 2020 16:18:03 GMT</pubDate><content:encoded>&lt;p&gt;Apache Hama moved in April 2020 to the &lt;a href=&quot;https://attic.apache.org/projects/hama.html&quot;&gt;Apache Attic&lt;/a&gt;, which is the final resting place for Apache projects that reached their end of life. Today, roughly half a year after this move, I think it is a good time to write a blog post about why we think this happened.&lt;/p&gt;
&lt;p&gt;When you’re asking yourself who “we” is, this is a joint post with Edward J. Yoon (the original creator of Hama and long time Project Champion and PMC Chair), Chia-Hung Lin (PMC chair, committer and PMC member) and myself (past time committer and PMC member). Helpful input and comments were given by Tommaso Teofili (our Apache mentor and PMC member) - &lt;strong&gt;thank you all!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;An important goal for this post is that we want to help other Apache projects, especially in the incubator, that have their whole lifetime ahead of them and give them the opportunity to learn from our humble mistakes in running this project for over a decade.&lt;/p&gt;
&lt;h1 id=&quot;table-of-contents&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#table-of-contents&quot; aria-label=&quot;table of contents permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Table of Contents&lt;/h1&gt;
&lt;div class=&quot;table-of-contents&quot;&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#history&quot;&gt;History&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;#early-days&quot;&gt;Early Days&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#what-is-bsp&quot;&gt;What is BSP?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#important-events-and-contributions&quot;&gt;Important Events and Contributions&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#community&quot;&gt;Community&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#technical-shortfalls&quot;&gt;Technical Shortfalls&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;#installation-challenges&quot;&gt;Installation Challenges&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#scalability-challenges&quot;&gt;Scalability Challenges&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#difficult-programming-model&quot;&gt;Difficult Programming Model&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#from-an-apache-contributor-and-user-perspective&quot;&gt;From an Apache Contributor and User perspective&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#the-level-of-contribution&quot;&gt;The Level of Contribution&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#decentralized-community&quot;&gt;Decentralized Community&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#pros-and-cons&quot;&gt;PROs and CONs&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;#pros&quot;&gt;PROs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#cons&quot;&gt;CONs&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#will-bsp-come-back&quot;&gt;Will BSP come back?&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;h1 id=&quot;history&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#history&quot; aria-label=&quot;history permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;History&lt;/h1&gt;
&lt;p&gt;(&lt;a href=&quot;https://brunch.co.kr/@edwardjyoon/23&quot;&gt;this is partially based on a micro blog Edward wrote in Korean&lt;/a&gt;)&lt;/p&gt;
&lt;h2 id=&quot;early-days&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#early-days&quot; aria-label=&quot;early days permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Early Days&lt;/h2&gt;
&lt;p&gt;Edward in 2007 was a very famous blogger for a couple of Google papers that came out around that time. Namely: &lt;a href=&quot;https://research.google/pubs/pub27898/&quot;&gt;BigTable&lt;/a&gt;, &lt;a href=&quot;https://research.google/pubs/pub33004/&quot;&gt;MapReduce&lt;/a&gt; and &lt;a href=&quot;https://research.google/pubs/pub51/&quot;&gt;Google FileSystem (GFS)&lt;/a&gt;. Those were the academic and technical foundations of what eventually became the &lt;a href=&quot;https://trends.google.com/trends/explore?date=all&amp;#x26;geo=US&amp;#x26;q=big%20data&quot;&gt;Big Data hype that hit us around 2010&lt;/a&gt; with full broadside. &lt;a href=&quot;https://hadoop.apache.org/&quot;&gt;Apache Hadoop&lt;/a&gt; here was a front-runner originally contributed from Yahoo! and spawned numerous applications in the Apache ecosystem that were centered around MapReduce and HDFS (the Hadoop Distributed FileSystem).&lt;/p&gt;
&lt;p&gt;Apache Hama was originally created as a matrix multiplication library on top of Hadoop and MapReduce, which is also where it got its name from (Hadoop Matrix). When you implement matrix multiplications with MapReduce, for example as part of graph algorithms like PageRank, you will find yourself using a pattern called &lt;a href=&quot;https://en.wikipedia.org/wiki/Message_passing&quot;&gt;message passing&lt;/a&gt;. You are usually passing messages along with the original data as part of the map step and in the reduce step have all messages available for a given data point. This allows you to merge and interpret these messages and prepare for the next iteration.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I used to blog a lot about these kinds of &lt;a href=&quot;https://blog.thomasjungblut.com/blogger/controlling-hadoop-job-recursion/&quot;&gt;recursions&lt;/a&gt;, &lt;a href=&quot;https://blog.thomasjungblut.com/blogger/graph-exploration-with-hadoop-mapreduce/&quot;&gt;MinDist Search in a Graph&lt;/a&gt; and there has been an &lt;a href=&quot;http://users.umiacs.umd.edu/~jimmylin/publications/Lin_Schatz_MLG2010.pdf&quot;&gt;excellent whitepaper on the whole topic by Jimmy Lin and Michael Schatz&lt;/a&gt; if you want to read more about it.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The whole pattern not only sounds abusive: it is very inefficient as the same data has to be constantly read from disk or network, along with small payloads written to HDFS and shuffled and joined for the reduce phase - across the network - all over and over again. It made sense to skip all that mapping and reducing and directly go with a message passing protocol. The choice then fell on &lt;a href=&quot;https://en.wikipedia.org/wiki/Bulk_synchronous_parallel&quot;&gt;Bulk Synchronous Parallel&lt;/a&gt; (BSP), which originated in the 80s from Leslie Valiant and has a fairly famous academic library called BSPlib.&lt;/p&gt;
&lt;h2 id=&quot;what-is-bsp&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#what-is-bsp&quot; aria-label=&quot;what is bsp permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What is BSP?&lt;/h2&gt;
&lt;p&gt;It’s best explained by looking at the below picture:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fda4dfce01e782281f088587ad759f39/2bef9/bsp_overview.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 77.84810126582278%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpUlEQVR42sWUSy9DQRiG395bpQQVmu4q7hbiGpcKDVEiaiHUwl9hJSQuCz/Aws5f8AcsKtFqKalbQ8Sv4J3OJzmtk7otnOTJzPnmzDvv983MAf7psZFaUi+txTBm+Y2gmuQhXlLxQ5F1q26vWoF0B3DeAzy1AGftwG0322bgsotxkggx1v+F4JsIPo4C+XHgehZ4HgFS7N9MA5lBIBcBsgqK5RdLU7dKXXzEQYd2Hc5R5C7MSVHgdZhCY3QzRdcDwP0E45PMoo/9mJmgKnYTaQBmXMUOc1HtMBPWgsrhQ0QLXpg6LE1ZBtKqVqxdNqYdJsNaPNGmx1T6qV4uMmcmaCnBUM/TIPBCV0mmnBwCTqpl0+YpGio2UX5z+NGSTfePWN9jESrESILvh26zmaqG6mN/ycFVVAGVKuYkNaROYBxuOZs2s0PL3YVLJjqLBQv4ZFFuGlg/BKTvFcFvHXS1gF0Wc8gN8UhGH+NuaT/d04Ck65R35WqD7JFdsi3tPtkim2RHOCCdhvIVBBolBb/USrlZIKtkmcTJihA3oMbWSPAvP4qyzzt4yFmgudU+KgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;bsp overview&quot;
        title=&quot;&quot;
        src=&quot;/static/fda4dfce01e782281f088587ad759f39/f058b/bsp_overview.png&quot;
        srcset=&quot;/static/fda4dfce01e782281f088587ad759f39/c26ae/bsp_overview.png 158w,
/static/fda4dfce01e782281f088587ad759f39/6bdcf/bsp_overview.png 315w,
/static/fda4dfce01e782281f088587ad759f39/f058b/bsp_overview.png 630w,
/static/fda4dfce01e782281f088587ad759f39/40601/bsp_overview.png 945w,
/static/fda4dfce01e782281f088587ad759f39/2bef9/bsp_overview.png 1024w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;It’s conceptually simple and formalized in three discrete steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Computation&lt;/strong&gt;: each of the parallel processors runs local computations&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Communication&lt;/strong&gt;: exchange messages with other processors&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Barrier Synchronization&lt;/strong&gt;: make sure all processors came to that stage and received the messages from other processors&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Iterative algorithms would make use of these steps by continuously running them until some kind of convergence has been achieved. For example in PageRank that would be a small enough delta per iteration of the individual PageRanks or a limit on the number of iterations.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If that looks similar to what &lt;a href=&quot;(https://en.wikipedia.org/wiki/Message_Passing_Interface)&quot;&gt;MPI&lt;/a&gt; (message passing interface) does, yes it’s a very very simplistic version of what MPI can do.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Fun fact: you can even express MapReduce using BSP. The map phase is exactly what the local computation is, shuffle and joining is the communication and synchronization phase and another following local computation would be the reduce phase.&lt;/p&gt;
&lt;h2 id=&quot;important-events-and-contributions&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#important-events-and-contributions&quot; aria-label=&quot;important events and contributions permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Important Events and Contributions&lt;/h2&gt;
&lt;p&gt;Back to the actual history of Apache Hama, the pivot from MapReduce library to BSP was done sometime in 2009/2010 if I remember correctly. We’ve been developing together for a couple of releases and eventually graduated the Apache Incubator in July 2012 where we had our first release 0.5.0 as Apache Hama - a fully fledged Top Level Project (TLP).&lt;/p&gt;
&lt;p&gt;Couple of my personal important milestones with Hama, as they are useful context for the below sections as well:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2011 was the first year Hama participated in &lt;a href=&quot;https://cwiki.apache.org/confluence/display/hama/GSoC2011&quot;&gt;Google Summer of Code&lt;/a&gt; (GSoC), which helped students to work on interesting open source projects for a bit of money and swag. This is how I found my way to contribute to Hama.&lt;/li&gt;
&lt;li&gt;2011 also had release 0.3.0 which contained the first couple of Graph algorithms (&lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-395&quot;&gt;Pagerank&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-359&quot;&gt;Single Source Shortest Path Finding&lt;/a&gt;) - we’ll touch upon these later when we discuss technical shortcomings&lt;/li&gt;
&lt;li&gt;2012 with its 0.4.0 release added a &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-258&quot;&gt;Hadoop-like data IO system&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;later in 2012 we released 0.5.0 with the &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-409&quot;&gt;new Pregel-like Graph Computation API&lt;/a&gt; and another interesting graph algorithm &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-550&quot;&gt;Bipartite Graph Matching&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;until 2014 the 0.6.x releases then added a fully fledged &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-604&quot;&gt;math and machine learning library&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-804&quot;&gt;neural networks&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-547&quot;&gt;k-means&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-601&quot;&gt;cross-language “streaming” adapters&lt;/a&gt; - &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-619&quot;&gt;also “pipes” for c++&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-524&quot;&gt;Sparse Matrix-Vector Multiplication&lt;/a&gt;. I also believe we added &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-431&quot;&gt;Hadoop YARN support during this time&lt;/a&gt;, which we were the very first to actually implement in the whole Apache ecosystem.&lt;/li&gt;
&lt;li&gt;in 2015-2018 the 0.7.x releases featured &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-783&quot;&gt;more efficient in-memory storage of serialized messages&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-612&quot;&gt;collaborative filtering for recommender systems&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-726&quot;&gt;Mesos Runtime&lt;/a&gt; and many more things.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;More than a decade after it started and “Big Data” being &lt;a href=&quot;https://www.nytimes.com/2020/01/15/technology/data-privacy-law-access.html&quot;&gt;largely co-notated negatively in public&lt;/a&gt;, &lt;a href=&quot;https://www.cloudera.com/about/news-and-blogs/press-releases/2019-01-03-cloudera-and-hortonworks-complete-planned-merger.html&quot;&gt;Hortonworks and Cloudera merging companies&lt;/a&gt; and the later hype in Machine Learning slowing down again -  Apache Hama was invited to join the Attic in April 2020.&lt;/p&gt;
&lt;p&gt;Retrospectively looking at all the things the team behind Apache Hama has shipped, I can only say that I’m still very proud having been part of this team. Yet the world around Apache Hama moved even faster than we could as a community.&lt;/p&gt;
&lt;h1 id=&quot;community&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#community&quot; aria-label=&quot;community permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Community&lt;/h1&gt;
&lt;p&gt;One very great thing about Apache projects is that they are fully driven by their community as a meritocracy. Basically everything is being voted on and it is open for anybody to join the mailing lists, comment and vote. Building a community around your project is your only way to survive and is also an important checkpoint when the project graduates from the incubator. The Apache Foundation takes a very close look at whether your project is entirely driven by a company, that might defund the project or move the people working on it, or whether you’ve built a thriving community of individuals that are contributing frequently to releases.&lt;/p&gt;
&lt;p&gt;Another good thing about Apache projects is that we can look at the JIRA project (I can’t believe I’m saying this in 2020) and get the individual contributions over time and per release:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f6057e15ed94dcb090665a037d45a248/16068/3D_contributor_ticket_anonymous.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.835443037974684%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABeklEQVR42nVQW0vCYBj2V0XMU0RoUXTZRXTRnym9iSAI06Y2zYuakWR6E1SUaXmcczmnsJRAsG3aRJybm/ZtOjtADw8vz/t978N7MPR6vYEgjDWMRqNJFAYAWphCmH2NdUiSZJjlA1HkOm0ghrKsU5FBHKpaVhSVsvzXPPGD/sm7OKgd/wNQpv7qzX6ZKZoLHfpThY8kzj0V2RTOpXA2gbE3z837bCuBMYVKR9E7i6LU5tpTM4A/UnHCeddF0+Ejd2HC6SM1lneOXx1ewuEl908p7rM/3XEgdLv8dGeWH8KBRw/yAEcabpQ6OqdAdKM1N1r1hGuus4onTO2dYFi5pY2vzg/OaFAU1Vx97x8gaS9aCkTfgteAdeSKRqJ0MFYPxhq+y1ooTntQ8valqS2v76yedyhtbm3PQUvmxTXIYjNal40WOxCQ2QZZ7ECbrMvmhZV5k211fYNhmO+DdXleFEWCKOWymUI+NyNIs5n0z5d8LoMXMVCs30z8AnQUxq1UXe7zAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;contributor graph per release&quot;
        title=&quot;&quot;
        src=&quot;/static/f6057e15ed94dcb090665a037d45a248/f058b/3D_contributor_ticket_anonymous.png&quot;
        srcset=&quot;/static/f6057e15ed94dcb090665a037d45a248/c26ae/3D_contributor_ticket_anonymous.png 158w,
/static/f6057e15ed94dcb090665a037d45a248/6bdcf/3D_contributor_ticket_anonymous.png 315w,
/static/f6057e15ed94dcb090665a037d45a248/f058b/3D_contributor_ticket_anonymous.png 630w,
/static/f6057e15ed94dcb090665a037d45a248/40601/3D_contributor_ticket_anonymous.png 945w,
/static/f6057e15ed94dcb090665a037d45a248/78612/3D_contributor_ticket_anonymous.png 1260w,
/static/f6057e15ed94dcb090665a037d45a248/16068/3D_contributor_ticket_anonymous.png 1451w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;On the Z-axis coming vertically up are the amount of tickets a contributor (X-axis, each line one person) has resolved as the assignee and on the Y-axis we have the releases ascending towards the bottom. Of course, not every resolved ticket is the same and solving a lot of small tickets is not the same as contributing few high quality patches - however it gives a very good indicator for project engagement.&lt;br&gt;
As you can see from the data, this project was mostly driven by one person over the whole time and other contributors only added a few patches and sometimes only for one or two consecutive releases.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Constantly analyse the contributions and the contributors and make sure they are happy and engaged with your project. It’s healthier to have many contributors than very few super-active ones. You might already know this as the &lt;a href=&quot;https://en.wikipedia.org/wiki/Bus_factor&quot;&gt;bus factor&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;You can also argue that Hama was a very scientific project that primarily attracted students and, matter of fact, we got a lot of attention by consistently having a really exciting set of GSoC projects available. GSoC is really helpful because you gain fresh contributors that usually start by taking on a couple newbie issues and improving documentation while they ramp up on the project. This is a helpful multiplier for other people that want to contribute by constantly smoothing the onboarding experience. On the flipside, students are only students for so long and very few stay for longer than the GSoC period.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Diversify the community by attracting a healthy mix of spare-time contributors, academics, students and, if possible, fulltime employees that are being paid to contribute.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Which of course brings up the question: how do you attract these people? Outside of GSoC we found meetups and conferences to be quite important. Whenever there is a chance for you to present it - take it! However, this is only the very start of building a community. Bringing people in by the metric ton does not actually keep you afloat. You need a way to keep them happy and engaged with your project for a longer period of time. The Apache way of working helps, as it gives you a strong recommendation of involving your community for everything (from roadmaps to releases). Maybe it is an overkill for some, but I usually like to visualize this with a classic conversion funnel that you may know from SaaS:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/276e6b9ee1d8a1bbd778a03ae7f3f73e/7de01/funnel.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACXElEQVR42oWR20uTcRjHXzA6EHYEiw6X0T9QXRdUEDEjwaIo6qJuNEhdIzDKIgg63DRxlm5qU6dza0fFTd0BG5smwbxLg0JIIm9yh7d0uvfTb+9cLTN64PM+X37P9/nywCsFg0EcDgcul2tNnE6nOi+wlsftdmO324lEIkgej4e2tjbM5m5emS2/aO/oos/mxOcP4OkfxDvgY9A3jM3uVGfFXnNnN0ajEb/fj5T79PRasVnbsfcYBM15LAZe977AZTfhtplw2Yy4hXZYW397VMSOtQOLpYdwOIyUTs2T/A6J+A1kn4Qc2I48UirYIthKemgT6eFS0TeryEMbV+aCwDZkv0Riso6EDLKcRELJkKvl91UowxKMrhOIHtkA7w5A/JDgcBFH4M2KZ7QERiSWp2rUDJRlJCWbQRE6M6UjGypBDu0iEdhJMkdwN8nwflKhvaTC+0iG9pAcPSjey0iM7BDeMrLh9WQ+3FEzFGVJXKhKceHiN1j8TPPQJFXtMbTd42i7coxRax6jxhxTdV1nVJ1Vd4xh8E+KnVmxO0+hpILI5nO5553lhH6aipefOG+cQef4QoN3job+OepdX6lsnVFnJxunuSu8xburAvOvD70f0TyPU2GYQNMY5WxTjIstb7nQMq5qjT5KRdME5fq46i3e/SOwUKkfGeRFaI09ReuupH7gKjrPJW57Lqta6z6HMfaM1ILwLiytXv87MKtk1W6I6qj1HOdJ+DqPQ9d4FLiCPnITXf8pMbuV/6lFl/030BS9T1XfUXSucnRODVrnaaHPUN13DFPswT8DfwIBGf9xLO5eDAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;contributor funnel&quot;
        title=&quot;&quot;
        src=&quot;/static/276e6b9ee1d8a1bbd778a03ae7f3f73e/f058b/funnel.png&quot;
        srcset=&quot;/static/276e6b9ee1d8a1bbd778a03ae7f3f73e/c26ae/funnel.png 158w,
/static/276e6b9ee1d8a1bbd778a03ae7f3f73e/6bdcf/funnel.png 315w,
/static/276e6b9ee1d8a1bbd778a03ae7f3f73e/f058b/funnel.png 630w,
/static/276e6b9ee1d8a1bbd778a03ae7f3f73e/7de01/funnel.png 794w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;From this model you can figure out quickly how your community is currently looking like and how “strong” it stays over time. The way you shape each individual step in the funnel is up to you and certainly depends on your community. The goal is not to annoy them to contribute for engagement’s sake, but rather to figure out where people are stuck and what to do about it:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Do you have trouble getting people interested and into the funnel?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Invest more time into going to meetups, presenting things and acquiring people and companies that could be interested in the project.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Do you struggle to get people into the “Contributing” step?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This is a clear sign that people can’t pick up easy tasks for starting: invest time to scope out starter exercises and invest into your documentation for people to ramp up.&lt;/li&gt;
&lt;li&gt;For Hama working on small examples was very helpful, as it gave contributors familiarity with the framework and more usecases for others to come into the funnel eventually.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Do you have trouble keeping people around for multiple releases (“Engaged”)?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The ASF gives you a nice carrot here: the PMC (project management committee) can vote contributors into the ”&lt;a href=&quot;http://community.apache.org/contributors/&quot;&gt;committer&lt;/a&gt;” status. This comes with perks like write/merge permissions to the project and your own apache.org e-mail address. Of course after some time you can also ask them to join the PMC itself (by having a vote).&lt;/li&gt;
&lt;li&gt;When time and pandemics allow for it, make sure you organize get-togethers. It really helps with bonding. When you enjoy working with people you know personally, it’s easier to retain them working for the project.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;“Converted” is up for you to define by what you want to get out of the community in the long run. Maybe you want to grow your PMC members into becoming chairs or project champions eventually. There is still plenty of room to grow in the framework of the ASF.&lt;/p&gt;
&lt;h1 id=&quot;technical-shortfalls&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#technical-shortfalls&quot; aria-label=&quot;technical shortfalls permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Technical Shortfalls&lt;/h1&gt;
&lt;p&gt;Since we’re primarily building a framework, we inevitably also had some shortfalls in our technology. Here’s my top three that significantly hindered Hama’s adoption:&lt;/p&gt;
&lt;h2 id=&quot;installation-challenges&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#installation-challenges&quot; aria-label=&quot;installation challenges permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Installation Challenges&lt;/h2&gt;
&lt;p&gt;Hama required a totally new set of daemons to be installed, back then this was a big deal. There was no Docker and Kubernetes to just spin up a couple of containers: somebody had to go and install the release on hundreds of Linux servers. It worked with HDFS, but there was no reuse of the existing Hadoop TaskManagers. Eventually you had to run them side-by-side with MapReduce (which is bad for resource sharing reasons) or create a new cluster for it (expensive). Projects like &lt;a href=&quot;https://giraph.apache.org/&quot;&gt;Giraph&lt;/a&gt; figured that out early and directly ran on top of Mappers, “abusing” the MapReduce framework as a JVM scheduler. As a result Giraph had much better community and industry adoption.&lt;/p&gt;
&lt;h2 id=&quot;scalability-challenges&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#scalability-challenges&quot; aria-label=&quot;scalability challenges permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Scalability Challenges&lt;/h2&gt;
&lt;p&gt;Due to the &lt;a href=&quot;https://en.wikipedia.org/wiki/Gang_scheduling&quot;&gt;gang-scheduling&lt;/a&gt; aspect of always running all BSP peers at the same time, we had a lot of trouble fitting peers into a cluster. When your matrix/graph was too big or you didn’t have enough memory, it would just not run. A lot of folks were coming from the expectations of MapReduce, which can run on a few servers and if you want to wait less, you can just add more servers. Talking about not having enough memory, the framework was a real hog of that. All messages you were sending were stored in memory, all data you needed to load to do computations most likely also was stored in memory. Of course with Spark coming up and RAM becoming cheap, this was less of an issue, but companies were building out new clusters with Spark - not with Hama.&lt;/p&gt;
&lt;h2 id=&quot;difficult-programming-model&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#difficult-programming-model&quot; aria-label=&quot;difficult programming model permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Difficult Programming Model&lt;/h2&gt;
&lt;p&gt;While BSP is not quite like MPI in terms of complexity, the programming model was too difficult for people to build applications on top of it. We also frequently found ourselves building MPI primitives like &lt;a href=&quot;https://mpitutorial.com/tutorials/mpi-reduce-and-allreduce/&quot;&gt;All-Reduce&lt;/a&gt; in BSP for every algorithm that required it. It’s a very common thing in &lt;a href=&quot;https://tech.preferred.jp/en/blog/technologies-behind-distributed-deep-learning-allreduce/&quot;&gt;machine learning&lt;/a&gt; and graph algorithms to reduce the state of all workers and distribute it back. In BSP this is a costly operation: you have to send all state to one single machine, sync, compute on that one machine (while all others are IDLE), send the result back to all workers and sync again.&lt;/p&gt;
&lt;p&gt;This inherent inefficiency of the programming model, earlier lack of an IO system and us not explicitly focusing on a vertical (like Giraph with Graphs) caused a lot of problems: &lt;strong&gt;BSP is too generic for people to “get it”&lt;/strong&gt;. Eventually we added a graph module and an IO system, but then Spark came around with full force. With its more sophisticated model based on RDDs and higher level functions (not just map and reduce), people from functional programming immediately felt at home and could suddenly write clustered software that scales with a few lines. Of course a graph and math package was very easy to build over such solid abstractions and I think that was the effective nail in the coffin for Hama.&lt;/p&gt;
&lt;h1 id=&quot;from-an-apache-contributor-and-user-perspective&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#from-an-apache-contributor-and-user-perspective&quot; aria-label=&quot;from an apache contributor and user perspective permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;From an Apache Contributor and User perspective&lt;/h1&gt;
&lt;p&gt;This section was fully authored and kindly contributed by &lt;strong&gt;Chia-Hung Lin&lt;/strong&gt; - thank you.&lt;/p&gt;
&lt;h2 id=&quot;the-level-of-contribution&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-level-of-contribution&quot; aria-label=&quot;the level of contribution permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Level of Contribution&lt;/h2&gt;
&lt;p&gt;The Apache Software Foundation (The ASF) is a non-profit &lt;a href=&quot;https://www.apache.org/foundation/how-it-works.html&quot;&gt;public charity organization&lt;/a&gt;. After signing &lt;a href=&quot;https://infra.apache.org/new-committers-guide.html#becoming-a-committer&quot;&gt;ICLA&lt;/a&gt; and the acceptance of ICLA by the ASF, one becomes a committer and further may be invited as the member of &lt;a href=&quot;https://www.apache.org/foundation/governance/pmcs.html&quot;&gt;PMC&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;decentralized-community&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#decentralized-community&quot; aria-label=&quot;decentralized community permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Decentralized Community&lt;/h2&gt;
&lt;p&gt;The ASF is a decentralized open source &lt;a href=&quot;https://en.wikipedia.org/wiki/The_Apache_Software_Foundation&quot;&gt;community of developers&lt;/a&gt;, and because of its nature, most of its activities and communication are done through mailing lists and by &lt;a href=&quot;https://www.apache.org/foundation/voting.html&quot;&gt;voting&lt;/a&gt; online. Also in order to facilitate the communication and resource utilizations, there are &lt;a href=&quot;https://infra.apache.org/doc.html&quot;&gt;many docs&lt;/a&gt; and &lt;a href=&quot;https://community.apache.org/lists.html&quot;&gt;mailing lists&lt;/a&gt; that deal with foundation wide tasks.&lt;/p&gt;
&lt;h2 id=&quot;pros-and-cons&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#pros-and-cons&quot; aria-label=&quot;pros and cons permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;PROs and CONs&lt;/h2&gt;
&lt;p&gt;Therefore, as to the time that one may participate in the Apache projects, (s)he may observe some issues that may or may not be related to the ASF community. The list here is an observation purely from an amateur Apache project user/ developer, not anything about right or wrong.&lt;/p&gt;
&lt;h3 id=&quot;pros&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#pros&quot; aria-label=&quot;pros permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;PROs&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Brand&lt;/strong&gt;: The ASF is an umbrella that may attract many potential developers to contribute.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Many Resources&lt;/strong&gt;: The ASF provides many tools, particularly the Apache Infrastructure project, which provides and manages all the ASF infrastructure and services. A project like Apache Hama uses those services to perform CI/ CD, or project artifact release. Also mailing lists provide spaces to discuss the problems, be it a problem that the participant needs help or open questions.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;cons&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#cons&quot; aria-label=&quot;cons permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CONs&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Long, Tedious Procedure&lt;/strong&gt;: As the ASF is a community, one of its distinctions is the requirement of consensus, so that the progress can continuously proceed. However such procedure may be a burden for the project who wants to focus more on artifacts release. For instance, to release a new version for a project, in addition to the general artifacts building process, it also requires to post a vote announcement on mailing list, copying artifacts to svn directory, &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/gossip-dev/201807.mbox/%3CCAENxBwzu9gU%2B08E%2BEawcoifjrR7awPHrPs2FiTRmONCxceVCfQ%40mail.gmail.com%3E&quot;&gt;and so on&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Too Many Resources, but Lack of Instruction for Newcomers&lt;/strong&gt;: Although the ASF offers many resources as described in the PROs section, this might be a barrier for an user or developer who, in the past, did not involve (or has lesser experience) in such a style of development and communication. Even though the participant is willing to learn and proactively search and ask in the community; some issues may be baffling such as different versions of a document found on the internet, or delay or lack of response. Though it’s understood because it’s open source and decentralized (and of course it’s continuously improving), somehow it’s still an issue that a newcomer may need to take into consideration.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;will-bsp-come-back&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#will-bsp-come-back&quot; aria-label=&quot;will bsp come back permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Will BSP come back?&lt;/h1&gt;
&lt;p&gt;Absolutely. All things come back eventually.&lt;br&gt;
I’m faithful that with new runtimes like &lt;a href=&quot;https://kubernetes.io/&quot;&gt;Kubernetes&lt;/a&gt; and &lt;a href=&quot;https://github.com/volcano-sh/volcano&quot;&gt;Batch Frameworks like Volcano&lt;/a&gt;, that make it significantly easier to build such application, we’ll see some new projects in this space. Of course, I also hope that this blog post helps to figure out what must be improved for increased adoption and stronger community.&lt;/p&gt;
&lt;p&gt;All the best,&lt;br&gt;
Thomas&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Fixing Braava M6 not coming out of its home base]]></title><description><![CDATA[I got a Braava M6 a couple of months ago and I’ve been a happy customer so far. Most recently though, I encountered a rather annoying issue…]]></description><link>https://blog.thomasjungblut.com/random/fixing-braava-m6/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/random/fixing-braava-m6/</guid><pubDate>Wed, 11 Nov 2020 17:34:50 GMT</pubDate><content:encoded>&lt;p&gt;I got a Braava M6 a couple of months ago and I’ve been a happy customer so far. Most recently though, I encountered a rather annoying issue: &lt;strong&gt;it’s not leaving its home base anymore&lt;/strong&gt;. There is constant wheel-spin when it tries to leave the base and at some point it just becomes stuck and gives up the job. This is particularly annoying when you have it running on a schedule and you’re away from home.&lt;/p&gt;
&lt;h1 id=&quot;root-cause&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#root-cause&quot; aria-label=&quot;root cause permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Root Cause&lt;/h1&gt;
&lt;p&gt;I couldn’t really figure out what is wrong and it also doesn’t happen in a reproducible manner.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/585c3460054685c56ca87e5e51536e94/5f6dd/braava_original.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 74.68354430379746%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADdklEQVR42h2Ra1MaVwCG96d0WqfT6afOZNppO5OM1aKSIEpYroI3UGBhuSy3gAkqigIViyLIXTI2ajudfEiNrggCkcr9sgssUmM72pn8jp70zPv1Oc95zwsppGIdKjNhai0qsxgxk15t0qMGnVKvVZj0KotJZzZojZhao5KpFFKZdGp2Sjg5wRVwWRwWA0Lmpj/Ceg2KSC0mzGzQGDGlXocYdAimkRt1Kp1ajiokyPzMvEQsnRFNi3lC3lMePMYefwIh89MqRAJsKCIBQiOGGjClRim1PsMSe9H9/UQiEYtGgpFwIBIKLL6wwKwnPM4YzGKwmHRIPjclk4oxDaIAtygkKDKnVs4DG8xmfv7Fl99+9/DhowHaEJ0xOgZzuKOjjGFaP3ACcvTxEKRGpODZC2bQFtVrQVUlplMpZLMKmdRotEqkcjbM/5FG//qb7z/5tK+v77PBwX768CCDTqPTBiClfAZU0mvkFpN2wYLZl6yrK7YVu+3g4NX9vx9ub++61zdNkioUq5eXRaFQ8ODBV8NDP9CHB0Zo/dC2x+lxrq6v2JZtZvuixfbC7HY5jo9PK9Vmu9NtdzqtNlWt1UuV6mW+4NsJzM5OspgjPJjJZTOh3w9+OXgZ34sGE7FgOLizuelKX2RLpVq11ihX6lS3R7aoRpMsFMv4WTqfL8Wie0+ZI1w2A2Y9hvZj4XhoNx4JxCO7bucKjuPvb+8bDaLeIFrt6w71F0FSpXIdP0tlMtnUeSYUjIDfFglYfA4Tiu3uRALb0dDOhmv16PBV7+afLtUDobo3oG27c00QnWqNyObypyc4fpp6/frNnGRqcoID1gawLxbyez3OUMDXaV9TVLfz8VAg7XabIMlavVkq1/L54kUamLNneFoOtp2ARQIYehkOBP1bDvvzkz+O7+8+dNoA7rZaJAhBNBuNRqVSvroq5HKX6XQGmJPJDIrIRQK2WMiBwn7v9qbbvbYcDfprlUbv+u/3N3e93i1F9QiCrFZrxWIpn/8zl3t3kcrgJ+fJk5QR0/I542JgDmx5tj2un91rbscS2Cyy6/vt6DCVTBWuyo16i2xS9RpZKtbyuavMeQ4/xlOnaYNWy4eZ/8PeDZ/HtfXTute9trFuX1teWF20OpasTsei1+MOBfy/Hh69ffM2l3qXSWbT+EU8GBPxOULuuJDD+g/LfPRSlAbshwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;home base&quot;
        title=&quot;&quot;
        src=&quot;/static/585c3460054685c56ca87e5e51536e94/f058b/braava_original.png&quot;
        srcset=&quot;/static/585c3460054685c56ca87e5e51536e94/c26ae/braava_original.png 158w,
/static/585c3460054685c56ca87e5e51536e94/6bdcf/braava_original.png 315w,
/static/585c3460054685c56ca87e5e51536e94/f058b/braava_original.png 630w,
/static/585c3460054685c56ca87e5e51536e94/40601/braava_original.png 945w,
/static/585c3460054685c56ca87e5e51536e94/5f6dd/braava_original.png 1139w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;My assumption is that when it mops the floor, the wheels are becoming wet. This slight amount of water and slippery left-over from the cleaner is accumulating in the little wheel slots you see marked above. That then causes traction issues the next time it wants to leave the base.&lt;/p&gt;
&lt;h1 id=&quot;the-fix&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-fix&quot; aria-label=&quot;the fix permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Fix&lt;/h1&gt;
&lt;p&gt;Effectively this issue also goes away by constantly cleaning the base and so making sure that there is no residue of slippery stuff in there. But since I’m a super lazy person (I mean, that’s why I bought it in the first place), I came up with this little fix:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6531d95eb6249912c11f2d13d77d4ae9/a76d6/braava_fixed.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 74.68354430379746%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAPABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAYBBQgJ/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgME/9oADAMBAAIQAxAAAAGyedYyHwlHUx0//8QAHBAAAQQDAQAAAAAAAAAAAAAABAACAwUBBgcS/9oACAEBAAEFAtc5+RckX/OL+EPMM7VrzBYKU0pyP84N/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQIQ/9oACAEDAQE/AbXP/8QAHBEAAQMFAAAAAAAAAAAAAAAAAQACEQNBUZGx/9oACAECAQE/AabQGgZgzriuv//EACMQAAICAQQCAgMAAAAAAAAAAAECAxEEAAUSIRMxFEEGIlH/2gAIAQEABj8CcNJk4GNhspnzduyZUyEkrkseLOCrY84QcvOlvDaUrXrKOz/nW/5svhcQbfv8ey7vDkMbVYGzMzbPlQBlupVctHYI/b0FZ0DKOJvme16PYDA9j3fesL4TclMQllYqyu+TKOWQz2BbeS1FWvBVCmhr7HYuvsX2NZagUEyclAB6pciQfzX/xAAZEAEBAQEBAQAAAAAAAAAAAAABEQAhMUH/2gAIAQEAAT8hQmaHvqoIyaphOMyxAqMBczJu8U4NVm3WTl/V7iRzrhnv4qkSQwU6MLS4EnolzE4IAAsAgAAN/9oADAMBAAIAAwAAABB83//EABsRAQACAwEBAAAAAAAAAAAAAAERIQBBUTFx/9oACAEDAQE/EDrSGtxfKZnrunDw+Gf/xAAbEQEBAAIDAQAAAAAAAAAAAAABESFRADFhsf/aAAgBAgEBPxAGAyi6blWJA4QFgppYiDGWEYnvn3Zz/8QAGBABAQEBAQAAAAAAAAAAAAAAAREAIUH/2gAIAQEAAT8Qjrs5YSsLsu02pd1AZk92wr1AYkQ0NsARWJXSdXt2HIXrq6eyonyeA4qCeWnbgwfwUVAWAgAEIb//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;home base fixed&quot;
        title=&quot;&quot;
        src=&quot;/static/6531d95eb6249912c11f2d13d77d4ae9/828fb/braava_fixed.jpg&quot;
        srcset=&quot;/static/6531d95eb6249912c11f2d13d77d4ae9/ff44c/braava_fixed.jpg 158w,
/static/6531d95eb6249912c11f2d13d77d4ae9/a6688/braava_fixed.jpg 315w,
/static/6531d95eb6249912c11f2d13d77d4ae9/828fb/braava_fixed.jpg 630w,
/static/6531d95eb6249912c11f2d13d77d4ae9/0ede0/braava_fixed.jpg 945w,
/static/6531d95eb6249912c11f2d13d77d4ae9/a76d6/braava_fixed.jpg 1139w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Yes, toilet paper and transparent tape. It’s simple: take a sheet of toilet paper, tear it in half, fold it and put tape over it.&lt;/p&gt;
&lt;p&gt;Alternatively use a bit of cardboard, anything that keeps the hole level will work. Depending on the toilet paper you have at hand, this might also dent over time and you’ll have the same issue once again.&lt;/p&gt;
&lt;p&gt;It’s fine when it actually creates a little bump, Braava will drive over it and still charge just fine:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/b3d501782ff9063ddd07bef55879d443/braava_home.gif&quot; alt=&quot;going home&quot;&gt;&lt;/p&gt;
&lt;p&gt;Update: You might also want to checkout my new post on &lt;a href=&quot;https://blog.thomasjungblut.com/random/fixing-braava-m6-wheel-mod/&quot;&gt;modding the Braava tyres for even better grip&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Hope it helps!&lt;/p&gt;
&lt;p&gt;Cheers,&lt;br&gt;
Thomas&lt;/p&gt;</content:encoded></item><item><title><![CDATA[VirtualBox, Vagrant, WSL2 and Docker on Windows 10]]></title><description><![CDATA[I have been trying to get Docker, VirtualBox, WSL 2 working at the same time with Vagrant. Working at the same time means that they run in…]]></description><link>https://blog.thomasjungblut.com/random/virtualbox-hyperv-vagrant/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/random/virtualbox-hyperv-vagrant/</guid><pubDate>Sun, 08 Nov 2020 16:35:51 GMT</pubDate><content:encoded>&lt;p&gt;I have been trying to get &lt;a href=&quot;docker.com&quot;&gt;Docker&lt;/a&gt;, &lt;a href=&quot;http://virtualbox.org/&quot;&gt;VirtualBox&lt;/a&gt;, &lt;a href=&quot;https://en.wikipedia.org/wiki/Windows_Subsystem_for_Linux#WSL_2&quot;&gt;WSL 2&lt;/a&gt; working at the same time with &lt;a href=&quot;https://www.vagrantup.com/&quot;&gt;Vagrant&lt;/a&gt;. Working at the same time means that they run in parallel and work individually - so I’m not trying to run Docker on WSL2 to talk with something inside a VirtualBox spun-up by Vagrant.&lt;/p&gt;
&lt;p&gt;The scenario is mostly around being able to use WSL2 and Docker on the Windows 10 host machine while you provision VMs (preferably with VirtualBox) provisioned via Vagrant.&lt;br&gt;
This issue took me a couple of hours to figure out and I wanted to share a bit of the steps and issues I’ve seen.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;TL;DR; there is no ultimate fix for this issue, but a workaround&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;the-setup&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-setup&quot; aria-label=&quot;the setup permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Setup&lt;/h2&gt;
&lt;p&gt;I’m running on Win10, 19041 Build (May 2020 Update) and I have virtualization enabled in my BIOS. On top I’m running Docker (v19) with native WSL2 integration, coming from the Docker Desktop Application. The Docker Daemon is also exposed locally, so I can easily access it from my WSL2 running Ubuntu. All of these things run on top of, or through Hyper-V.&lt;/p&gt;
&lt;p&gt;Hyper-V is installed and enabled at boot time - more on that later.&lt;/p&gt;
&lt;p&gt;To make it more complicated I’m using Vagrant (2.2.10) and VirtualBox (6.1) to run some Ansible playbooks.&lt;/p&gt;
&lt;h2 id=&quot;my-virtualbox-vm-does-not-boot&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#my-virtualbox-vm-does-not-boot&quot; aria-label=&quot;my virtualbox vm does not boot permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;My VirtualBox VM does not boot…&lt;/h2&gt;
&lt;p&gt;Testing some simple Vagrant box like that:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;vagrant&quot;&gt;&lt;pre class=&quot;language-vagrant&quot;&gt;&lt;code class=&quot;language-vagrant&quot;&gt;Vagrant.configure(&amp;quot;2&amp;quot;) do |config|
  config.vm.box = &amp;quot;ubuntu/bionic64&amp;quot;
end&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Will hang forever trying to create a VM in VirtualBox.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Hold-on: we have Hyper-V installed, why isn’t Vagrant picking that as the default provider? The image doesn’t exist for Hyper-V and forcing it with &lt;code class=&quot;language-text&quot;&gt;--provider hyperv&lt;/code&gt; will tell you that it can only run with admin permissions. So it will fallback by default to &lt;code class=&quot;language-text&quot;&gt;virtualbox&lt;/code&gt; - &lt;strong&gt;sigh&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Anyways, you will see a screen like this and without any particular error message in virtualbox and its system logs:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8edfa5309e9ba76fff870e770c687221/c67d4/vbox_hangs.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABj0lEQVR42m2SR5bCQAxEmxwMmBwMxmQbFvAIDy7A/a8k+DXTMyxYyJJb3aUqSW65XNrpdLLn82m3280ul4v89Xq1+/2u3Hq9tv1+LzscDrbb7Wy73cqyLFN+NpvZZDIxV61WbTAY6GIcxzYajWQkh8OhcvhWq2XNZtO63a51Oh1ZEARWr9etUqlYLpfTv+MD+uPxsMVioWrj8dhWq5UlSSIfRZGVSiVzzunhNyMHEUcFHiARCbAEEHBss9nYfD4Xy3a7Lab4RqNhtVpNrIgBRI3jEOTj8ShgpAI6nU7lYYgCcsTkKcg7gJFbLBb/AanIBQDxXKIASazX64md72m/31ffYIUPw1CsMRQ5mguD8/ksDwhnAADmgTEewehbL/8YUgUgvx6sBKuUpqnWhBi5sIdVuVzWgPBILRQKkp/P53/WJvxtMFKgz1rABJbI5wwjZgB+OP4foxh3GKoL3mD8xO9J+oZD3ffx858isCUGmL0kZoDcQY1jJaI3EA1l7zDOaANTJsb7mMefZ34r8LTtBZfpFT0P2uQ7AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;virtualbox vm hangs&quot;
        title=&quot;&quot;
        src=&quot;/static/8edfa5309e9ba76fff870e770c687221/f058b/vbox_hangs.png&quot;
        srcset=&quot;/static/8edfa5309e9ba76fff870e770c687221/c26ae/vbox_hangs.png 158w,
/static/8edfa5309e9ba76fff870e770c687221/6bdcf/vbox_hangs.png 315w,
/static/8edfa5309e9ba76fff870e770c687221/f058b/vbox_hangs.png 630w,
/static/8edfa5309e9ba76fff870e770c687221/c67d4/vbox_hangs.png 723w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Good luck searching the internet for that kind of issue.&lt;/p&gt;
&lt;h2 id=&quot;the-workaround&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-workaround&quot; aria-label=&quot;the workaround permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Workaround&lt;/h2&gt;
&lt;p&gt;Everything hinges on a very small flag, take an elevated CMD or power shell and run:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;batch&quot;&gt;&lt;pre class=&quot;language-batch&quot;&gt;&lt;code class=&quot;language-batch&quot;&gt;&lt;span class=&quot;token command&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;bcdedit&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Under “Windows Boot Loader” at the bottom, you should see this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;batch&quot;&gt;&lt;pre class=&quot;language-batch&quot;&gt;&lt;code class=&quot;language-batch&quot;&gt;&lt;span class=&quot;token command&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;hypervisorlaunchtype&lt;/span&gt;    Auto&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is exactly what is &lt;a href=&quot;https://docs.docker.com/docker-for-windows/troubleshoot/#virtualization&quot;&gt;required to run Docker on Windows&lt;/a&gt;. So it might actually come from the Docker installer, when you decided to install it after your VirtualBox.&lt;/p&gt;
&lt;p&gt;To fix it, you simply have to turn it off:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;batch&quot;&gt;&lt;pre class=&quot;language-batch&quot;&gt;&lt;code class=&quot;language-batch&quot;&gt;&lt;span class=&quot;token command&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;bcdedit&lt;/span&gt; &lt;span class=&quot;token parameter attr-name&quot;&gt;/set&lt;/span&gt; hypervisorlaunchtype off&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and &lt;strong&gt;reboot&lt;/strong&gt;. Now Vagrant and VirtualBox should work again. The WSL2 will also continue to work.&lt;/p&gt;
&lt;p&gt;The big implication is that docker will stop working here though. It is quite vocal about it during startup and will link you to the above troubleshooting guide.&lt;/p&gt;
&lt;p&gt;How do you reverse this again? Just set the same variable to &lt;code class=&quot;language-text&quot;&gt;auto&lt;/code&gt; and &lt;strong&gt;reboot&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;batch&quot;&gt;&lt;pre class=&quot;language-batch&quot;&gt;&lt;code class=&quot;language-batch&quot;&gt;&lt;span class=&quot;token command&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;bcdedit&lt;/span&gt; &lt;span class=&quot;token parameter attr-name&quot;&gt;/set&lt;/span&gt; hypervisorlaunchtype auto&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Same implications, but in reverse: VirtualBox can’t run VMs anymore, but Docker will continue to work. The reboot makes it a bit hard to automate, but in theory you can wrap those in batch scripts.&lt;/p&gt;
&lt;h2 id=&quot;cant-i-just-uninstall-hyper-v&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#cant-i-just-uninstall-hyper-v&quot; aria-label=&quot;cant i just uninstall hyper v permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Can’t I just uninstall Hyper-V?&lt;/h2&gt;
&lt;p&gt;Yes you can, but it turns out that un-installation via Windows features will not eliminate the above boot flags. Especially if you still have WSL2 running, there are some left-overs that can’t be disabled by any other means than &lt;code class=&quot;language-text&quot;&gt;bcdedit&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Hope it helped!&lt;/p&gt;
&lt;p&gt;Cheers,
Thomas&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Minimum Cut - Stoer–Wagner algorithm]]></title><description><![CDATA[Welcome back to my first actual blogging topic of 2020, yes - I’m late and even though I have a huge backlog of video games waiting for me…]]></description><link>https://blog.thomasjungblut.com/graph/mincut/mincut/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/graph/mincut/mincut/</guid><pubDate>Sun, 18 Oct 2020 13:42:41 GMT</pubDate><content:encoded>&lt;p&gt;Welcome back to my first actual blogging topic of 2020, yes - I’m late and even though I have a huge backlog of video games waiting for me, I’m still spending some time to write this post because I struggled a lot to find good resources for this algorithm.&lt;/p&gt;
&lt;p&gt;Today is about computing the &lt;a href=&quot;https://en.wikipedia.org/wiki/Minimum_cut&quot;&gt;Minimum Cut&lt;/a&gt; of a graph using the &lt;a href=&quot;https://en.wikipedia.org/wiki/Stoer%E2%80%93Wagner_algorithm&quot;&gt;Stoer–Wagner algorithm&lt;/a&gt;. I largely follow the &lt;a href=&quot;https://refubium.fu-berlin.de/bitstream/handle/fub188/18688/1994_12.pdf?sequence=1&amp;#x26;isAllowed=y&quot;&gt;original paper published by Mechthild Stoer and Frank Wagner&lt;/a&gt; and add fancy looking pictures and explain it along with some Java code.&lt;/p&gt;
&lt;p&gt;A full implementation of the &lt;a href=&quot;https://github.com/thomasjungblut/tjungblut-graph/blob/master/src/de/jungblut/graph/partition/StoerWagnerMinCut.java&quot;&gt;Stoer-Wagner algorithm&lt;/a&gt; can be found in my &lt;a href=&quot;https://github.com/thomasjungblut/tjungblut-graph&quot;&gt;graph library&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;what-are-minimum-cuts&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#what-are-minimum-cuts&quot; aria-label=&quot;what are minimum cuts permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What are Minimum Cuts?&lt;/h2&gt;
&lt;p&gt;A Minimum Cut is a a way to partition a (weighted) graph into two disjoint graphs (a “cut”) so that the edges connecting these two graphs are of minimal weight in summation.&lt;/p&gt;
&lt;p&gt;According to the official definition in the paper, a Mincut is:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;… a nontrivial partition of the graph’s vertex set V into two parts such that the sum of the weights of the edges connecting the two parts is minimum&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;An example mincut of the graph mentioned in the paper can be seen here:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d452bc780c6cfd20d8a0204ae813c380/57dc1/mincut_result.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACFklEQVR42k2S30tTYRjHz98SESRdFXVloP2Awrt+XNZVlCRJ9mOoIYXECC/EG0EwKFTKZqZNQlEk00nTGrmTuuPc3C+dO9s5m8xjm2c7+7Tz2kUPfPm+74eHh/f98kj+HQ/rqWVKlkmlUqkKonqAn/FZsgdp7CpbZeGlgoGxOsfBhherZB6xwyKGsoix9o1S8Q9Sk6ue+646Xns6SYR3mZLf0Tx6keaRy7S5r6NF/RSDYcxYlEzvbbS2U+htNSSHWglsJUgPPUVvrSFT5Zn+u0gtn65g6/1yDwd7h7i9gzwabeDxWAPO6TtkEwHYVbGSSbIDLWgvzpLpOEN6vItUziD0xkG64zTa83Pow+1Inl+zKLEV8fxwOMyGsklMDTHz3Y1pFQS3oxBe/frq/BdykVVxX1sPEInGyG79Zm1h0u5A8gd8bKsxdhJJZFkWjWl9l6UVz3/DjgbaJS8vktdShKJxFEURLJvaxr+0IM5S+8QNkdXAXDeHRhlfZI7OyVuC9c47yKtR0LNYuk5uzInmrEd9Wcemq4u9Qhl9pp+M84JQ7vMrpMbh89z7UEvfwjPCgTgfvX00ump5MHKpmu1V1I0lSoEg5maQdPc1NMcJ9CfHSL19iByMsNPfhO44jtZ6ErXnJpI3MoUv/pViqSBWxqpYKKqP+dA4aj7xb20s4eZ+jvwPN/vyjFgROwjb9/3TVT6BaezxF6mzFzcGhR6VAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;mincut-example&quot;
        title=&quot;&quot;
        src=&quot;/static/d452bc780c6cfd20d8a0204ae813c380/f058b/mincut_result.png&quot;
        srcset=&quot;/static/d452bc780c6cfd20d8a0204ae813c380/c26ae/mincut_result.png 158w,
/static/d452bc780c6cfd20d8a0204ae813c380/6bdcf/mincut_result.png 315w,
/static/d452bc780c6cfd20d8a0204ae813c380/f058b/mincut_result.png 630w,
/static/d452bc780c6cfd20d8a0204ae813c380/57dc1/mincut_result.png 718w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;You see the two disjoint subgraphs, green on the left and orange on the right. The edges in red are the edges “on the cut”, meaning those are the ones that separate the two subgraphs. This graph has the mincut weight of 4, since the sum of the edge weights on the cut is exactly that (3+1).&lt;/p&gt;
&lt;h2 id=&quot;what-are-some-real-life-applications-for-it&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#what-are-some-real-life-applications-for-it&quot; aria-label=&quot;what are some real life applications for it permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What are some real-life applications for it?&lt;/h2&gt;
&lt;p&gt;The paper gives a nice introduction to it:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Graph connectivity is one of the classical subjects in graph theory, and has many practical applications, e.g. in chip and circuit design, reliability of communication networks, transportation planning and cluster analysis.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Before deep learning became good at it, it was used in image segmentation along with spectral clustering and it’s being used in detecting bottlenecks in any kind of flow networks.&lt;/p&gt;
&lt;p&gt;As a real-life example, think of a transportation network that connects two cities and they are only connected via two fairly narrow roads - like our example graph above. A min-cut could partition the (transportation) graph into the two disjoint subsets (cities) and detect the narrow roads as the edges that separate them according to some weighting schema (eg. the narrowness of the road or the speed limit on such a road).&lt;/p&gt;
&lt;h2 id=&quot;the-intuition-of-the-algorithm&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-intuition-of-the-algorithm&quot; aria-label=&quot;the intuition of the algorithm permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The intuition of the algorithm&lt;/h2&gt;
&lt;p&gt;We’ll dive into the exact algorithm below, but I wanted to give a bit of insight on how this algorithm works. The crucial observation that is behind the algorithm is very similar to &lt;a href=&quot;https://en.wikipedia.org/wiki/Prim%27s_algorithm&quot;&gt;Prims algorithm&lt;/a&gt;, which is finding the Minimum Spanning Tree (MST).  Prim works by starting at any vertex, always adding the next minimal edge in the graph until all vertices are connected.&lt;/p&gt;
&lt;p&gt;Stoer-Wagner is basically the same in reverse: we’re taking the full graph and starting at any vertex and doing a &lt;code class=&quot;language-text&quot;&gt;maximum adjacency search&lt;/code&gt; which results in finding two vertices &lt;code class=&quot;language-text&quot;&gt;s&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt;. Those are the last two vertices we found during the search - don’t worry we’ll explain the search in detail below.&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;s&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt; are then merged into one vertex, effectively &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt; will be removed from the graph and its edges will then transfer to &lt;code class=&quot;language-text&quot;&gt;s&lt;/code&gt; (summing the weights in case both pointed to the same vertex). &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt; is kept as part of our first partition and we keep track of the &lt;code class=&quot;language-text&quot;&gt;cut weight&lt;/code&gt; of &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now doing this dance recursively, we find ourself growing our partition (all the &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt;’s gathered so far) and a shrinking graph (as we’re constantly removing &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt;’s). Inevitably we end up with a graph that only has two vertices, which we are merging into one and this is where we stop the algorithm. While we’re doing this, we keep track of the partitions that had the smallest &lt;code class=&quot;language-text&quot;&gt;cut weight&lt;/code&gt; so far. This smallest &lt;code class=&quot;language-text&quot;&gt;cut weight&lt;/code&gt; set of &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt;’s at the end is our first partition and the remainder of the vertices in that graph is our second partition.&lt;/p&gt;
&lt;p&gt;Voilá, you cut the graph in half with minimal weights between.&lt;/p&gt;
&lt;h2 id=&quot;the-formal-algorithm&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-formal-algorithm&quot; aria-label=&quot;the formal algorithm permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The formal algorithm&lt;/h2&gt;
&lt;p&gt;Formally the paper defines a &lt;code class=&quot;language-text&quot;&gt;MinimumCutPhase&lt;/code&gt; and a function &lt;code class=&quot;language-text&quot;&gt;MinimumCut&lt;/code&gt; that makes use of the former.&lt;/p&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;MinimumCutPhase&lt;/code&gt; (aka “Maximum Adjacency Search”) looks like this in pseudo code, given a Graph &lt;code class=&quot;language-text&quot;&gt;G&lt;/code&gt; and a starting node &lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;MinimumCutPhase(G, a):
  A &amp;lt;- {a}
  while A != V:
    add to A the most tightly connected vertex
  return s, t, and the cut weight as the &quot;cut of the phase&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As described earlier, we’re constantly adding the vertices to the set that are the most &lt;code class=&quot;language-text&quot;&gt;tightly connected&lt;/code&gt; (our &lt;code class=&quot;language-text&quot;&gt;s&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt;, found by &lt;code class=&quot;language-text&quot;&gt;Maximum Adjacency Search&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Then to wrap it up, we define &lt;code class=&quot;language-text&quot;&gt;MinimumCut&lt;/code&gt; of the Graph &lt;code class=&quot;language-text&quot;&gt;G&lt;/code&gt; as:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;MinimumCut(G):
  minimum cut = nil
  while |V| &gt; 1:
    choose any a from V
    cut of the phase = MinimumCutPhase(G, a)
    if the &quot;cut of the phase&quot; cut is lighter than the current minimum cut:
      minimum cut = cut of the phase
    shrink G by merging the two vertices from the &quot;cut of the phase&quot; (s, t)
  return the minimum cut&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Each &lt;code class=&quot;language-text&quot;&gt;MinimumCutPhase&lt;/code&gt; will shrink our graph and stores the best cuts we have seen so far, always merging &lt;code class=&quot;language-text&quot;&gt;s&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt; from our &lt;code class=&quot;language-text&quot;&gt;cut of the phase&lt;/code&gt; as we go along. This works on graphs with positive weights and always needs at least connected two vertices, otherwise we couldn’t partition it into two.&lt;/p&gt;
&lt;p&gt;Note: the definitions are simplified and hopefully a bit clearer compared to the ones found in the paper.&lt;/p&gt;
&lt;h2 id=&quot;maximum-adjacency-search&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#maximum-adjacency-search&quot; aria-label=&quot;maximum adjacency search permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Maximum Adjacency Search&lt;/h2&gt;
&lt;p&gt;Now as we figured, the most central part of the algorithm is the &lt;code class=&quot;language-text&quot;&gt;Maximum Adjacency Search&lt;/code&gt;. Despite it being described in literature with different names all the time, there is a &lt;a href=&quot;https://www.boost.org/doc/libs/1_66_0/libs/graph/doc/maximum_adjacency_search.html&quot;&gt;good C++ implementation with academic references in Boost&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The intuition is that we want to traverse the graph in order of its maximum weight towards the set of vertices we have found so far - let’s call it the &lt;code class=&quot;language-text&quot;&gt;foundSet&lt;/code&gt;. The &lt;code class=&quot;language-text&quot;&gt;foundSet&lt;/code&gt; at the beginning is initialized with any vertex in that graph. In the remainder of the graph we proceed to search for the next vertex, which has the largest sum of weights towards the &lt;code class=&quot;language-text&quot;&gt;foundSet&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This vertex is then removed from the graph and added to the &lt;code class=&quot;language-text&quot;&gt;foundSet&lt;/code&gt;. This goes on until there are no more vertices in that graph to search. The order in which the vertices are added in that &lt;code class=&quot;language-text&quot;&gt;foundSet&lt;/code&gt; is important, as the last two vertices are our &lt;code class=&quot;language-text&quot;&gt;s&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt; and the last sum will be the &lt;code class=&quot;language-text&quot;&gt;cut weight&lt;/code&gt; of the respective &lt;code class=&quot;language-text&quot;&gt;cut of the phase&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Let’s dive into some code to clarify, given a simple graph interface that gives us the following methods:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;
&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Graph&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;   
    &lt;span class=&quot;token comment&quot;&gt;// the unique identifiers of the vertices in that graph&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getVertexIDSet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// returns the edge between a source vertex ID and a destination ID.&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Edge includes the weights, returns null if there is no edge&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Edge&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getEdge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; source&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; destination&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// used later, but just a nicer way to put &apos;getVertexIDSet().size()&apos;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getNumVertices&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The algorithm in Java looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;CutOfThePhase&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;maximumAdjacencySearch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Graph&lt;/span&gt; g&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; g&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getVertexIDSet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;iterator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; foundSet &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ArrayList&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Collections&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;singletonList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;start&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; cutWeight &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ArrayList&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; candidates &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashSet&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;g&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getVertexIDSet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    candidates&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;start&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;candidates&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; maxNextVertex &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; maxWeight &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;MIN_VALUE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; next &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; candidates&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; weightSum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; s &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; foundSet&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token class-name&quot;&gt;Edge&lt;/span&gt; edge &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; g&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getEdge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;next&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;edge &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    weightSum &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; edge&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getWeight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;weightSum &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; maxWeight&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                maxNextVertex &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                maxWeight &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; weightSum&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        candidates&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;maxNextVertex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        foundSet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;maxNextVertex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        cutWeight&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;maxWeight&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// we take the last two vertices in foundSet and their weight as a cut of the phase&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; n &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; foundSet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CutOfThePhase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// that&apos;s &quot;s&quot; in the literature and will remain as a merged vertex with &quot;t&quot;&lt;/span&gt;
            foundSet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;n &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
            &lt;span class=&quot;token comment&quot;&gt;// that&apos;s &quot;t&quot; and will be removed afterwards&lt;/span&gt;
            foundSet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;n &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
            &lt;span class=&quot;token comment&quot;&gt;// that&apos;s &quot;w&quot; to compute the minimum cut on later&lt;/span&gt;
            cutWeight&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cutWeight&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you read it, you may find it very similar to Depth-First-Search (DFS) - but instead of taking any vertex as the next step, we find the one that has the largest incoming edge weights to our already traversed vertices. This also reminds of Prims algorithm again, which greedily picks the next edge to construct the MST.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;⚠️ Premature Optimization Warning&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In Java you might want to optimize this O(n^2) search loop with a &lt;code class=&quot;language-text&quot;&gt;java.util.PriorityQueue&lt;/code&gt; and I’ve seen several implementation on the internet doing it. While correct and possible, in reality this requires you to remove and add the element again (which is a linear search to remove and a heap addition, so O(n) + O(log n) = O(n)), which is considerably slower than just a traditional &lt;code class=&quot;language-text&quot;&gt;down-heap&lt;/code&gt; operation and even slower than a linear search. Please use a specifically constructed Heap that implements this behaviour - for example &lt;a href=&quot;https://github.com/apache/hadoop/blob/a55d6bba71c81c1c4e9d8cd11f55c78f10a548b0/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/PriorityQueue.java&quot;&gt;org.apache.hadoop.util.PriorityQueue&lt;/a&gt; with its &lt;code class=&quot;language-text&quot;&gt;adjustTop&lt;/code&gt; method (which I believe originated in Apache Lucene).&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;If you were to run this algorithm, starting with vertex &lt;code class=&quot;language-text&quot;&gt;2&lt;/code&gt; in red:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9c6829312f66de4046f623544aad4335/e9beb/adjacency_search.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.34177215189873%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB4klEQVR42j2P7UtTARTG7+egv6C+BdV/EARFVEJkUfsmBEF9KCQtYsmqDwbSF4VAoyAqNJQonbOlbYm96HQGbWtbuDnc7rbb7l5qb+61rbV7f91t5IFzOPx4zsN5hBWXRHffS7quTjI2uU66UqY6N4t68ADK3j00DLdIFwtkf+UIJNwMf7jCoKWHV64HZDS2FppnaPEi96wXWA6ZEMbNHvadGWP/uUdcujODXC6RGNCjCgJoXTt8CFGWiEXiLHmN9JtOcM14jPvvL5OMp3j6eYjemSP0Th9lyjGMdgV2VwjTopOmoiLHYmyKIYq2ZaTnz1BrVVRNo6qtCX7Jje27lSYN4nKCYHALT3idL76PLVXHsJCPEJMcZPMVNjb87cNEIYdD7Owts/+GciKGGA1SKpTxerxtFotLbIUC7V1oyBMoq7thbRc/7Tq2c7+xBy3cnddhMJ9l6usImXSGXDqPK2xj0NqD3nyakXfXNW2BJf9rDG/PM6BpF3zjCPXIKMon7dEVgYZPR1RMsvDtBTdMXfQZj/PYdptIJKrxH6xuWtC/6W7zhzY9YjDMrPMJN+dO0W88ybR7tBOZqvZuyYmq1OkEg1RRIpr102jWd2K3KltJIeUC/Plb2+HJQpT4toiiNvkHEELLkWpHXjQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;adjacency_search&quot;
        title=&quot;&quot;
        src=&quot;/static/9c6829312f66de4046f623544aad4335/f058b/adjacency_search.png&quot;
        srcset=&quot;/static/9c6829312f66de4046f623544aad4335/c26ae/adjacency_search.png 158w,
/static/9c6829312f66de4046f623544aad4335/6bdcf/adjacency_search.png 315w,
/static/9c6829312f66de4046f623544aad4335/f058b/adjacency_search.png 630w,
/static/9c6829312f66de4046f623544aad4335/e9beb/adjacency_search.png 730w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;You will visit the vertices in that order:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;2, 3, 4, 7, 8, 6, 5 (becomes s), 1 (becomes t)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;and the cut weight of 5, as the summation of 2 (coming from vertex 2) plus 3 (coming from vertex 5).&lt;br&gt;
So as the result we return &lt;code class=&quot;language-text&quot;&gt;s=5&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;t=1&lt;/code&gt; and the cut-weight as &lt;code class=&quot;language-text&quot;&gt;5&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now let’s go one level higher to tie this into the actual &lt;code class=&quot;language-text&quot;&gt;MinCut&lt;/code&gt; algorithm.&lt;/p&gt;
&lt;h2 id=&quot;finding-the-mincut&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#finding-the-mincut&quot; aria-label=&quot;finding the mincut permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Finding the MinCut&lt;/h2&gt;
&lt;p&gt;We can now use the Maximum Adjacency Search to compute the &lt;code class=&quot;language-text&quot;&gt;MinCut&lt;/code&gt;, here again with Java and our Graph interface:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; currentPartition &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashSet&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; currentBestPartition &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;CutOfThePhase&lt;/span&gt; currentBestCut &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;g&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getNumVertices&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;CutOfThePhase&lt;/span&gt; cutOfThePhase &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;maximumAdjacencySearch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;g&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;currentBestCut &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; cutOfThePhase&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;weight &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; currentBestCut&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;weight&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        currentBestCut &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; cutOfThePhase&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        currentBestPartition &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashSet&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;currentPartition&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        currentBestPartition&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cutOfThePhase&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    currentPartition&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cutOfThePhase&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// merge s and t and their edges together&lt;/span&gt;
    g &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mergeVerticesFromCut&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;g&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cutOfThePhase&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// currentBestPartition now contains our first partition.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Similar to the pseudo-code, we try to find the best &lt;code class=&quot;language-text&quot;&gt;cut of the phase&lt;/code&gt; and merge the graph until we converge on a single merged vertex.&lt;/p&gt;
&lt;p&gt;As you can see, &lt;code class=&quot;language-text&quot;&gt;mergeVerticesFromCut&lt;/code&gt; is not defined and I leave it up to you to implement as homework. I want to leave a couple of pictures from the paper however as they explain pretty well what needs to be done. Let’s take the output from the Maximum Adjacency Search above:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9c6829312f66de4046f623544aad4335/e9beb/adjacency_search.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.34177215189873%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB4klEQVR42j2P7UtTARTG7+egv6C+BdV/EARFVEJkUfsmBEF9KCQtYsmqDwbSF4VAoyAqNJQonbOlbYm96HQGbWtbuDnc7rbb7l5qb+61rbV7f91t5IFzOPx4zsN5hBWXRHffS7quTjI2uU66UqY6N4t68ADK3j00DLdIFwtkf+UIJNwMf7jCoKWHV64HZDS2FppnaPEi96wXWA6ZEMbNHvadGWP/uUdcujODXC6RGNCjCgJoXTt8CFGWiEXiLHmN9JtOcM14jPvvL5OMp3j6eYjemSP0Th9lyjGMdgV2VwjTopOmoiLHYmyKIYq2ZaTnz1BrVVRNo6qtCX7Jje27lSYN4nKCYHALT3idL76PLVXHsJCPEJMcZPMVNjb87cNEIYdD7Owts/+GciKGGA1SKpTxerxtFotLbIUC7V1oyBMoq7thbRc/7Tq2c7+xBy3cnddhMJ9l6usImXSGXDqPK2xj0NqD3nyakXfXNW2BJf9rDG/PM6BpF3zjCPXIKMon7dEVgYZPR1RMsvDtBTdMXfQZj/PYdptIJKrxH6xuWtC/6W7zhzY9YjDMrPMJN+dO0W88ybR7tBOZqvZuyYmq1OkEg1RRIpr102jWd2K3KltJIeUC/Plb2+HJQpT4toiiNvkHEELLkWpHXjQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;adjacency_search&quot;
        title=&quot;&quot;
        src=&quot;/static/9c6829312f66de4046f623544aad4335/f058b/adjacency_search.png&quot;
        srcset=&quot;/static/9c6829312f66de4046f623544aad4335/c26ae/adjacency_search.png 158w,
/static/9c6829312f66de4046f623544aad4335/6bdcf/adjacency_search.png 315w,
/static/9c6829312f66de4046f623544aad4335/f058b/adjacency_search.png 630w,
/static/9c6829312f66de4046f623544aad4335/e9beb/adjacency_search.png 730w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Now the algorithm states, we have to merge &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt; into &lt;code class=&quot;language-text&quot;&gt;s&lt;/code&gt;. The result looks like this:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ab5627bccebdff14b54091e686c198cd/f8067/merge_easy.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 34.810126582278485%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAByklEQVR42lWR22sTURjE8+d4F/8FwReFPiiC9CJF9EEEi1DU+qKlKFbx8mBRjIWYWGkxxSoEW0S0aWNIQK2SZDe7ya7SJprY3HZtkr1kf27WVvTAMDBzmG/Od3z8exzHIzufw7owjHnuLB0hjd3VTBu9XSOSCjD94S7Kego6UKgrzK5M8PzzA37qRXz/Bdo23UhrcADH51ou9AP7SeUk5IxCMHqTvtBOBqf2MTJ3hHxW5cbCGfpDuxgI7WHy/agb2G3luKMc22OtbSCFZ2j2HqXWcwhr6R3Njo3ZMihpq0wlbjHx5hJCOcmG1uJ18iWTsTH8i6MUGvk/DZ3Np1ZrdZaXYximSaPRIJUR2PK37vwollBVFdOwiMfjLptUKhUkUfZ8H1oSxBM44knklTCGAWVNJRQfx//2MqtV8e9Gqs0STxN38EevsJCc9RoW9TyB2DUeLY5tNvx4EF75POiJHiS5wO35IXofb+f4k71cjZwiK2aRBYVAdJxjwW30B3dzce4wivSN65HT9AV3eNr9pRE3cCMNuWFQzmP/Emi3HL7Xv3q/Fv50j7VaHtvqYLi71VpV5jMhnrm6sp7GbNsU6yovvjx04aesr/EbdiDWzbe2RUMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;merge_easy&quot;
        title=&quot;&quot;
        src=&quot;/static/ab5627bccebdff14b54091e686c198cd/f058b/merge_easy.png&quot;
        srcset=&quot;/static/ab5627bccebdff14b54091e686c198cd/c26ae/merge_easy.png 158w,
/static/ab5627bccebdff14b54091e686c198cd/6bdcf/merge_easy.png 315w,
/static/ab5627bccebdff14b54091e686c198cd/f058b/merge_easy.png 630w,
/static/ab5627bccebdff14b54091e686c198cd/f8067/merge_easy.png 726w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;We have one edge in common between &lt;code class=&quot;language-text&quot;&gt;s&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt;, that is (5,2) and that will inherit the summation of weights (2+2=4). The edge between &lt;code class=&quot;language-text&quot;&gt;s&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt; is dropped.&lt;/p&gt;
&lt;p&gt;The other case is when an edge has to be transferred (as there is no other to sum it with), below to images illustrate this behaviour:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 564px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/478c19a5104b6b6cafec61cdade6e065/ba4d9/merge_mas_transfer.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 44.93670886075949%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACRUlEQVR42jWS3UtTcRjHz7W9/AFB10V3UV1EQVpWGlF0l90lhJFSiCV0kUJQXVQTGliY2Itp4qwcmkXLFzLddiYuzzTn28ayvahz47hJNs85n347J3/w4/vw+z3Pl+/zfR4JceaWJ+iZbMEV7CCZjYEBOU1DV9Pkmp6Su11L7oMDXdvMf6EJNE8uAYs2WLgFSSf5Qmky5uZaZyFVnSeo6DhC/ccy/AEffiXARulJkCSMggITU7U1KOEQssdLaD5IanA/hkuCoW2Qx99PkGaWxql+V0JN9xlBfIx7n8v5FQuzqqqkS4ox8oQ7d5iE6t06omsq8WiMRDxKZrQQY0AQDW+HfoHxFqS88vhamBeuRwwG35PZSGPoBguRCH6fTOZlM+HKq+Rcn9AN3WpVtGaYmEWdbSTqqRahx3yTtpKGv42QzWbNWJZlPG63GatCqcc3ZiYbIte6Brpu1YVCERRFMWNd+G4pzIR5NWBjeN7JuPBvZnrW8lzbYDTYS+vXh2Jw4yaZqc/4r+/PJm09Xh4860WZS1hDsTwsNT2s6jrOne5LxJYXSa2mef69nkpHETedZ6kUg+ubaCWVVFlaThBPLFF1v5d9Fxo5UNbE3vN2nINBpICYckXHUVFQxJW3h6nru4jsd+OTx7D1X6e87RA3uk5zuf0gb0YamFKm8Xo9TP2cpqy2k92nGthzzs6u4se09ylWy/MrYg8DzXwJtpNct/ZQ29TI/lUZmHXg8NuRIy403dq/Lf9W0uu09vzA9nqUIV/YfPsHIYlO5C2mVj4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;merge_mas_transfer&quot;
        title=&quot;&quot;
        src=&quot;/static/478c19a5104b6b6cafec61cdade6e065/ba4d9/merge_mas_transfer.png&quot;
        srcset=&quot;/static/478c19a5104b6b6cafec61cdade6e065/c26ae/merge_mas_transfer.png 158w,
/static/478c19a5104b6b6cafec61cdade6e065/6bdcf/merge_mas_transfer.png 315w,
/static/478c19a5104b6b6cafec61cdade6e065/ba4d9/merge_mas_transfer.png 564w&quot;
        sizes=&quot;(max-width: 564px) 100vw, 564px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Here we have to merge 3 into 7, that means that the edge (3,2) need to be transferred to the former vertex 7:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 547px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7784dfccb4a827673942339bc703f27d/977f7/merge_mas_transfer_result.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.202531645569614%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACKklEQVR42nWSW0iTcRjGv7oKu6igq+6CbroJjPAiXVdd1DLoqi6iE9JhN2FZESHUqBCho0hGZmlaTfOwJqNUNg+t6damxHQecmv5KbpyuM3DDt/h1/YpdJMvvP8/vM/L8z7vyyOE4yL17nKedBdTO3CfufgvpKREEhWpw0q68BCSLp/0rRvI8ShaqCrrhfDIfplTdXsoaTvC2YZcjJbTOPrduNrNKNu3ZToE1C1btV+6dweNSpbXJ7SPf+CauZDr5qNcbdPzabhOA5ZjC8weyIeNG2BzDos5m5huWMWkZEb/OiqF7CNGAjTZapiKTGrFWDSK0+UmNCOy3GdjsOwuyVkRt8/HoNdLOBzWCJVMysq/1AizgJSScTqdSJJEIpHAarUiiqLWEI/H+PK1f22+qtV7ursJBIP/VSmspJdw/LRQ8fkmnf739Dl7iC7ENDC8KNLqqaKqs5TvM30ZFau3UxSF8bFReh1uqluHuP3MTnPXCKm0jFDTb+RM/V5KPuo593YfDzuKCf4I4fW5KG0/zgXTfkrMeore5dEy8IKx4Ql8wz4mJwPoDa/YqX9K7onn7Dj4gPLXDgST9zEXTQVcaTnMpcYC3rjKEEMzTAT9lHUVYTDpNMzQqMM20syfuUhm3QDz8/OcN1rYfaySvJPV7CqsoKrpG4KkpBma7sU6Uotnyk5aTmkrZf2xsPKbrAssvpeMznnWLKiu4tn7LqVotfmpNLno9YQydZW/krxWZPCfhegAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;merge_mas_transfer&quot;
        title=&quot;&quot;
        src=&quot;/static/7784dfccb4a827673942339bc703f27d/977f7/merge_mas_transfer_result.png&quot;
        srcset=&quot;/static/7784dfccb4a827673942339bc703f27d/c26ae/merge_mas_transfer_result.png 158w,
/static/7784dfccb4a827673942339bc703f27d/6bdcf/merge_mas_transfer_result.png 315w,
/static/7784dfccb4a827673942339bc703f27d/977f7/merge_mas_transfer_result.png 547w&quot;
        sizes=&quot;(max-width: 547px) 100vw, 547px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Again the edge between &lt;code class=&quot;language-text&quot;&gt;s&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt; is dropped.&lt;br&gt;
That is everything you need to pay attention to when implementing such merge.&lt;/p&gt;
&lt;h2 id=&quot;reconstructing-the-graphs&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reconstructing-the-graphs&quot; aria-label=&quot;reconstructing the graphs permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reconstructing the graphs&lt;/h2&gt;
&lt;p&gt;If you followed the above implementation closely, the set of vertex identifiers in our first partition is not really an interesting result. Ideally the result should be two new disjoint graphs (the partitions) and the actual edges that were on the cut of the graph, including their weight.&lt;/p&gt;
&lt;p&gt;Given the original graph, the best cut of the phase and the first partition, we can construct a meaningful result in not-quite-Java:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MinCutResult&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Graph&lt;/span&gt; first&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Graph&lt;/span&gt; second&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Edge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; edgesOnTheCut&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MinCutResult&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;constructMinCutResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Graph&lt;/span&gt; originalGraph&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;token class-name&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; partition&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;token class-name&quot;&gt;CutOfThePhase&lt;/span&gt; bestCut&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token class-name&quot;&gt;Graph&lt;/span&gt; first &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Graph&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Graph&lt;/span&gt; second &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Graph&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Edge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; cuttingEdges &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ArrayList&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; cutWeight &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; v &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; originalGraph&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getVertexIDSet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;partition&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            first&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addVertex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vertex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            second&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addVertex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vertex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;    

    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Edge&lt;/span&gt; e &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; originalGraph&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getEdges&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;first&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;source&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; first&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;destination&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            first&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEdge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Edge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;source&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;destination e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;weight&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;second&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;source&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; second&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;destination&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            second&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEdge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Edge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;source&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;destination&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;weight&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            cuttingEdges&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Edge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;source&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;destination&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;weight&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            cutWeight &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; weight&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MinCut&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;first&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; second&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cuttingEdges&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cutWeight&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It works in two steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;iterating over the set of vertices in the original graph: partition into the two subgraphs by checking what vertices our algorithm assigned to the first partition. If a vertex is not part of that partition, it must be in the second subgraph.&lt;/li&gt;
&lt;li&gt;iterating over the set of edges in the original graph: if both source and destination vertex are both in a graph, add it to the respective graph. Otherwise it must be an edge on the cut.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;And that’s it!&lt;/p&gt;
&lt;h2 id=&quot;full-code&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#full-code&quot; aria-label=&quot;full code permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Full Code&lt;/h2&gt;
&lt;p&gt;As already stated in the beginning, the full implementation of the &lt;a href=&quot;https://github.com/thomasjungblut/tjungblut-graph/blob/master/src/de/jungblut/graph/partition/StoerWagnerMinCut.java&quot;&gt;Stoer-Wagner algorithm&lt;/a&gt; can be found in my &lt;a href=&quot;https://github.com/thomasjungblut/tjungblut-graph&quot;&gt;graph library&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Don’t be scared by the generics, it’s fairly simple if you can just drag it back into strings and integers. As always, a good start are &lt;a href=&quot;https://github.com/thomasjungblut/tjungblut-graph/blob/master/test/de/jungblut/graph/partition/StoerWagnerMinCutTest.java&quot;&gt;the test cases&lt;/a&gt;. Otherwise feel free to reach out to me, I’m happy to help if you have any questions.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Back to Blogging - 2020 Edition]]></title><description><![CDATA[Exactly four years (!) after my last post, I finally have found some motivation to bring my blog alive again. Of course, this comes with a…]]></description><link>https://blog.thomasjungblut.com/random/2020-blogging/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/random/2020-blogging/</guid><pubDate>Fri, 16 Oct 2020 22:18:56 GMT</pubDate><content:encoded>&lt;p&gt;Exactly four years (!) after my last post, I finally have found some motivation to bring my blog alive again.&lt;/p&gt;
&lt;p&gt;Of course, this comes with a for 2020 typical JavaScript single page app with React and &lt;a href=&quot;https://www.gatsbyjs.com/&quot;&gt;GatsbyJS&lt;/a&gt; - apologies in advance, I wanted to try an alternative to AngularJS and I’m sure I will also regret this myself in two to three years time.&lt;/p&gt;
&lt;p&gt;Sadly, Blogger wasn’t getting too much attention from Google anymore and I felt the experience was terrible: both for me a writer and most likely also for the readers. Putting syntax highlighted code on there was always difficult and relying on 3rd party JS that always broke after some time, so having Markdown now will hopefully help in getting the content across in a leaner and longer lasting format.&lt;/p&gt;
&lt;p&gt;I wanted to quickly thank &lt;a href=&quot;https://github.com/palaniraja&quot;&gt;palaniraja&lt;/a&gt; that created this wonderful &lt;a href=&quot;https://github.com/palaniraja/blog2md&quot;&gt;blog2md&lt;/a&gt; script to export hosted blogs and convert them into Markdown. I used this to copy all the content over to this site and with very little adjustment I could have all my posts in here.&lt;/p&gt;
&lt;p&gt;Since this site touts itself as a tech blog, you can find the whole source code in &lt;a href=&quot;https://github.com/thomasjungblut/thomasjungblut.com&quot;&gt;my repo here&lt;/a&gt;. This contains it end2end, from committing content and site adjust to &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt; and having GitHub actions to deploy it straight into the &lt;code class=&quot;language-text&quot;&gt;gh-pages&lt;/code&gt; branch.&lt;/p&gt;
&lt;p&gt;I’m going to start with one technical blog post tomorrow, that will explain the &lt;code class=&quot;language-text&quot;&gt;Stoer–Wagner algorithm&lt;/code&gt; in a step-by-step fashion. This algorithm is a graph algorithm used to determine the &lt;code class=&quot;language-text&quot;&gt;Minimum Cut&lt;/code&gt; of a graph. Before deep learning it was used in image segmentation, spectral clustering and it’s being used in detecting bottlenecks in any kind of flow networks.&lt;/p&gt;
&lt;p&gt;I implemented it as part of the &lt;a href=&quot;http://hacktoberfest.digitalocean.com/&quot;&gt;Hacktoberfest&lt;/a&gt; two weeks ago in my own and old &lt;a href=&quot;https://github.com/thomasjungblut/tjungblut-graph/blob/master/src/de/jungblut/graph/partition/StoerWagnerMinCut.java&quot;&gt;graph library&lt;/a&gt;, but I struggled a lot to find great resources outside of original academic paper and a badly written Wikipedia article.&lt;/p&gt;
&lt;p&gt;Cheers,&lt;br&gt;
Thomas&lt;/p&gt;</content:encoded></item><item><title><![CDATA[XGBoost bayesian hyperparameter tuning with bayes_opt in Python]]></title><description><![CDATA[Hey guys, I just wanted to quickly share how I was optimizing hyperparameters in XGBoost using bayes_opt. It does a k-fold cross validation…]]></description><link>https://blog.thomasjungblut.com/blogger/xgboost-bayesian-hyperparameter-tuning/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/xgboost-bayesian-hyperparameter-tuning/</guid><pubDate>Sat, 15 Oct 2016 12:23:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey guys,&lt;/p&gt;
&lt;p&gt;I just wanted to quickly share how I was optimizing hyperparameters in XGBoost using &lt;a href=&quot;https://github.com/fmfn/BayesianOptimization&quot;&gt;bayes_opt&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; bayes_opt &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; BayesianOptimization
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; sklearn&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cross_validation &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; KFold
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; xgboost &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; xgb

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;xgbCv&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;train&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; features&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; numRounds&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; eta&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; gamma&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; maxDepth&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; minChildWeight&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; subsample&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; colSample&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;   
   &lt;span class=&quot;token comment&quot;&gt;# prepare xgb parameters &lt;/span&gt;
   params &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;objective&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;reg:linear&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;booster&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;gbtree&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;eval_metric&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mae&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;            
            &lt;span class=&quot;token string&quot;&gt;&quot;tree_method&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;auto&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;silent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;eta&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; eta&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
            &lt;span class=&quot;token string&quot;&gt;&quot;max_depth&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;maxDepth&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;min_child_weight&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; minChildWeight&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;subsample&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; subsample&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
            &lt;span class=&quot;token string&quot;&gt;&quot;colsample_bytree&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; colSample&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;             
            &lt;span class=&quot;token string&quot;&gt;&quot;gamma&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; gamma
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
   
   cvScore &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; kFoldValidation&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;train&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; features&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; params&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;numRounds&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nFolds &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;CV score: {:.6f}&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cvScore&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 
   &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; cvScore   &lt;span class=&quot;token comment&quot;&gt;# invert the cv score to let bayopt maximize&lt;/span&gt;
   
&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bayesOpt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;train&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; features&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
   ranges &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;            
              &lt;span class=&quot;token string&quot;&gt;&apos;numRounds&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token string&quot;&gt;&apos;eta&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.001&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token string&quot;&gt;&apos;gamma&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token string&quot;&gt;&apos;maxDepth&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token string&quot;&gt;&apos;minChildWeight&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token string&quot;&gt;&apos;subsample&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token string&quot;&gt;&apos;colSample&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
   
   &lt;span class=&quot;token comment&quot;&gt;# proxy through a lambda to be able to pass train and features&lt;/span&gt;
   optFunc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;lambda&lt;/span&gt; numRounds&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; eta&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; gamma&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; maxDepth&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; minChildWeight&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; subsample&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; colSample&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; xgbCv&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;train&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; features&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; numRounds&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; eta&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; gamma&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; maxDepth&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; minChildWeight&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; subsample&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; colSample&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   bo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; BayesianOptimization&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;optFunc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ranges&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   bo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;maximize&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;init_points &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; n_iter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; kappa &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; acq &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ei&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; xi &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   
   bestMAE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;round&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; bo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;res&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;max&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;max_val&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;\n Best MAE found: %f&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; bestMAE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;\n Parameters: %s&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; bo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;res&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;max&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;max_params&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 
&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;kFoldValidation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;train&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; features&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; xgbParams&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; numRounds&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nFolds&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; target&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;loss&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;  
   kf &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; KFold&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;train&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; n_folds &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nFolds&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; shuffle &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   fold_score&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; train_index&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cv_index &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; kf&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;# split train/validation&lt;/span&gt;
      X_train&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; X_valid &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; train&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;features&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;as_matrix&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;train_index&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; train&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;features&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;as_matrix&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cv_index&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      y_train&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y_valid &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;train&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;as_matrix&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;train_index&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;train&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;as_matrix&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cv_index&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      dtrain &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; xgb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DMatrix&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;X_train&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y_train&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 
      dvalid &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; xgb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DMatrix&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;X_valid&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y_valid&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
         
      watchlist &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dtrain&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;train&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dvalid&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;eval&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      gbm &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; xgb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;train&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;xgbParams&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dtrain&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; numRounds&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; evals &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; watchlist&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; early_stopping_rounds &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      score &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; gbm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;best_score
      fold_score&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;append&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;score&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;                

   &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; np&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mean&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fold_score&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It does a k-fold cross validation while optimizing for stable parameters.&lt;br&gt;
Keep in mind that &lt;code class=&quot;language-text&quot;&gt;bayes_opt&lt;/code&gt; maximizes the objective function, so change all the required hardcoded values along those lines to fit your problem. It’s pretty compact, so I thought I just leave it here for your convenience as a &lt;a href=&quot;https://gist.github.com/thomasjungblut/b58d70d260abf0eff1a8c447f3d07389#file-xgb_bayes_opt_cv-py&quot;&gt;gist&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Cheers,&lt;br&gt;
Thomas&lt;/p&gt;</content:encoded></item><item><title><![CDATA[XGBoost Validation and Early Stopping in R]]></title><description><![CDATA[Hey people, While using XGBoost in Rfor some Kaggle competitions I always come to a stage where I want to do early stopping of the training…]]></description><link>https://blog.thomasjungblut.com/blogger/xgboost-validation-and-early-stopping/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/xgboost-validation-and-early-stopping/</guid><pubDate>Fri, 18 Mar 2016 21:03:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey people,&lt;/p&gt;
&lt;p&gt;While using XGBoost in Rfor some Kaggle competitions I always come to a stage where I want to do early stopping of the training based on a held-out validation set.&lt;/p&gt;
&lt;p&gt;There are very little code snippets out there to actually do it in R, so I wanted to share my quite generic code here on the blog.&lt;/p&gt;
&lt;p&gt;Let’s say you have a training set in some csv and you want to split that into a 9:1 training:validation set. Here’s the naive (not stratified way) of doing it:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;r&quot;&gt;&lt;pre class=&quot;language-r&quot;&gt;&lt;code class=&quot;language-r&quot;&gt;train &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; read.csv&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;train.csv&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
bound &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; floor&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nrow&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;train&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.9&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;           
train &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; train&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;sample&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nrow&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;train&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;         
df.train &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; train&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;bound&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;                  
df.validation &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; train&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bound&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;nrow&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;train&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now before feeding it back into XGBoost, we need to create a xgb.DMatrix and remove the targets to not spoil the classifier. This can be done via this code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;r&quot;&gt;&lt;pre class=&quot;language-r&quot;&gt;&lt;code class=&quot;language-r&quot;&gt;train.y &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; df.train&lt;span class=&quot;token operator&quot;&gt;$&lt;/span&gt;TARGET  
validation.y &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; df.validation&lt;span class=&quot;token operator&quot;&gt;$&lt;/span&gt;TARGET  
  
dtrain &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; xgb.DMatrix&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;df.train&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; label&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;train.y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
dvalidation &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; xgb.DMatrix&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;df.validation&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; label&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;validation.y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So now we can go and setup a watchlist and actually start the training. Here’s some simple sample code to get you started:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;r&quot;&gt;&lt;pre class=&quot;language-r&quot;&gt;&lt;code class=&quot;language-r&quot;&gt;watchlist &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; list&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;validation&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;dvalidation&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; train&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;dtrain&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
  
param &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; list&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;  
   objective &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;binary:logistic&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
   eta &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
   max_depth &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;                  
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
  
clf &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; xgb.train&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;     
   params &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; param&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;   
   data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; dtrain&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;   
   nrounds &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;   
   watchlist &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; watchlist&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
   maximize &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;FALSE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
   early.stop.round &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here we setup a watchlist with the validation set in the first dimension of the list and the trainingset in the latter. The reason that you need to put the validation set first is that the early stopping only works on one metric - where we should obviously choose the validation set.&lt;/p&gt;
&lt;p&gt;The rest is straightforward setup of the xgb tree itself. Keep in mind that when you use early stopping, you also need to supply whether or not to maximize the chosen objective function- otherwise you might find yourself stopping very fast!&lt;/p&gt;
&lt;p&gt;Here’s the full snippet as a &lt;a href=&quot;https://gist.github.com/thomasjungblut/e60217c5b7609e4dfef3&quot;&gt;gist&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Thanks for reading,&lt;br&gt;
Thomas&lt;/p&gt;</content:encoded></item><item><title><![CDATA[MinHashing for Beginners]]></title><description><![CDATA[Due to popular demand of my MinHashing class in my common library, I decided to do a quick and dirty walkthrough of how to vectorize…]]></description><link>https://blog.thomasjungblut.com/blogger/minhashing-for-beginners/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/minhashing-for-beginners/</guid><pubDate>Thu, 05 Mar 2015 21:36:00 GMT</pubDate><content:encoded>&lt;p&gt;Due to popular demand of my MinHashing class in my common library, I decided to do a quick and dirty walkthrough of how to vectorize, MinHash and lookup your data!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;What is MinHashing good for?&lt;/strong&gt;&lt;br&gt;
MinHashing in the first place is used to speed up nearest neighbour lookups. Think of having this huge terabyte sized dataset of movie reviews and you want to find similar reviews (either for deduplication or for recommendation).&lt;/p&gt;
&lt;p&gt;Now MinHashing will give you a very small and dense representation of your data by hashing values of a vectorized representation of your data. &lt;a href=&quot;http://en.wikipedia.org/wiki/MinHash&quot;&gt;You can read more about the theory and some details behind it on Wikipedia.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example Data&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;To get some base-line data, let’s grab a dataset from Kaggle. &lt;a href=&quot;http://www.kaggle.com/c/word2vec-nlp-tutorial/data&quot;&gt;This example uses the 50k movie reviews from IMDB&lt;/a&gt;, namely the “unlabeledTrainData.tsv”. Sign-in and get the data from there- alternatively any data will do if it has the same columnar TSV style formatting, here is an example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;id review  
&quot;9999\_0&quot; &quot;Watching Time Chasers, it obvious that it was made by a bunch of friends. Maybe they were sitting around one day in film school and said, \\&quot;Hey, let&apos;s pool our money together and make a really bad movie!\\&quot; Or something like that. What ever they said, they still ended up making a really bad movie--dull story, bad script, lame acting, poor cinematography, bottom of the barrel stock music, etc. All corners were cut, except the one that would have prevented this film&apos;s release. Life&apos;s like that.&quot;  
&quot;45057\_0&quot; &quot;I saw this film about 20 years ago and remember it as being particularly nasty. I believe it is based on a true incident: a young man breaks into a nurses&apos; home and rapes, tortures and kills various women.&amp;lt;br /&gt;&amp;lt;br /&gt;It is in black and white but saves the colour for one shocking shot.&amp;lt;br /&gt;&amp;lt;br /&gt;At the end the film seems to be trying to make some political statement but it just comes across as confused and obscene.&amp;lt;br /&gt;&amp;lt;br /&gt;Avoid.&quot;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We need to do some massaging here, since there are some HTML parts in it, but for this example we can simply get away with lower casing and removing everything that isn’t alphanumeric.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Tokenization and Vectorization&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The main part here is to normalize and tokenize the data into bigrams that we can use our vectorizer to build TF-IDF or bag-of-word-frequency vectors out of it. Using my common library and Java 8 streams this looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Stream&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; lines &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;lines&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;Paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;unlabeledTrainData.tsv&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;skip&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// skip the header  &lt;/span&gt;
  
&lt;span class=&quot;token comment&quot;&gt;// normalization and bigram tokenization  &lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; documents &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; lines  
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;line&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TokenizerUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;normalizeString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;line&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;normalized&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TokenizerUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;whiteSpaceTokenizeNGrams&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;normalized&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;collect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Collectors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token comment&quot;&gt;// every token that occurs more often than 50% in the corpus and less than twice will be discarded  &lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; dict &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;VectorizerUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;buildDictionary&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;documents&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.5f&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;DoubleVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; vectors &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;VectorizerUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;wordFrequencyVectorize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;documents&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;parallel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;collect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Collectors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;MinHashing&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Now that we have the vectors, we can MinHash them.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;MinHash&lt;/span&gt; hasher &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MinHash&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;MURMUR128&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; minHashes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; vectors&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; hasher&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;minHashVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;collect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Collectors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In this case, we go for 20 minhashes and a rather strong murmur 128 bit hash. This is usually the default I try out for various text tasks.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Finding Similar Documents&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;To find similar documents, we have two ways: brute force or using an inverted index. Let’s start using brute force by finding the top five similar elements to the third (index = 2) movie review in our list.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; sourceDocIndex &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token comment&quot;&gt;// document index  &lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;LimitedPriorityQueue&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; queue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LimitedPriorityQueue&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; first &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; minHashes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sourceDocIndex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token class-name&quot;&gt;Stopwatch&lt;/span&gt; watch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Stopwatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createStarted&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; minHashes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; sourceDocIndex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; reference &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; minHashes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; similarity &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; hasher&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;measureSimilarity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;first&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reference&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;similarity &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      queue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; similarity&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  

&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Done finding similar docs in &quot;&lt;/span&gt;  
    &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; watch&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;elapsed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;TimeUnit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;MILLISECONDS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ms!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;document:&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lines&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sourceDocIndex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;queue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; similarity &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; queue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMaximumPriority&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; index &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; queue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;similarity &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot; -&gt; &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; lines&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;index&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This will output a very interesting pattern:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Done finding similar docs in 146ms!  
document:  
&quot;15561_0&quot; &quot;Minor Spoilers&amp;lt;br /&gt;&amp;lt;br /&gt;In New York, Joan Barnard (Elvire Audrey) is informed that her husband, the archeologist Arthur Barnard (John Saxon), was mysteriously murdered in Italy while searching an Etruscan tomb. Joan decides to travel to Italy, in the company of her colleague, who offers his support. Once in Italy, she starts having visions relative to an ancient people and maggots, many maggots. After shootings and weird events, Joan realizes that her father is an international drug dealer, there are drugs hidden in the tomb and her colleague is a detective of the narcotic department. The story ends back in New York, when Joan and her colleague decide to get married with each other, in a very romantic end. Yesterday I had the displeasure of wasting my time watching this crap. The story is so absurd, mixing thriller, crime, supernatural and horror (and even a romantic end) in a non-sense way. The acting is the worst possible, highlighting the horrible performance of the beautiful Elvire Audrey. John Saxon just gives his name to the credits and works less than five minutes, when his character is killed. The special effects are limited to maggots everywhere. The direction is ridiculous. I lost a couple of hours of my life watching &apos;Assassinio al Cimitero Etrusco&apos;. If you have the desire or curiosity of seeing this trash, choose another movie, go to a pizzeria, watch TV, go sleep, navigate in Internet, go to the gym, but do not waste your time like I did. My vote is two.&amp;lt;br /&gt;&amp;lt;br /&gt;Title (Brazil): &apos;O Mistério Etrusco&apos; (&apos;The Etruscan Mystery&apos;)&quot;  
0.9047619047619048 -&gt; &quot;15556_0&quot; &quot;Minor Spoilers&amp;lt;br /&gt;&amp;lt;br /&gt;In New York, Joan Barnard (Elvire Audrey) is informed that her husband, the archaeologist Arthur Barnard (John Saxon), was mysteriously murdered in Italy while searching an Etruscan tomb. Joan decides to travel to Italy, in the company of her colleague, who offers his support. Once in Italy, she starts having visions relative to an ancient people and maggots, many maggots. After shootings and weird events, Joan realizes that her father is an international drug dealer, there are drugs hidden in the tomb and her colleague is a detective of the narcotic department. The story ends back in New York, when Joan and her colleague decide to get married with each other, in a very romantic end. Yesterday I had the displeasure of wasting my time watching this crap. The story is so absurd, mixing thriller, crime, supernatural and horror (and even a romantic end) in a non-sense way. The acting is the worst possible, highlighting the horrible and screaming performance of the beautiful Elvire Audrey. John Saxon just gives his name to the credits and works less than five minutes, when his character is killed. The special effects are limited to maggots everywhere. The direction is ridiculous. I lost a couple of hours of my life watching &apos;Assassinio al Cimitero Etrusco&apos;. My suggestion is that if you have the desire or curiosity of seeing this trash, choose another movie, go to a pizzeria, watch TV, go sleep, navigate in Internet, go to the gym, but do not waste your time like I did. My vote is two.&amp;lt;br /&gt;&amp;lt;br /&gt;Title (Brazil): &apos;O Mistério Etrusco&apos; (&apos;The Etruscan Mystery&apos;)&quot;  
0.9047619047619048 -&gt; &quot;15555_0&quot; &quot;Minor Spoilers&amp;lt;br /&gt;&amp;lt;br /&gt;In New York, Joan Barnard (Elvire Audrey) is informed that her husband, the archeologist Arthur Barnard (John Saxon), was mysteriously murdered in Italy while searching an Etruscan tomb. Joan decides to travel to Italy, in the company of her colleague, who offers his support. Once in Italy, she starts having visions relative to an ancient people and maggots, many maggots. After shootings and weird events, Joan realizes that her father is an international drug dealer, there are drugs hidden in the tomb and her colleague is a detective of the narcotic department. The story ends back in New York, when Joan and her colleague decide to get married with each other, in a very romantic end. Yesterday I had the displeasure of wasting my time watching this crap. The story is so absurd, mixing thriller, crime, supernatural and horror (and even a romantic end) in a non-sense way. The acting is the worst possible, highlighting the horrible and screaming performance of the beautiful Elvire Audrey. John Saxon just gives his name to the credits and works less than five minutes, when his character is killed. The special effects are limited to maggots everywhere. The direction is ridiculous. I lost a couple of hours of my life watching &apos;Assassinio al Cimitero Etrusco&apos;. If you have the desire or curiosity of seeing this trash, choose another movie, go to a pizzeria, watch TV, go sleep, navigate in Internet, go to the gym, but do not waste your time like I did. AVOID IT! My vote is two.&amp;lt;br /&gt;&amp;lt;br /&gt;Title (Brazil): &apos;O Mistério Etrusco&apos; (&apos;The Etruscan Mystery&apos;)&quot;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It found two near duplicates to the source document we provided!&lt;/p&gt;
&lt;p&gt;Please find the full code &lt;a href=&quot;https://gist.github.com/thomasjungblut/e4759797f5a52d78e06d&quot;&gt;as a gist here.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Thanks for reading,&lt;br&gt;
Thomas&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Stochastic Logistic Regression in F#]]></title><description><![CDATA[Hello! I’m back with some exiting new hacking. At the beginning of the week, Jon Harrop came to the Microsoft London office and gave a two…]]></description><link>https://blog.thomasjungblut.com/blogger/stochastic-logistic-regression-in-f/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/stochastic-logistic-regression-in-f/</guid><pubDate>Sat, 31 May 2014 14:03:00 GMT</pubDate><content:encoded>&lt;p&gt;Hello!&lt;/p&gt;
&lt;p&gt;I’m back with some exiting new hacking. At the beginning of the week, &lt;a href=&quot;http://www.ffconsultancy.com/&quot;&gt;Jon Harrop&lt;/a&gt; came to the Microsoft London office and gave a two day training on F#. The training was nice, I enjoyed it very much and we all laughed a lot.&lt;/p&gt;
&lt;p&gt;In the end, I want to share a small project that I came up with during the training. It is about Stochastic Logistic Regression, or Logistic Regression “learning” the weights using Stochastic Gradient Descent.&lt;br&gt;
This is just a small write-up of what I’ve learned, explaining some of the language features.&lt;/p&gt;
&lt;h4 id=&quot;learning-rule&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#learning-rule&quot; aria-label=&quot;learning rule permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Learning Rule&lt;/h4&gt;
&lt;p&gt;In (more or less) mathematical terms, we will execute the following algorithm:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Let n = number of iterations  
Let a = learning rate  
Let w = weights that need to be learned (including a bias term)  
For i to N:  
  Let f = get a random feature  
  Let c = the class of feature (either 0 or 1)  
  Let prediction = Sigmoid ( f dot w )  
  Let loss = prediction - c  
    
  w := w - a \* f \* loss  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It is a pretty easy algorithm, can be rewritten to use a convergence criteria very easily since there is only a single global minimum. If you participated in the ML course of Andrew Ng you’ll recognize some similarity, because the full-batch algorithm they used basically uses the whole feature matrix and then updates the gradient by the average over all losses.&lt;/p&gt;
&lt;p&gt;Let’s jump into F#.&lt;/p&gt;
&lt;h4 id=&quot;training-in-f&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#training-in-f&quot; aria-label=&quot;training in f permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Training in F#&lt;/h4&gt;
&lt;p&gt;Since we are basically executing a math equation over and over again, it is handy to have a math library at hand. I’ve chosen &lt;a href=&quot;http://numerics.mathdotnet.com/&quot;&gt;Math.Net Numerics&lt;/a&gt;, because it has some nice F# bindings. Let’s start by looking at the training loop of the whole program:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;fsharp&quot;&gt;&lt;pre class=&quot;language-fsharp&quot;&gt;&lt;code class=&quot;language-fsharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Train&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;numIterations&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dim&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; learningRate&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rnd&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;   
    &lt;span class=&quot;token comment&quot;&gt;// new vector including the bias  &lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;mutable&lt;/span&gt; start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; DenseVector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;CreateRandom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dim &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Normal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;to&lt;/span&gt; numIterations &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; feature &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;SampleNewFeature&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dim&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rnd&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
        start &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; OnlineLogisticRegression&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GradientDescentStep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;learningRate&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; start&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;FeatureVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;feature&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;FeatureClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;feature&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  

    Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Learned Weights: {0}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Join&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;, &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; start&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ToArray&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
    start&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see, F# is pretty much like the (more or less) mathematical notation I used in the previous section. Notable in the first place is that F# is indentation sensitive, just like Python.&lt;/p&gt;
&lt;p&gt;In the first line we define the function ”&lt;em&gt;Train&lt;/em&gt;”, which defines some arguments and no return type. F# is quite smart about type inference, so it can detect what the types of the parameters are, so with the return type. In this method, we return the learned weights ”&lt;em&gt;start&lt;/em&gt;”- thus the compiler knows that this method returns a &lt;em&gt;DenseVector&lt;/em&gt;. Like in most of the functional languages, there is always a return- in case there is not, there is a ”&lt;em&gt;unit&lt;/em&gt;” return (literally defined by () ), which always indicates an absense of a value.&lt;/p&gt;
&lt;p&gt;In the raw algorithm, where I used a for loop to loop over all iteration, we sample a new feature and pass it to another function which I defined in the &lt;em&gt;module&lt;/em&gt; ”&lt;em&gt;OnlineLogisticRegression&lt;/em&gt;” containing the update and calculation logic. At the end, we simply print (using the standard printing in C#) the vector and return it to the outside. You can seamlessly use F# and C# with each other in a program as they compile to the same IL.&lt;/p&gt;
&lt;p&gt;Let’s step into the gradient descent function for a while:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;fsharp&quot;&gt;&lt;pre class=&quot;language-fsharp&quot;&gt;&lt;code class=&quot;language-fsharp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/// Does a stochastic gradient descent step. Returns a new vector with the updated weights.  &lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;GradientDescentStep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;learningRate&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; currentParameters&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; currentFeatureVector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; outcome&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; biasedFeature &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; CreateBiasVector currentFeatureVector  
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; prediction &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Predict&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;biasedFeature&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; currentParameters&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; loss &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prediction &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; outcome  
    &lt;span class=&quot;token comment&quot;&gt;// do a gradient descent step into the gradient direction  &lt;/span&gt;
    DenseVector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;OfVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;currentParameters &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;biasedFeature \&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;loss \&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; learningRate&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Yet another example for the type inference, but in this case I want to put your attention to the operator overloading. Yes in F# you can overload operators: As you can see in the parameter update, ”&lt;em&gt;currentParameters&lt;/em&gt;” and ”&lt;em&gt;biasedFeature&lt;/em&gt;” is a DenseVector, while loss and learningRate are floats (floats in F# are 64bit doubles, float32 is the “normal” float). The compiler has a small problem, because you can’t leave the brackets out, as it can’t determine the precedence correctly?&lt;/p&gt;
&lt;p&gt;In any case, the logic around that is pretty simple, very similar to a definition in maths.&lt;/p&gt;
&lt;h4 id=&quot;testing-the-classifier-in-f&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#testing-the-classifier-in-f&quot; aria-label=&quot;testing the classifier in f permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Testing the classifier in F#&lt;/h4&gt;
&lt;p&gt;In case the classifier is trained, we want to assess its learned weights. Usually, we use a hold-out test set to measure some metrics like accuracy or precision/recall, in this case I settled with sampling some new features from the random distribution we created the features with in the training stage. So how does that look like in F#?&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;fsharp&quot;&gt;&lt;pre class=&quot;language-fsharp&quot;&gt;&lt;code class=&quot;language-fsharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; testSetSource &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; List&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;init testSetSize &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;SampleNewFeature&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dim&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rnd&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; testSet &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;   
      Seq&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ofList testSetSource  
      &lt;span class=&quot;token operator&quot;&gt;|&gt;&lt;/span&gt; Seq&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;map &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;feat&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; feat&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; OnlineLogisticRegression&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Predict&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;FeatureVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;feat&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; weights&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
      &lt;span class=&quot;token operator&quot;&gt;|&gt;&lt;/span&gt; Seq&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;map &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;feat&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; prediction&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; feat&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; prediction&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;FeatureClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;feat&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; prediction&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; countCorrectPredictions &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Seq&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sumBy &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;feat&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; prediction&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; correct&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; correct &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; numCorrect &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; countCorrectPredictions testSet  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see, I have used the pipeline operator ( |&gt; ) to chain operations together. First we create a new list containing the new and sampled test features, then we make it a sequence (which is a lazily evaluated structure that is similar to IEnumerable in C#).&lt;br&gt;
Into that sequence, we map a three-tuple (the feature, the prediction and the learned weights) and then use another map stage to assess whether a classification was correct or not (threshold of the sigmoid here is 0.5). This in fact, is basically what’s currying about: we chain multiple operators together forming a new function.&lt;br&gt;
In the end, we sum the number of correct predictions by piping the sequences through the defined pipeline.&lt;br&gt;
All of this is lazily evaluated, the whole computation was just executed within the last line.&lt;/p&gt;
&lt;h4 id=&quot;code&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#code&quot; aria-label=&quot;code permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Code&lt;/h4&gt;
&lt;p&gt;The code can be found on GitHub, Apache 2.0 licensed: &lt;a href=&quot;https://github.com/thomasjungblut/FSharpLogisticRegression&quot;&gt;https://github.com/thomasjungblut/FSharpLogisticRegression&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;result&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#result&quot; aria-label=&quot;result permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Result&lt;/h4&gt;
&lt;p&gt;Executing the code in the GitHub repository yields to the following plot.
&lt;img src=&quot;https://raw.githubusercontent.com/thomasjungblut/FSharpLogisticRegression/master/separation.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Thanks for reading.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Greatest common divisor using F#]]></title><description><![CDATA[Hey guys, I played with F# on the weekend. Since I’m working at Microsoft now and mainly working with C#, I thought F# would be a nice…]]></description><link>https://blog.thomasjungblut.com/blogger/greatest-common-divisor-using-f/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/greatest-common-divisor-using-f/</guid><pubDate>Mon, 07 Apr 2014 20:22:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey guys,&lt;/p&gt;
&lt;p&gt;I played with F# on the weekend. Since I’m working at Microsoft now and mainly working with C#, I thought F# would be a nice counterpart to my Scala work in the past.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;A few personal updates&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The start at Microsoft was quite a lot of work until now and I find less time and motivation in coding much in the evening. You can mainly see this in the commit activity of &lt;a href=&quot;https://github.com/thomasjungblut/thomasjungblut-common&quot;&gt;my common library on Github&lt;/a&gt; which looks like this:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://4.bp.blogspot.com/-Y1CWed9WADw/U0MChs1BgXI/AAAAAAAACfs/uvBDPMYpwYg/s1600/commit_activity.PNG&quot;&gt;&lt;img src=&quot;http://4.bp.blogspot.com/-Y1CWed9WADw/U0MChs1BgXI/AAAAAAAACfs/uvBDPMYpwYg/s1600/commit_activity.PNG&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Flatline since christmas… Not very proud of it, due to my relocation to London I was two months without my development desktop PC, in addition, context-switching between C# and Java isn’t easy. Personally I find it very hard to go back to Java, as I’m missing a ton of functionality from C#! But I promise that I will find my way back, especially when it comes to awesome machine learning algorithms.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Back to the topic&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;So like most of the time, I was lurking around at Stackoverflow and found a poor guy using a &lt;a href=&quot;http://stackoverflow.com/questions/22920894/java-program-not-executing-code&quot;&gt;Java 8 lambda to make the greatest common divisor working&lt;/a&gt;. Besides that his algorithm is quite strange and by the time you read this, the question is likely to be deleted, I find a quite interesting idea to practice my (still poor) weekend’s F# skills.&lt;/p&gt;
&lt;p&gt;Just a few words about the &lt;a href=&quot;http://en.wikipedia.org/wiki/Greatest_common_divisor&quot;&gt;greatest common divisor definition&lt;/a&gt;, given two integers, we want the largest number that divides both without a remainder.&lt;/p&gt;
&lt;p&gt;I chose the simplest set theory approach, which is just calculating two sets of divisors and intersecting them. Then I choose the maximum from the intersection.&lt;/p&gt;
&lt;p&gt;Here is what I came up in F# (even using the pipelining operators!):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;fsharp&quot;&gt;&lt;pre class=&quot;language-fsharp&quot;&gt;&lt;code class=&quot;language-fsharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; gcd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;   
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; set1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Set&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ofList \&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt; a \&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;  
          &lt;span class=&quot;token operator&quot;&gt;|&gt;&lt;/span&gt; Set&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;filter &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; inter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Set&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ofList \&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;..&lt;/span&gt; b \&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;  
          &lt;span class=&quot;token operator&quot;&gt;|&gt;&lt;/span&gt; Set&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;filter &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
          &lt;span class=&quot;token operator&quot;&gt;|&gt;&lt;/span&gt; Set&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;intersect set1  
  inter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;MaximumElement     &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Rather easy binding of a function, not much to say here.&lt;br&gt;
Small obligatory test:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;fsharp&quot;&gt;&lt;pre class=&quot;language-fsharp&quot;&gt;&lt;code class=&quot;language-fsharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;  
Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;GCD: {0}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;gcd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token comment&quot;&gt;// yields to result  &lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// GCD: 4&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;How is the language so far?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I found F# until now quite succinct, especially compared to C#. .NET integrates very nicely, too.&lt;br&gt;
However, sometimes the type system makes me want to punch a wall.&lt;br&gt;
But the most disappointing experience so far: the .fs file that contains your main method needs to be the last one in the project’s solution. Yes you heard correctly, it must be on the lowest possible list entry in the project solution list.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;How dumb is that?!&lt;/strong&gt; Obviously, this was hiding behind a MSFT typical error message:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;error FS0039: The namespace or module ‘_my_namespace’ is not defined&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That cost me a few hours to figure out.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Complexity&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Let’s talk about the complexity a bit. So &lt;a href=&quot;http://en.wikibooks.org/wiki/F_Sharp_Programming/Sets_and_Maps&quot;&gt;as far as I read here&lt;/a&gt;, a &lt;em&gt;Set&lt;/em&gt; in F# is unordered, most likely to be a &lt;em&gt;HashSet.&lt;/em&gt; Thus constructing and filtering both sets is O(A) respectively O(B), the intersection of two unordered sets is linear in time as well. So what we will end up is something like this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt; 2 * (O(A) + O(B)) + O(A+B) = O(n)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Still linear time, but very bad constants. Also the space complexity is rather bad, it is linear as well, as we are creating two quite large sets.&lt;/p&gt;
&lt;p&gt;But hey! It is just a naive method to show off my new aquired F# knowledge.&lt;/p&gt;
&lt;p&gt;Thanks for reading, see you next time with a more interesting Big Data topic I hope,&lt;br&gt;
Thomas&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Wiring services together using the actor model]]></title><description><![CDATA[Hey folks, I had a lot of stuff to do in my last semester, thus I couldn’t write up the post about news clustering completely yet. The…]]></description><link>https://blog.thomasjungblut.com/blogger/wiring-services-together-using-actor/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/wiring-services-together-using-actor/</guid><pubDate>Sat, 08 Jun 2013 16:42:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey folks,&lt;/p&gt;
&lt;p&gt;I had a lot of stuff to do in my last semester, thus I couldn’t write up the post about news clustering completely yet. The stress will keep constant until my study is finally over, I guess until arround the beginning of october. Then I will have more time to explain this topic more thoroughly, of course with lots of pictures ;)&lt;/p&gt;
&lt;p&gt;But today I have a bit of time and wanted to share a smart idea of joining two cool things together: &lt;strong&gt;Service Oriented Architectures&lt;/strong&gt; (SOA) and the &lt;strong&gt;Actor Model&lt;/strong&gt;. We will go through a small definition of both, why we should join these technologies and at the end have a small look on how to implement such an architecture with plain Java.&lt;/p&gt;
&lt;h3 id=&quot;why-sevice-oriented-architectures&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#why-sevice-oriented-architectures&quot; aria-label=&quot;why sevice oriented architectures permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Why Sevice Oriented Architectures?&lt;/h3&gt;
&lt;p&gt;Service Oriented Architecture is a design pattern based on chunking a large software system into smaller and discrete modules called services. The goal is to design services solely based on their functionality and thus decouple them from other services. The result should be an ensemble of services that are only defined by their simplistic interfaces that offer functionality to the outside world. &lt;/p&gt;
&lt;p&gt;A pretty intuitive example is a checkout process in ecommerce systems: it is a large and complicated process that can be chunked into simpler parts. At the beginning of your internet shopping trip you are likely to visit a few products. Retrieving products and their information is also a good candicate for a service, because it has a defined behaviour and its functionality can be reused very well for other purposes. The corresponding interface could be something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// could directly retrieve objects from a database   &lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Product&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getProduct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; productId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;   
&lt;span class=&quot;token comment&quot;&gt;// could be a proxy to another service  &lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Opinions&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUserOpinions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; productId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;    
&lt;span class=&quot;token comment&quot;&gt;// could be a filesystem call  &lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Images&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getProductImages&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; productId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;   &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For many of you, this might look like a data access object (DAO) that is going to ask an underlying database implementation about the concrete values. This is &lt;strong&gt;not&lt;/strong&gt; what the goal of the service itself should be: a service defines just the &lt;em&gt;functionality&lt;/em&gt; and not how it transports the information (whether there is a RPC call or an Oracle database in the back shouldn’t be part of your interface/service design).&lt;br&gt;
Thus the user should never care about the underlying complexity or the implementation of the system. That is a similar statement like in &lt;em&gt;Object Oriented Programming&lt;/em&gt; that naturally yields to polymorphism (multiple implementations of an interface).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;But how to wire services together?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Imagine a computing cluster where a scheduler is a service that looks at the resources in the cluster and makes decisions on where to place your application best. How does it communicate the result of its computation to the next service- say the service that handles allocation of those resources?&lt;/p&gt;
&lt;p&gt;There are basically few ways to handle this:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Just call the next service via its interface methods (synchronous call)&lt;/li&gt;
&lt;li&gt;Send a message to the other service and continue (asynchronous call)&lt;/li&gt;
&lt;li&gt;A superviser/manager that calls services after each other (supervised call)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a href=&quot;http://www.youtube.com/watch?v=bzkRVzciAZg&quot;&gt;I’m no async evangelist&lt;/a&gt;, but I will try to tell you about my experiences and why I think that asynchronous messaging is a much more viable way in highly concurrent scenarios.&lt;/p&gt;
&lt;p&gt;Consider the following most simplistic scenario when dealing with services:&lt;br&gt;
&lt;a href=&quot;http://2.bp.blogspot.com/-urjjXzppRbc/UbM_ekkcYdI/AAAAAAAABzE/tOT1sKsAq_8/s1600/super_simple_service_chain.PNG&quot;&gt;&lt;img src=&quot;http://2.bp.blogspot.com/-urjjXzppRbc/UbM_ekkcYdI/AAAAAAAABzE/tOT1sKsAq_8/s400/super_simple_service_chain.PNG&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Super simple service chain&lt;/p&gt;
&lt;p&gt;In this case the services form a simple chaining, so calls from Service A can only reach B, and B can only reach C. Clearly, there is no need for anything spectacular- if I were in that situation I would put those services in a list and call them after each other:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; services &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; some list &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token class-name&quot;&gt;Result&lt;/span&gt; lastResult &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Service&lt;/span&gt; service &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; services&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    lastResult &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; service&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lastResult&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token comment&quot;&gt;// go further down the road with the final service result  &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is what is called the Pipeline pattern, because you feed the result of the stage before to the next one and enhance/filter/modify the results. This is a supervised architecture, because you are controlling how the data flows by hardcoding the control flow in the above loop.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;But what happens when we want to process requests through the services concurrently?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Now that is where the problems usually begins. The above architecture will work in a concurrent environment without any problems, as long as the code that is calling the services in sequence is thread-safe &lt;strong&gt;and&lt;/strong&gt; all the services are designed thread-safe. That means, if your service has state (for example our scheduler that has information about the current cluster resources), it needs to lock all access to it while modifying it. This is not a big deal for someone who worked with threads already and is familiar with standard libraries like in Java (see for example a &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/locks/ReadWriteLock.html&quot;&gt;ReadWriteLock&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;However, think of what complexity you are imposing to your software in that moment:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Every service needs to handle the locks for itself and must be thread-safe&lt;/li&gt;
&lt;li&gt;Even with standard library support you clutter your code with try/finally unlock statements&lt;/li&gt;
&lt;li&gt;The performance is likely to suffer in high concurrency/throughput environments&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Overall, this is a complexity nightmare (have you ever traced down a race condition?) and exactly what we wanted to avoid when choosing a SOA.&lt;/p&gt;
&lt;p&gt;It just begins to get worse:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://3.bp.blogspot.com/-D4QsvJH2n7E/UbNEudeh04I/AAAAAAAABzU/GpqzEr2yR1Y/s1600/slightly_more_complex_service_chain.PNG&quot;&gt;&lt;img src=&quot;http://3.bp.blogspot.com/-D4QsvJH2n7E/UbNEudeh04I/AAAAAAAABzU/GpqzEr2yR1Y/s400/slightly_more_complex_service_chain.PNG&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;What do you want to do when Service B locks it’s state for a long time (e.g. our scheduler just received a big update from a rack that just got back online)? Clearly other services will have to wait and throughput and responsiveness starts to suffer severely. You can spin this even a tick further: What if you’re in a distributed environment and Service B just doesn’t exist anymore (server goes down, netlink breaks)? Services A_[1-n] will have to wait until B comes back online and can’t do anything else than wait. Always note that those are the easiest service architectures! In reality your call graph looks much more connected throughout all services.&lt;/p&gt;
&lt;p&gt;All that is an issue if you’re relying on synchronous communication between services. What we need is to define a decoupling between the services- not of their functionality, but this time of the communication between them.&lt;/p&gt;
&lt;h3 id=&quot;the-actor-model&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-actor-model&quot; aria-label=&quot;the actor model permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Actor Model&lt;/h3&gt;
&lt;p&gt;The most intuitive way to make asynchronous communication to happen is to send a message! &lt;/p&gt;
&lt;p&gt;If I want Bob to work on issue X in our bug tracker, I write him an email that he should have a look at issue X soon. Now Bob can decide on his own when he looks into his mailbox (for example when he is finished with the current task) and also when he wants to start working on issue X. Transferred to computer science: you don’t disturb the service in doing its job as you would with locking or interrupts.&lt;/p&gt;
&lt;p&gt;The intuition is the same behind the actor model, here Bob would be the actor and emails would be some kind of messages that land in an actors’ inbox. Normally we want to have many more actors that can interact with each other and provide functionality. That’s where we come back to services: so actors and services both provide functionality / behaviour and messaging between actors helps us to solve the synchronous comunication problems. &lt;/p&gt;
&lt;p&gt;While you can use a framework like &lt;a href=&quot;http://akka.io/&quot;&gt;Akka&lt;/a&gt; for the actor model, it is very easy to implement in Java using the standard API:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SimpleActor&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;MSG_TYPE&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runnable&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Service&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;MSG_TYPE&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;onMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MSG_TYPE&lt;/span&gt; message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
  &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LinkedBlockingQueue&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;MSG_TYPE&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; inbox &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LinkedBlockingQueue&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Service&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;MSG_TYPE&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; messageListener&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SimpleActor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Service&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;MSG_TYPE&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; listener&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;messageListener &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; listener&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MSG_TYPE&lt;/span&gt; message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    inbox&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isInterrupted&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token comment&quot;&gt;// blocks until we have a new message  &lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;MSG_TYPE&lt;/span&gt; take &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; inbox&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;take&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        messageListener&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;onMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;take&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token comment&quot;&gt;// interrupted exception omitted  &lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see, it is super easy to setup a producer/consumer inbox within a thread and use the service as a callback listener. All concurrency and signalling is the problem of the underlying implementation of the inbox, here a &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/LinkedBlockingQueue.html&quot;&gt;LinkedBlockingQueue&lt;/a&gt; is used.&lt;/p&gt;
&lt;p&gt;Now your Service can easily implement the callback, with the guarantee that every message that arrives will be processed sequentially (because your run method takes only one message at a time from the queue). So you will never have to worry about explicit locking in your code, you just have to react to events that happen.&lt;/p&gt;
&lt;p&gt;A simplistic and fictitious variant of a scheduler that reacts can look like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Service&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SchedulingEvent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; scheduler &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Service&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SchedulingEvent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;onMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SchedulingEvent&lt;/span&gt; message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isSchedulingMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cluster&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getFreeMemory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;memoryNeeded&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token comment&quot;&gt;// tell the allocation actor to run that   &lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Allocator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Allocation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isUpdateMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      cluster&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getFreeMemory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
      
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can see, the logic is very clean, no locking is needed and you can react on specific events- or ignore them if you don’t care about them. In a real-life scenario I would add an &lt;em&gt;ActorManager&lt;/em&gt; that helps messaging by a defined name or class, or you can design actors as singletons and directly access their messaging methods.&lt;/p&gt;
&lt;p&gt;Let’s get back to our problems we had with the synchronous and supervised calls and see if we solved them:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Locking complexity&lt;/li&gt;
&lt;li&gt;Best case: no locking anymore in the service code itself&lt;/li&gt;
&lt;li&gt;Code clutter&lt;/li&gt;
&lt;li&gt;Everything looks very clean and tied to the servers functionality&lt;/li&gt;
&lt;li&gt;Performance&lt;/li&gt;
&lt;li&gt;Every service can work at its own speed/pace, no polling is involved&lt;/li&gt;
&lt;li&gt;What if the &lt;strong&gt;inbox fills up&lt;/strong&gt; faster than the messages can be consumed?&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Is it really faster?&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Availability&lt;/li&gt;
&lt;li&gt;When a service goes down, it is up to the messaging implementation to buffer those messages in a secondary storage so they can be retrieved after a crash. But certainly this is now easier to implement and maintain.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Seems we have a few open questions that definitely must be addressed by the engineer. To make a good decision you will need architecture knowledge on how the services interact with each other, but in the end it looks like a very nice model for the communication between services.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;But what are the clear disadvantages of this actor model?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Of course there is no silver bullet in such technology. The actor model also has drawbacks, here are a few that I have observed when working with event driven actor architectures:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You have no explicit returns, e.g. if an exception happens you will be notified long time afterwards via message that comes back&lt;/li&gt;
&lt;li&gt;Debugging is the hell if you don’t optimize readability for it&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The first bullet point is problematic, yet another example: what if you want to get a return value for a query that is part of our service functionality? It sounds like a huge detour to send messages when all you could do is to call a function. Always keep your goal in mind: &lt;br&gt;
Do you want to create a service for functionality? Or do you want to create services that interact with each other? Both are (by definition) service oriented architectures and both can be used in conjunction with each other - choose wisely which one you need to use.&lt;/p&gt;
&lt;p&gt;The second bullet point is something that will drive developers nuts in their daily lifes. When writing an actor model, be sure that your actors are named accordingly to their usecase. Nobody wants to send a message not knowing whose inbox to reach. So make it clear to which destination you’re sending a message to.&lt;br&gt;
Something that I have employed to neglect this was to use classnames as the address and make all services singletons. This helps to write code like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// class name based routing  &lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Allocator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Allocation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token comment&quot;&gt;// singleton based routing  &lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Allocator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Allocation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token comment&quot;&gt;// singleton based direct messaging, NOTE getInstance() is a  &lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// convention, not a defined interface!  &lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;Allocator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Allocation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;People working with that will immediately know, that they can click on the class entry in their IDE and get to the implementation fast and will always know where the message will end up.&lt;br&gt;
Still the amount of scrolling to be done is too damn high! I hope that the IDEs will soon catch up on those paradigms (especially when lambdas and function pointers come with Java8) and make it easy to navigate to callback/listener methods.&lt;/p&gt;
&lt;p&gt;So thank you very much for reading, you’ve definitely won a cookie for reading the whole article.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Named Entity Recognition in News Articles]]></title><description><![CDATA[Hello, been a while since the last post. Was into a lot of work- couldn’t really get up on the weekend to write about   named entity…]]></description><link>https://blog.thomasjungblut.com/blogger/named-entity-recognition-in-news/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/named-entity-recognition-in-news/</guid><pubDate>Sun, 27 Jan 2013 12:54:00 GMT</pubDate><content:encoded>&lt;p&gt;Hello,&lt;/p&gt;
&lt;p&gt;been a while since the last post. Was into a lot of work- couldn’t really get up on the weekend to write about   named entity recognition in news articles. But today we can finally talk about it.&lt;/p&gt;
&lt;p&gt;This post is about a few things:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;What is named entity recognition?&lt;/li&gt;
&lt;li&gt;How do we model it as a machine learning problem?&lt;/li&gt;
&lt;li&gt;What features to extract for our learner?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;So let’s dive in, if you have taken the Natural Language Processing (NLP) class on Coursera, you will be familiar with the topic already and should start with the features we use in the third paragraph.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;What is named entity recognition (NER)?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The most easiest explanation is to find word level concepts like a location or person in an unstructured text file. Let’s say we have the following snippet of text, shamelessly stolen from Wikipedia:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;Jim bought 300 shares of Acme Corp. in 2006.&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The idea is to tag parts of this sentence with tuples of concepts and their value, such that we get this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;&amp;#x3C;PERSON, “Jim”&gt;&lt;/strong&gt; bought 300 shares of &lt;strong&gt;&amp;#x3C;CORP,“Acme Corp”&gt;&lt;/strong&gt; in 2006.&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;So we detected &lt;em&gt;Jim&lt;/em&gt; as a person and the &lt;em&gt;Acme Corp&lt;/em&gt; as a corporation in this sentence.&lt;br&gt;
But how do we need this for our news aggregation engine? A very simple assumption: News are about people, what they did and where they did it. A simple example would be:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;“David Cameron talks in Davos about the EU”&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The topic is clearly about the person &lt;em&gt;David Cameron&lt;/em&gt;- the action of talking and a location namely &lt;em&gt;Davos&lt;/em&gt; in Switzerland. This is needed for our news aggregation engine to cluster topics together, even if their content is slightly different. We will talk about this in one of the following blog posts.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;How do we model this as a machine learning problem?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Basically, it is nothing else than a (multiclass) classification problem. Namely classifying if a token belongs to the class PERSON, LOCATION- or O which is none of the ones before.&lt;/p&gt;
&lt;p&gt;The main difference to other NLP tasks is that we need the context of a token, because the meaning of the current token is depending on the previous or the following token/class. So let’s have a look at another example:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;It did not, and most of Mr. Cameron’s European partners do not wish to revisit that fundamental question.&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;How do we recognize Cameron in this case here? There are two cases that are representative for english. First the “Mr.” is a strong indicator that there is following a name, second the “‘s” is a strong indicator that the previous token was a name. Also prepositions like “of”, “to”, “in” or “for” are likely indicators for names or locations. The trick that I learned from the NLP class on coursera was the encoding of the text as a sequence of unigrams. The previous text would look like this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;most O&lt;br&gt;
of O&lt;br&gt;
Mr. O&lt;br&gt;
Cameron PERSON&lt;br&gt;
’s O&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;So what we do is predicting the label of the current unigram, by looking at the previous and following unigram and maybe also at the previous label. The reason we need to look at the previous label is that names could be composed of name and surname like &lt;em&gt;David Cameron&lt;/em&gt;. So if the last class was a person, in many cases the current class might also be a person.&lt;/p&gt;
&lt;p&gt;So what kind of classifier do we use? I used a self-written version of the &lt;strong&gt;Maximum Entropy Markov Model&lt;/strong&gt; supplied in week four of the NLP class exercise optimizable with normal Gradient Descent or Conjugate Gradient (or even with the given quasi newton minimizer supplied in the class). Also I written some utilities to extract sparse feature vectors as conveniently as in NLP class.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/thomasjungblut/thomasjungblut-common/tree/master/src/main/java/de/jungblut/ner&quot;&gt;You can browse some more code in my common repository’s NER package&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;What features to extract for our learner?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Features are pretty important, they must cover structural as well as dictionary features. Here is my feature set for dictionary features:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;current word&lt;/li&gt;
&lt;li&gt;last word&lt;/li&gt;
&lt;li&gt;next word&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And for structural features:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;previous class label&lt;/li&gt;
&lt;li&gt;current word upper case start character&lt;/li&gt;
&lt;li&gt;last word upper case start character&lt;/li&gt;
&lt;li&gt;current word length&lt;/li&gt;
&lt;li&gt;current word containing only alphabetic characters  (1=true or 0=false)&lt;/li&gt;
&lt;li&gt;next word containing only alphabetic characters  (1=true or 0=false)&lt;/li&gt;
&lt;li&gt;was the last word a preposition&lt;/li&gt;
&lt;li&gt;was the last word a special character like dot, comma or question mark&lt;/li&gt;
&lt;li&gt;last word ending with “ing”&lt;/li&gt;
&lt;li&gt;previous/current/next words POS tag&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;POS tags are pretty important as nouns are more likely to be a person or location. Also other POS tags might lead to one of those classes by the previous word or next word, e.G. verbs are pretty likely to follow a name. All these features are pretty sparse, thus we are building a dictionary of all possible features we observed during training time and encode a dictionary of features we have seen.&lt;br&gt;
For example the feature &lt;em&gt;prevPosTag&lt;/em&gt; could have value &lt;em&gt;“prevPosTag=NN”&lt;/em&gt;. This is a rare occation as we have a unigram encoded as a feature vector, so it totally makes sense to encode them with a sparse vector.&lt;/p&gt;
&lt;p&gt;Now that we have our text encoded as a list of vectors (a sparse vector for each unigram we observe) we can optimize the vectors and their outcome by minimizing a conditional likelyhood costfunction to be used in the Markov Model. This will learn conditional probabilities between features and the outcomes, describing when we are observing a feature- how likely is that the PERSON class occurs, for math lovers this can be described as P(class | features). I optimized my model for 1k iterations using conjugate gradient and obtained a very low training error of arround 5%. To obtain the class for a feature vector we are doing a viterbi decoding on the learned weights. The trick here is that you need to encode the feature vector for all the possible classes, only that way the viterbi can decode the probabilities correctly.&lt;/p&gt;
&lt;p&gt;So yeah, that is basically what it’s all that named entity recognition is about. The next blog post will most probably be about how to cluster the news together using the information we gathered through this post.&lt;/p&gt;
&lt;p&gt;Bye!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Extracting articles from crawled HTML sites]]></title><description><![CDATA[So welcome to our second part of Building a news aggregation engine! If you don’t know how crawlers work, have a look into the last part of…]]></description><link>https://blog.thomasjungblut.com/blogger/extracting-articles-from-crawled-html/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/extracting-articles-from-crawled-html/</guid><pubDate>Tue, 01 Jan 2013 16:27:00 GMT</pubDate><content:encoded>&lt;p&gt;So welcome to our second part of &lt;a href=&quot;http://codingwiththomas.blogspot.de/2013/01/building-news-aggregation-engine.html&quot;&gt;Building a news aggregation engine&lt;/a&gt;!&lt;br&gt;
If you don’t know how crawlers work, have a look into the last part of the series: &lt;a href=&quot;http://codingwiththomas.blogspot.de/2013/01/build-basic-crawler.html&quot;&gt;Build a basic crawler&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This time we will talk about how to get the actual raw content of a site. Something that we humans see on a newspage isn’t visible for an algorithm, because it just has to look at the code- not the actual rendered page. Therefore I will introduce you with a technique called &lt;strong&gt;Boilerplate removal&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;What is this “Boilerplate”?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Boilerplate is everything, but the content of the page you are seeking for. Some people call it: “design” or “nagivation” and in their first attempts they try to parse websites with XPath expressions to get their content. But that is not necessary and an unsual pain if the design really shifts.&lt;/p&gt;
&lt;p&gt;So the lesson learned is (like in the last blog post as well): IGNORE. Yes you have to ignore the parts you don’t want to have. That doesn’t mean that we don’t take the parts to make decisions- in fact we need those to decide whether a block of html code belongs to the IGNORE- or the content-part.&lt;br&gt;
Therefore I want to introduce to you the &lt;a href=&quot;http://code.google.com/p/boilerpipe/&quot;&gt;boilerpipe framework&lt;/a&gt;. Boilerpipe is written in Java by Christian Kohlschütter and it is licensed with Apache 2.0.&lt;/p&gt;
&lt;p&gt;It uses some really simple machine learning algorithm (a small decision tree) to classify whether a given block of html is content or not. You can read the details in his research paper &lt;a href=&quot;http://www.l3s.de/~kohlschuetter/publications/wsdm187-kohlschuetter.pdf&quot;&gt;“Boilerplate Detection using Shallow Text Features&lt;/a&gt;&lt;a href=&quot;http://www.l3s.de/~kohlschuetter/publications/wsdm187-kohlschuetter.pdf&quot;&gt;”&lt;/a&gt; which is a really good read.&lt;br&gt;
In short, it analyses the amount of tokens and links in the previous, current and next block of HTML. It is the same idea we will use later in sequence-learning when we deal with &lt;strong&gt;Named Entity Recognition&lt;/strong&gt; in order to get people and events from the article.&lt;/p&gt;
&lt;p&gt;In Java, you can use it like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BoilerpipeExtractor&lt;/span&gt; extractor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ArticleExtractor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; extractor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;html&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It is sooo simple and you have the content of a webpage in a string. Of course, this only applies for news articles, since they are shaped really consistent over many news sites therefore the name &lt;strong&gt;Article&lt;/strong&gt;Extractor.&lt;/p&gt;
&lt;p&gt;But in real world, if we crawl the web, most of the sites we examine with our crawlers won’t be news- so the content in the resulting text string might not be a news article. Maybe it is just the imprint or privacy statement that &lt;strong&gt;looks&lt;/strong&gt; like an article, but isn’t.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Classifying News sites&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Since I faced this issue while crawling, I had to train some machine learning algorithm on the output of boilerpipe to detect news accurately.&lt;/p&gt;
&lt;p&gt;Here is what I did:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Let the crawler run on the top 40 news sites in germany (hand seeded list) for 100k sites&lt;/li&gt;
&lt;li&gt;Write a small python application to loop over all files and ask me if it was news or not&lt;/li&gt;
&lt;li&gt;After 1k hand-classified items (was just 1h of work!), train a classifier.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I found out that training a Multilayer Perceptron with a single hidden layer gives arround 93% accuracy with very small number of features, since this is enough for my purposes I stopped there. But I believe that you can get alot more (99% should be really do-able) with ensembling and better features.&lt;/p&gt;
&lt;p&gt;But many people don’t tell what kind of features they used, so here are mine:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Length of the extracted text&lt;/li&gt;
&lt;li&gt;URL ends with ’/’&lt;/li&gt;
&lt;li&gt;Length of the extracted title&lt;/li&gt;
&lt;li&gt;Number of ‘\n’ in the extracted text&lt;/li&gt;
&lt;li&gt;Text mention of “impressum”,“haftung”,“agb”,“datenschutz”,“nutzungsbedingungen” (imprint, authors etc.)&lt;/li&gt;
&lt;li&gt;Title mention of “impressum”,“haftung”,“agb”,“datenschutz”,“nutzungsbedingungen” (imprint, authors etc.)&lt;/li&gt;
&lt;li&gt;Number of upper case letters in the text&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It is a mixture of text level features that can be expanded and meta features like lengths.&lt;br&gt;
I trained a neural net (7-35-1) with sigmoid activations (and 1.0 as regularization) for 10k epochs with Conjugate Gradient. Here are the average results from a 10 fold crossvalidation:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Accuracy: 0.9259259259259259&lt;br&gt;
Precision: 0.9173553719008265&lt;br&gt;
Recall: 0.9823008849557522&lt;br&gt;
F1 Score: 0.9487179487179487&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That is pretty good for such simple methods! And I didn’t even used HTML features like boilerpipe does ;-)&lt;/p&gt;
&lt;p&gt;If you want to have some data of my crawl, I have ~1500 classified news articles and 16.5k unclassified- so if you need a bit of german news data for whatever research: let me know via email!&lt;/p&gt;
&lt;p&gt;Congratz! We can now crawl the world wide web and classify news sites very accurately. Our next step will be to develop a named entity recognition engine that allows us to extract the keywords we need from our text in order to group them efficiently.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Build a basic crawler]]></title><description><![CDATA[So welcome to our first part of Building a news aggregation engine! This time we talk about how we build a really simple crawler, that…]]></description><link>https://blog.thomasjungblut.com/blogger/build-basic-crawler/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/build-basic-crawler/</guid><pubDate>Tue, 01 Jan 2013 15:37:00 GMT</pubDate><content:encoded>&lt;p&gt;So welcome to our first part of &lt;a href=&quot;http://codingwiththomas.blogspot.de/2013/01/building-news-aggregation-engine.html&quot;&gt;Building a news aggregation engine&lt;/a&gt;!&lt;br&gt;
This time we talk about how we build a really simple crawler, that crawls us some sites. 
The (more or less) &lt;a href=&quot;http://en.wikipedia.org/wiki/Web_crawler&quot;&gt;formal definition of a crawler is stated in Wikipedia&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A &lt;strong&gt;Web crawler&lt;/strong&gt; is a computer program that browses the &lt;a href=&quot;http://en.wikipedia.org/wiki/World_Wide_Web&quot; title=&quot;World Wide Web&quot;&gt;World Wide Web&lt;/a&gt; in a methodical, automated manner or in an orderly fashion.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The basic workflow looks like that:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Seed some URLs and &lt;strong&gt;queue&lt;/strong&gt; them up&lt;/li&gt;
&lt;li&gt;Keep a &lt;strong&gt;set&lt;/strong&gt; about what URLs were visited&lt;/li&gt;
&lt;li&gt;While our &lt;strong&gt;queue&lt;/strong&gt; is not empty (or we reached some maximum amounts of sites)&lt;/li&gt;
&lt;li&gt;Get the first URL from the &lt;strong&gt;queue&lt;/strong&gt;, put it into the visited &lt;strong&gt;set&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Query the URL, obtain some HTML&lt;/li&gt;
&lt;li&gt;Extract new URLs from the HTML and &lt;strong&gt;queue&lt;/strong&gt; them up if they are not in the visited &lt;strong&gt;set&lt;/strong&gt; yet&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A small Java program could look like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; seedUrl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;http://www.wikipedia.com/&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Deque&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; linksToCrawl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ArrayDeque&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashSet&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; visited &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashSet&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
linksToCrawl&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Arrays&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;seedUrl&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
visited&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Arrays&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;seedUrl&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fetches &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;linksToCrawl&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; urlToCrawl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; linksToCrawl&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token comment&quot;&gt;// open a connection and parse HTML  &lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;  
      &lt;span class=&quot;token comment&quot;&gt;// loop over all links we found on that page  &lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; outlink &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; extractedResult&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;outlinks&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
         &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;visited&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;outlink&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
            linksToCrawl&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;outlink&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
      fetches&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It looks really simple, but tell you what? It is more difficult than it looks.&lt;br&gt;
Once you started with it, you wish you never started with that- the web is ugly. I’m working in the backend team at work and I’m surrounded by a lot of garbage from various data sources, but the web is a whole new level. Just a small excerpt of what you need to deal with:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Encoding issues (we will fix them later on in this post)&lt;/li&gt;
&lt;li&gt;Link expansions (relative vs. absolute URLs vs. JavaScript URLs like void(0); ) &lt;/li&gt;
&lt;li&gt;Not parsable stuff like videos or images&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So for example, how do you deal with data you can’t handle (which don’t contain HTML)? You IGNORE it.  For this kind of purpose I’ve clamped together a bunch of suffixes that can happen within links and they guard against running into not parsable binary data:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Pattern&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;IGNORE_SUFFIX_PATTERN&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Pattern&lt;/span&gt;  
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;compile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;.\*(\\\\.(css|js|bmp|gif|jpe?g|png|tiff?|mid|mp2|mp3|mp4|wav|avi|mov|mpeg|ram|m4v|pdf|iso|rm|smil|wmv|swf|wma|zip|rar|gz))$&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So as you can see, I’m guarding against anything here. Of course they are completely useless if someone does not supply a suffix of the filetype. In the latter case, you will need to get on the stream and look for a html or body tag to verify it is really a website (which is the worst case, because you’re wasting bandwidth and time the crawler could use to do something else).&lt;/p&gt;
&lt;p&gt;Something that poked me for quite a while were encoding issues. As a german, umlauts like &lt;em&gt;öäüß&lt;/em&gt; are completely garbled if you read them with the wrong encoding. So most of the time, germany news look really bad and you can directly throw them into the next trash bin.&lt;/p&gt;
&lt;p&gt;I ran across a project of the Mozilla foundation called &lt;strong&gt;universalchardet&lt;/strong&gt; (abbrev. for universal charset detector) and &lt;a href=&quot;http://code.google.com/p/juniversalchardet/&quot;&gt;its Java descendent called &lt;strong&gt;juniversalchardet&lt;/strong&gt;&lt;/a&gt;. It detects encodings with really high accuracy and helps you to get the content of your crawl correct like you would browse the site.&lt;/p&gt;
&lt;p&gt;In Java you have to obtain the site via streams, so let me show you a small example of &lt;strong&gt;juniversalchardet&lt;/strong&gt; and how to read a stream into a string of HTML with NIO.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;  &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; someURLAsString &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://www.facebook.com&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token class-name&quot;&gt;URL&lt;/span&gt; url &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;someURLAsString&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token class-name&quot;&gt;InputStream&lt;/span&gt; stream &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; url&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;openStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; html &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;consumeStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stream&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    
&lt;span class=&quot;token comment&quot;&gt;// the helper methods  &lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;consumeStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;InputStream&lt;/span&gt; stream&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// setup the universal detector for charsets  &lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;UniversalDetector&lt;/span&gt; detector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UniversalDetector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;ReadableByteChannel&lt;/span&gt; bc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Channels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;newChannel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stream&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// allocate a byte buffer of BUFFER\_SIZE size   &lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 1mb is enough for every usual webpage  &lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ByteBuffer&lt;/span&gt; buffer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;allocate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BUFFER&lt;/span&gt;\_SIZE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; read &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;read &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      &lt;span class=&quot;token comment&quot;&gt;// let the detector work on the downloaded chunk  &lt;/span&gt;
      detector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;handleData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; read&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; read&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token comment&quot;&gt;// check if we found a larger site, then resize the buffer  &lt;/span&gt;
      buffer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;resizeBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// finish the sequence  &lt;/span&gt;
    detector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;dataEnd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// copy the result back to a byte array  &lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; encoding &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; detector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDetectedCharset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// obtain the encoding, if null fall back to UTF-8  &lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
        encoding &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; encoding&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stream &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      stream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token comment&quot;&gt;// basic resize operation when 90% of the buffer is occupied&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// simply double the correct size and copy the buffer  &lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;resizeBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ByteBuffer&lt;/span&gt; buffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  &lt;span class=&quot;token class-name&quot;&gt;ByteBuffer&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; buffer&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token comment&quot;&gt;// double the size if we have only 10% capacity left  &lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;remaining&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;capacity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; \&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.1f&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;allocate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;capacity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; \&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    buffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flip&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    result&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That is actually everything to know about getting HTML from a raw URL.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;But, how do you extract the outlinks from a HTML page?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Many of you will now go ahead and say: let’s compile some RegEx. You will &lt;strong&gt;FAIL&lt;/strong&gt;.&lt;br&gt;
As a computer scientist it is enough if you tell that HTML is a context free grammar (chomsky type 2) and RegEx needs a regular language (type 3) to operate properly. Type 2 languages are way more complex and can’t be parsed with a regular expression. So please have a look at the &lt;a href=&quot;http://stackoverflow.com/a/1732454/540873&quot;&gt;funny rage answer at stackoverflow&lt;/a&gt; or read up the other very informative answers at the bottom to know why you shouldn’t do this. Don’t get me wrong: You will find URLs that you can parse with RegEx, but I don’t think it is worth the stress. I always use the &lt;a href=&quot;http://htmlparser.sourceforge.net/&quot;&gt;htmlparser on sourceforge&lt;/a&gt;, it is clean, well tested and pretty fast.&lt;/p&gt;
&lt;p&gt;To end this post, I tell you how to extract some outlinks from a html page as string:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NodeFilter&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;LINK&lt;/span&gt;\_FILTER &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NodeClassFilter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LinkTag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token class-name&quot;&gt;Parser&lt;/span&gt; parser &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Parser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;html&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token class-name&quot;&gt;NodeList&lt;/span&gt; matches &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; parser&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;extractAllNodesThatMatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;LINK&lt;/span&gt;\_FILTER&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token class-name&quot;&gt;SimpleNodeIterator&lt;/span&gt; it &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; matches&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;elements&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;it&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasMoreNodes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  &lt;span class=&quot;token class-name&quot;&gt;LinkTag&lt;/span&gt; node &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LinkTag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; it&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;nextNode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; link &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getLink&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;trim&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token comment&quot;&gt;// now expand for relative urls and store somewhere  &lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It is simple as that. How expanding of URLs can be done is another part- but I leave that up to you ;-) &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/net/URI.html&quot;&gt;Java’s URI may help you with that.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;So thanks for attending, my next post is about how to extract actual text content (news) from pure HTML code.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Building a news aggregation engine]]></title><description><![CDATA[Hey all, first off- happy new year! It has been a few months now since I posted my last blog post. It wasn’t just the stress (open source…]]></description><link>https://blog.thomasjungblut.com/blogger/building-news-aggregation-engine/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/building-news-aggregation-engine/</guid><pubDate>Tue, 01 Jan 2013 14:34:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey all,&lt;/p&gt;
&lt;p&gt;first off- happy new year!&lt;br&gt;
It has been a few months now since I posted my last blog post. It wasn’t just the stress (open source projects, work, study) that prevented me from writing, but more that I’ve found no really good topic to blog about.&lt;/p&gt;
&lt;p&gt;Personally, what I always found to be interesting are these news aggregation sites. You know them: &lt;a href=&quot;https://news.google.com/&quot;&gt;Google News&lt;/a&gt;, &lt;a href=&quot;http://news.yahoo.com/&quot;&gt;Yahoo News&lt;/a&gt; etc. They are crawling the web, getting fresh articles about what happens in the world, group them together and present them. Also, they require a lot of machine learning and natural language processing- topics that most of my blogposts are already about.&lt;/p&gt;
&lt;p&gt;Since my last posts are more about distributing such algorithms, I want to focus alot more on the application of several algorithms and intentions in order to build up such a news aggregation engine. I know this is a topic where you can write several books about, but I think we can build a working application within three to five blog posts. My personal goal would be to derive a small Java application, that you just start with a seed of a few URLs and it is grouping the incoming pages in realtime- so you can watch the result in an embedded jetty web application by refreshing the site constantly. I currently have some simple parts of it clamped together, but they don’t act as a single application so I will rewrite this for the public ;-)&lt;/p&gt;
&lt;p&gt;Here is a rough topic grind what we need to cover in order to plug the system together:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Crawling and extraction of news articles&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Detect text encodings while crawling (otherwise you’ll get low quality results)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Article Classification (you have to detect that a site contains an article)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Boilerplate Removal (you don’t care about the design, so remove it!)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Page Deduplication (Archieves or mirrors host the same article, we want to sort out those fast)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Topic modelling of news articles&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Named Entity Recognition (News are about people and events, so we have to detect them)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Grouping News&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Hierarchical clustering with realtime extension&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We will use frameworks for some parts of the task, some coursework from online courses, but the most things are written by myself. &lt;/p&gt;
&lt;p&gt;So stay tuned, I will start with basic crawling in the next post and how to detect encodings efficiently.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Java XOR Swap Performance]]></title><description><![CDATA[Hey, just quick post, because I was working to polish my min heap and checked about different swap techniques. From my experience I know…]]></description><link>https://blog.thomasjungblut.com/blogger/java-xor-swap-performance/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/java-xor-swap-performance/</guid><pubDate>Sat, 06 Oct 2012 21:12:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey,&lt;br&gt;
just quick post, because I was working to polish my min heap and checked about different swap techniques.&lt;/p&gt;
&lt;p&gt;From my experience I know there are two different versions to swap two integers in an array.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;XOR swap algorithm&lt;/li&gt;
&lt;li&gt;Swap using temporary variable&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Since swapping is used pretty much everywhere, I decided to micro benchmark these against each other using &lt;a href=&quot;http://code.google.com/p/caliper/&quot;&gt;Caliper&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I’ve seen many people using the XOR algorithm lately, I don’t know if they know that this is inefficient. Many people seem to do not care about this, because bitshifting makes them kinda look cool probably? However, here is my code so we can sort out the performance of both pretty easy:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SwapBenchmark&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SimpleBenchmark&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Param&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;10&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;100&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1000&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;10000&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;100000&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1000000&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;10000000&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;100000000&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; size&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Param&lt;/span&gt;  
  &lt;span class=&quot;token class-name&quot;&gt;SwapType&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SwapType&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token constant&quot;&gt;XOR&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;TMP&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; array&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setUp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    array &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;size&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;Random&lt;/span&gt; r &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; size&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;nextInt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;timeSwap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; reps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; rep &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; rep &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; reps&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; rep&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; sum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; size&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; size &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;type &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SwapType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;XOR&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
          array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;^=&lt;/span&gt; array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
          array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;^=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;^=&lt;/span&gt; array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
          sum &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
          &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; tmpIndex &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
          array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
          array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; tmpIndex&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
          sum &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
      &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sum&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;Runner&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SwapBenchmark&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So basically I’m swapping n-times in an n-size array, where n ranges from ten to 100,000,000 which is really big.&lt;/p&gt;
&lt;p&gt;The result isn’t very exciting, I used my Nehalem i7 with 3,3GHZ and latest Java7u7:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;      size type        us linear runtime  
       10  XOR      2,90 =  
       10  TMP      2,84 =  
      100  XOR      3,06 =  
      100  TMP      2,85 =  
     1000  XOR      3,92 =  
     1000  TMP      3,52 =  
    10000  XOR     20,21 =  
    10000  TMP     14,22 =  
   100000  XOR    183,33 =  
   100000  TMP    118,57 =  
  1000000  XOR   1822,98 =  
  1000000  TMP   1192,19 =  
 10000000  XOR  19401,65 ==  
 10000000  TMP  13266,78 ==  
100000000  XOR 194173,73 ==============================  
100000000  TMP 134364,67 ====================  
  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The TMP swap is much more efficient in every case. Why is this?&lt;br&gt;
&lt;a href=&quot;http://en.wikipedia.org/wiki/XOR_swap_algorithm&quot;&gt;Wikipedia states the following:&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;On modern CPU architectures, the XOR technique is considerably slower than using a temporary variable to do swapping. One reason is that modern CPUs strive to execute instructions in parallel via &lt;a href=&quot;http://en.wikipedia.org/wiki/Instruction_pipeline&quot; title=&quot;Instruction pipeline&quot;&gt;instruction pipelines&lt;/a&gt;. In the XOR technique, the inputs to each operation depend on the results of the previous operation, so they must be executed in strictly sequential order. If efficiency is of tremendous concern, it is advised to test the speeds of both the XOR technique and temporary variable swapping on the target architecture.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There is actually nothing more to add. &lt;strong&gt;So please don’t do any pre-mature optimization!&lt;/strong&gt;&lt;br&gt;
Even if it looks cool to do a bit-shifting trick ;)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Particle Swarm Optimization]]></title><description><![CDATA[Hey there, I recently started to attend a artificial intelligence lecture (a real course, not online) and we have gotten a small intro to…]]></description><link>https://blog.thomasjungblut.com/blogger/particle-swarm-optimization/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/particle-swarm-optimization/</guid><pubDate>Sat, 01 Sep 2012 19:13:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey there,&lt;/p&gt;
&lt;p&gt;I recently started to attend a artificial intelligence lecture (a real course, not online) and we have gotten a small intro to &lt;a href=&quot;http://ccl.northwestern.edu/netlogo/&quot;&gt;NetLogo&lt;/a&gt; yesterday. Although I’m not a real fan of it (mainly because I was tortured with LOGO as a kid, you don’t know how painful it is if you already know C++), I liked the idea of plotting agents and scripting all kinds of logic in a compressed way.&lt;/p&gt;
&lt;p&gt;So I used to came across an example in their modules library called “Particle Swarm Optimization” (PSO), which was really amazing. I can give you a small picture of it:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://ccl.northwestern.edu/netlogo/models/models/Sample%20Models/Computer%20Science/Particle%20Swarm%20Optimization.png&quot;&gt;&lt;img src=&quot;http://ccl.northwestern.edu/netlogo/models/models/Sample%20Models/Computer%20Science/Particle%20Swarm%20Optimization.png&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;You can see a lot of colored particles (or agents) and a terrain that is greyscaled according to its height. Your job is to find a pretty good minimum (whitened areas) in this terrain via swarm intelligence.&lt;/p&gt;
&lt;p&gt;A short summary is, that if you have a function and want to minimize the cost by a given parameter set “Theta”, you can use the PSO algorithm to find a good minimum of your function. You can compare this for example with &lt;a href=&quot;http://en.wikipedia.org/wiki/Gradient_descent&quot;&gt;Gradient Descent&lt;/a&gt; or &lt;a href=&quot;http://codingwiththomas.blogspot.de/2012/02/nonlinear-conjugate-gradient-method-in.html&quot;&gt;Conjugate Gradient&lt;/a&gt;, but there is a subtle difference between them, for PSO &lt;strong&gt;no&lt;/strong&gt; differentiable function is needed.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Intuition&lt;/strong&gt;&lt;br&gt;
Of course I will provide you with the basic intuition of this algorithm. So I told that there is a certain number of agents in this algorithm. They are initialized uniformly distributed in our search space, ideally you want to fill the map to get a good spread of your agents so your chance is higher to find a global minimum.&lt;/p&gt;
&lt;p&gt;For a fixed number of iterations, you are going to change the position of each particle randomized with a weight on three objectives which are parameters of this meta-optimizer.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Alpha (in literature also called φp / Phi_personal) is the weight of an agent following its personal memory (based on prior found minimas)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Beta (in literature also called φg / Phi_global) is the weight of an agent following the global memory of the swarm (based on the currently best minimum from the swarm)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Phi (in literature also called ω / Omega) is the inertia/velocity of an agent.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;From the parameters you can tell that each particle has its own memory (the best personal found solution), also there is a swarm memory, which basically is just a record of the currently best found solution from all particles.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Math&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;To understand the weighted formula of the movement of the particles, we have to have a look at the formula:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://2.bp.blogspot.com/-DpQysZPk2R8/UEJW_u6JS4I/AAAAAAAABlI/VCXKbWbf1rE/s1600/PSO_formula.png&quot;&gt;&lt;img src=&quot;http://2.bp.blogspot.com/-DpQysZPk2R8/UEJW_u6JS4I/AAAAAAAABlI/VCXKbWbf1rE/s1600/PSO_formula.png&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Formula to calculate the new position of a particle, based on the current position “v”&lt;/p&gt;
&lt;p&gt;You can see, to calculate the movement of a particle, you have a weighted radomized linear combination of the above parameters. Non-mathematically interpreted, the agent is on the move and it is attracted to either its personal best solution or the global best solution. By setting the parameters you can fine tune the behaviour of each particle in this regard.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Algorithm&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The algorithm is quite easy, because there is some really good &lt;a href=&quot;http://en.wikipedia.org/wiki/Particle_swarm_optimization#Algorithm&quot;&gt;pseudo code on Wikipedia&lt;/a&gt;.&lt;br&gt;
However here is my small summary of it:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Initialize…&lt;/li&gt;
&lt;li&gt;the particle positions to some random positions in our search space&lt;/li&gt;
&lt;li&gt;the memorys of the agents and the swarm memory&lt;/li&gt;
&lt;li&gt;In each iteration until we haven’t hit our maximum iterations do…&lt;/li&gt;
&lt;li&gt;loop over all particles&lt;/li&gt;
&lt;li&gt;calculate the new position of a particle&lt;/li&gt;
&lt;li&gt;check the cost of this position, if its smaller than the particles memory then update, do the same update with the global memory if its smaller.&lt;/li&gt;
&lt;li&gt;Profit!&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This is a nice and easy algorithm. To further visualize it, I have found a very good youtube video about it, implemented with MatLab: &lt;a href=&quot;http://www.youtube.com/watch?v=bbbUwyMr1W8&quot;&gt;http://www.youtube.com/watch?v=bbbUwyMr1W8&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;There you can see the movement of the particles very well for a number of functions.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;In Java&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Of course I have done this in Java with my math library. So let’s dive into my normal testcase of the function &lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://3.bp.blogspot.com/-0Dmi4vOcBxQ/UEJarslc9aI/AAAAAAAABlY/cwC66p0O4ME/s1600/chart.png&quot;&gt;&lt;img src=&quot;http://3.bp.blogspot.com/-0Dmi4vOcBxQ/UEJarslc9aI/AAAAAAAABlY/cwC66p0O4ME/s1600/chart.png&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Which is a good testcase, because it is convex so it has a global minimum which can be good tested.&lt;/p&gt;
&lt;p&gt;A nice looking plot of it:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://4.bp.blogspot.com/-GciilGLgVmY/UEJdsNu0U5I/AAAAAAAABlo/nooMsAo_yik/s1600/plot.png&quot;&gt;&lt;img src=&quot;http://4.bp.blogspot.com/-GciilGLgVmY/UEJdsNu0U5I/AAAAAAAABlo/nooMsAo_yik/s320/plot.png&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Convex function f(x,y) = x^2 + y^2&lt;/p&gt;
&lt;p&gt;Let’s sneak into the Java code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;DoubleVector&lt;/span&gt; start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DenseDoubleVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt;\&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;\&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token comment&quot;&gt;// our function is f(x,y) = x^2+y^2  &lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;CostFunction&lt;/span&gt; inlineFunction &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CostFunction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Tuple&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Double&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DoubleVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;evaluateCost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;DoubleVector&lt;/span&gt; input&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  

    &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; cost &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Tuple&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Double&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DoubleVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cost&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token class-name&quot;&gt;DoubleVector&lt;/span&gt; theta &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ParticleSwarmOptimization&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;minimizeFunction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;  
    inlineFunction&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; start&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token comment&quot;&gt;// retrieve the optimal parameters from theta  &lt;/span&gt;
 &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We run 1000 particles for 100 iterations, with a weight of 0.1 to the personal best solution, 0.2 to the swarm solution and 0.4 for its own exploration. Basically this was the usage of the algorithm, you can see that we don’t need a gradient in this computation (it is nulled). Theta in this case should contain a value close to zero.&lt;/p&gt;
&lt;p&gt;Of course you can find the &lt;a href=&quot;https://github.com/thomasjungblut/thomasjungblut-common/blob/master/src/main/java/de/jungblut/math/minimize/ParticleSwarmOptimization.java&quot;&gt;source code here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;And the &lt;a href=&quot;https://github.com/thomasjungblut/thomasjungblut-common/blob/master/src/test/java/de/jungblut/math/minimize/ParticleSwarmOptimizationTest.java&quot;&gt;testcase above in here&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Creating a semantic graph]]></title><description><![CDATA[This is a small follow-up post to the similarity aggregation (short SEISA, set expansion by iterative similarity aggregation) post before…]]></description><link>https://blog.thomasjungblut.com/blogger/creating-semantic-graph/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/creating-semantic-graph/</guid><pubDate>Sat, 04 Aug 2012 10:16:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;This is a small follow-up post to the similarity aggregation (short SEISA, set expansion by iterative similarity aggregation) post before, it is just a small idea about creating a graph from data collected by this algorithm. So don’t expect the master plan how to create a semantic graph from your data, it is just some brainstorming post.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I was very much into semantic relations in the last few months and I think the best way to express them is a graph.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://3.bp.blogspot.com/-cN1UxplPjSg/UBzsvIZqBiI/AAAAAAAABkk/uZ-vWDNvJoc/s1600/semanticgraph.JPG&quot;&gt;&lt;img src=&quot;http://3.bp.blogspot.com/-cN1UxplPjSg/UBzsvIZqBiI/AAAAAAAABkk/uZ-vWDNvJoc/s320/semanticgraph.JPG&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;You may be reminded of the &lt;a href=&quot;http://www.google.com/insidesearch/features/search/knowledge.html&quot;&gt;Knowledge Graph by Google&lt;/a&gt;, yes it actually was inspired by it. However it is much more computationally heavy to use it (and even build it) than you might think of it first.&lt;/p&gt;
&lt;p&gt;In any case, an algorithm that builds this can be seeded from the SEISA algorithm. Think of a generic starting point that starts in wikipedia and reads the facts about &lt;a href=&quot;http://en.wikipedia.org/wiki/Gau%C3%9F&quot;&gt;Carl Friedrich Gauss&lt;/a&gt;, keywords like “mathematician” will yield to other mathematicians very fast.&lt;/p&gt;
&lt;p&gt;Google is (MAYBE) mainly using the semantic annotations to create a relation between the nodes, which is mainly depth first search (because you get a lot of information through Gauß). Whereas the SEISA information could yield to more breadth results like other mathematicians in his century like Riemann or Poincaré.&lt;/p&gt;
&lt;p&gt;Creating this semantic graph for (at least) products, brands and other product related features will be my personal ambition for the next few years. Of course Google aims at the most generic way, they have the computational resources to do it for all the web.&lt;/p&gt;
&lt;p&gt;Another problem they have is actually how to cut off information to be valuable to the user. Not everybody searching for “Gauß” is interested in his whole life story or other mathematicians, but maybe more into the algorithm for solving equations.&lt;/p&gt;
&lt;p&gt;Also understanding queries and parsing the graph accordingly is another interesting new research field.&lt;br&gt;
For example in the above graph arround Canon, what if a user wants to know about other brands LIKE Canon (SQL like for example: SELECT brands LIKE “Canon”). In this case, an engine would traverse the graph breadth first search starting by Canon to find nodes with the attribute “Brand”. It would find their brand PIXMA and EOS. Distance is also a very important topic in this relation, how far are the relevant nodes away from their starting point?&lt;/p&gt;
&lt;p&gt;Frameworks building such a graph is currently a very important aspect. There are a few helpful ones:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Graph databases, e.G. Titan  &lt;a href=&quot;https://github.com/thinkaurelius/titan&quot;&gt;https://github.com/thinkaurelius/titan&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Graph only focused processing engines, e.G. Giraph  &lt;a href=&quot;http://giraph.apache.org/&quot;&gt;http://giraph.apache.org/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Of course Hama, to use sophisticated machine learning or mathematical algorithms that can’t be expressed as a graph  &lt;a href=&quot;http://hama.apache.org/&quot;&gt;http://hama.apache.org/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Good old Hadoop MapReduce is of course a help for various data crunchings as well.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Beeing part of that, is one of the things I most enjoy.&lt;/p&gt;
&lt;p&gt;We will see how far Google integrates the graph into their search, it will be a driving factor if they manage to query a large scale graph successfully and within milliseconds.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Set Expansion by Iterative Similarity Aggregation]]></title><description><![CDATA[Hey all, been a very long time since my last post. I was very busy with Apache Hama, we have graduated from the Apache incubator and call us…]]></description><link>https://blog.thomasjungblut.com/blogger/set-expansion-by-iterative-similarity/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/set-expansion-by-iterative-similarity/</guid><pubDate>Sat, 04 Aug 2012 09:47:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey all,&lt;/p&gt;
&lt;p&gt;been a very long time since my last post. I was very busy with &lt;a href=&quot;http://hama.apache.org/&quot;&gt;Apache Hama&lt;/a&gt;, we have graduated from the Apache incubator and call us now a top level project and of course made another release 0.5.0. I think this was just the beginning of a rising open source project and I am really excited to be a part of it.&lt;br&gt;
However, responsibility comes with spending a lot of time. Time is always sparse, especially if you are young and have a lot of stuff to do.&lt;/p&gt;
&lt;p&gt;So blog posts like this will be very sparse in the future, but today it should not matter and I will tell you about a semi-supervised learning algorithm with the very phonetic name called SEISA.&lt;br&gt;
SEISA itself is a acronym for “Set Expansion by Iterative Similarity Aggregation”, not an invention by me rather than a wrap-up and implementation of the &lt;a href=&quot;http://pages.cs.wisc.edu/~heyeye/paper/Set-expansion.pdf&quot;&gt;paper I found here&lt;/a&gt; by Yeye He and Dong Xin.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;What is Set Expansion?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Set expansion is used to find similar words to an a priori given list of items in a given “artificial environment”. For example you want to find additional digitial camera brands to a given seed set like {Canon, Nikon} and the algorithm should provide you with additional brands like Olympus, Kodak, Sony and/or Leica.&lt;br&gt;
“Artificial environment” is actually a generic term for a context that you have to provide. In the referenced paper it is majorly the internet (crawled pages) and search query logs.&lt;/p&gt;
&lt;p&gt;In a real world scenario, set expansion might be used to create a semantic database of related items, improve relevance of search querys, leverage the performance of other named entity recognition algorithms, or maybe also for SEO things (Dear SEOs, I won’t help you on that, even if you pay me a lot of $$$).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Data Model&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The main idea behind the algorithm is the data modelling. How do we represent this “artificial environment” (will call it context from now on) I talked about above?&lt;br&gt;
The idea is like in any sophisticated algorithm: as a graph! Actually as a so called &lt;a href=&quot;http://en.wikipedia.org/wiki/Bipartite_graph&quot;&gt;bipartite graph&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://2.bp.blogspot.com/-sEw8F9NHbzM/UBQ3GSrwJZI/AAAAAAAABj8/EVMslzkW-pM/s1600/seisa.JPG&quot;&gt;&lt;img src=&quot;http://2.bp.blogspot.com/-sEw8F9NHbzM/UBQ3GSrwJZI/AAAAAAAABj8/EVMslzkW-pM/s320/seisa.JPG&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Example of a bipartite graph from list data&lt;/p&gt;
&lt;p&gt;On the left side of this bipartite graph are the so called “candidate terms”, the seedset we provide should be a subset of them. The nodes on the right are called the context nodes, they are representing the link between the candidate terms. In the case of the paper, they have crawled the internet for &lt;a href=&quot;http://www.w3schools.com/html/html_lists.asp&quot;&gt;list items&lt;/a&gt; and created an edge to a candidate term if it exists in a given list. The neigbours of a context nodes, are the actual list items in this case. In the case of the web, the picture should also contain words that are not digital camera brands, also think about this simple rule: “more data wins”. As in every normal graph, you can also weight the edges, for example if you trust the list data from wikipedia more than of craigslist, then you should assign a higher weight the edges between the context nodes and their candidate term nodes.&lt;/p&gt;
&lt;p&gt;I have implemented it by a String array and a DoubleMatrix, where the string array is representing the term nodes and the matrix (NxM, where n is the number of entity tokens and m is the number of context nodes) is representing the weight of the edges. In my experience this matrix is always very sparse, even on very small datasets. &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Iterative Similarity Aggregation (the algorithm)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Time to describe the algorithm, now we know how we represented the data.&lt;br&gt;
It is rather simply to explain and I don’t know why they complicated it so much in their paper.&lt;/p&gt;
&lt;p&gt;There are three main methods, first the relevance score computation, the method that filters out newly top ranked items and at last the ranking function.&lt;/p&gt;
&lt;p&gt;The relevance score computation is working like this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Loop over all the terms in your matrix while looping over all terms in your seedset&lt;/li&gt;
&lt;li&gt;Get the column vector of your seed element and the column vector of the candidate term&lt;/li&gt;
&lt;li&gt;Measure the similarity between both and sum this similarity over all seedset terms, in the paper it is normalized by the length of the seedset, so it is actually the average similarity&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;What you now get is a vector (length is the number of term nodes you have), and in each index is the average relevance score to the seedset tokens.&lt;/p&gt;
&lt;p&gt;Of course you want to pick the highest relevance nodes of this vector, that’s where the static thresholding comes in. You pass the algorithm a similarity threshold, this threshold affects how fast the algorithm converges to a certain solution and how much false positives it will have in the end. Of course a higher threshold will yield to less false positives and faster convergence, while the exact opposite will yield to the other extremum. The truth (as always) lies anywhere between, so it is up to you to choose this correctly.&lt;/p&gt;
&lt;p&gt;Since the algorithm always converges quite fast, you can experiment with other thresholds and see how it affects your output. Sure we are going to filter by the threshold and get a number of most relevant new candidate nodes.&lt;/p&gt;
&lt;p&gt;Now we can enter the main loop and compute the relevance score again for the newly found relevant candidates (this is now called the similarity score). Based on this we are going to rank these two scores with some simple vecor multiplications:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://2.bp.blogspot.com/-BDpLLWsd08E/UBzkczz8EOI/AAAAAAAABkM/zx8M7BGx1CE/s1600/ranks.JPG&quot;&gt;&lt;img src=&quot;http://2.bp.blogspot.com/-BDpLLWsd08E/UBzkczz8EOI/AAAAAAAABkM/zx8M7BGx1CE/s400/ranks.JPG&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;So where does this alpha come from? That is what the paper names as “weighting factor”, as you can see it is used to weight the scores. It is mainly used for the convergence of the algorithm, they say, halfing the scores (alpha = 0.5) yields to the best result.&lt;/p&gt;
&lt;p&gt;Once we have a ranked scores, we can now filter again by the similarity threshold and get our new candidate terms for the next iteration. &lt;/p&gt;
&lt;p&gt;In each iteration we do:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Compute similarity score by newly found candidate terms (in the beginning this is the seed set)&lt;/li&gt;
&lt;li&gt;Rank the calculated similarity score against the newly found candidate terms&lt;/li&gt;
&lt;li&gt;Apply the static threshold and get new candidate terms&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Until it converges: by means the relevant tokens does not change their order anymore- they are equal. Note that you can also equalize on their ranks, I haven’t tried it yet but it should converge also quite fast.&lt;/p&gt;
&lt;p&gt;At the end you can now optain your expanded set by getting the candidate terms from the last iteration.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Results&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Since I’m working in the e-commerce industry, I wanted to try it out to find similar camera brands like in the paper. It works, but it has very noisy result, partly because the algorithm is just iterative and not parallelized thus I can’t work on huge datasets and partly because I had no real clean dataset.&lt;/p&gt;
&lt;p&gt;But it really worked, I seeded “Canon” and “Olympus” and got all the other camera brands, sadly a few lenses as well.&lt;/p&gt;
&lt;p&gt;On colors there are some similar behaviours, I seeded “blue”, “red” and “yellow”. Funnyly the most relevant token was “X” and “XS”, by means that especially t-shirt products have the color in their name. It became very noise afterwards, found Ronaldo jerseys and other fancy clothes, but a bunch of new colors also.&lt;/p&gt;
&lt;p&gt;The paper mentions a really nice trick for it: using the internet!&lt;/p&gt;
&lt;p&gt;They have collected millions of list items from websites and let the algorithm run, in my opinion in every machine learning algorithm more data wins. The noise on small dataset will be vanished by the sheer size of the data. So I can very much think that they got really good result.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Parallelization strategy&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The easiest way to parallelize this is using BSP and Apache Hama (in my opinion). &lt;/p&gt;
&lt;p&gt;Let me tell you why:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Algorithm is strongly iterative&lt;/li&gt;
&lt;li&gt;Needs communication between a master and the slaves&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here is my strategy to implement this in BSP:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The bipartite graph is split among the tasks, partitioned by the term nodes&lt;/li&gt;
&lt;li&gt;A slave only partially computes the similarity between the seed tokens and the candidate terms&lt;/li&gt;
&lt;li&gt;A master will be used to put all the similarities back into a single vector, rank it and distribute the newly expanded set again as well as checking convergence.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This is pretty much work, so I guess the follow-up post will take a few weeks. But I promise, I will code this algorithm!&lt;/p&gt;
&lt;p&gt;So thank you very much for reading, you can find &lt;a href=&quot;https://github.com/thomasjungblut/thomasjungblut-common/blob/master/src/de/jungblut/ner/IterativeSimilarityAggregation.java&quot;&gt;my sequential code on github&lt;/a&gt;, as well as &lt;a href=&quot;https://github.com/thomasjungblut/thomasjungblut-common/blob/master/src/test/java/de/jungblut/ner/IterativeSimilarityAggregationTest.java&quot;&gt;the testcase&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Distributed DBSCAN (Intuition)]]></title><description><![CDATA[Hey all, it has been quite a long time since my last blog post. Thanks to my work, to keep me busy all day and don’t let me research on cool…]]></description><link>https://blog.thomasjungblut.com/blogger/distributed-dbscan-intuition/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/distributed-dbscan-intuition/</guid><pubDate>Sun, 06 May 2012 16:49:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey all,&lt;/p&gt;
&lt;p&gt;it has been quite a long time since my last blog post. Thanks to my work, to keep me busy all day and don’t let me research on cool new things. However, over the few holidays and weekends over the last weeks I came across a very interesting algorithm called DBSCAN.&lt;br&gt;
It is abbreviated for ”&lt;em&gt;density-based spatial clustering of applications with noise&lt;/em&gt;”, it is a unsupervised clustering algorithm just like k-means, besides that it is much smarter in many aspects.&lt;br&gt;
Another objective I’d like to solve is the parallelization of this algorithm. I’ve seen just some ancient papers and what buffels me is that I’ve seen no implementation in Mahout (for MapReduce) or other distributed frameworks.&lt;/p&gt;
&lt;p&gt;As you may know, I’m working for Apache Hama. It is a framework for distributed computing with the BSP (bulk synchronous parallel) model. I always searching for new algorithms that could fit into the model of BSP computing, e.G. graph algorithms of all sorts, strongly iterative algorithms, real-time algorithms.&lt;br&gt;
And I think that DBSCAN also fits into the BSP model, I tell you why a bit later in this post.&lt;br&gt;
First off, just a little introduction of the DBSCAN algorithm itself…&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The algorithm&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The algorithm is very easy to understand. Actually you have a bunch of points (or vectors in higher dimensionalities) as input, then you have to parameters and some fancy output.&lt;br&gt;
The two parameters are called &lt;em&gt;“epsilon”&lt;/em&gt; and &lt;em&gt;“minpoints”,&lt;/em&gt; epsilon is the minimum distance between two vectors to connect two points &lt;strong&gt;strongly&lt;/strong&gt; and minpoints is the number of points that are at least needed to build a cluster out of strongly connected vectors.&lt;br&gt;
Now you are going through the graph, point by point, marking visited vectors and adding points to a cluster while they are not violating the rules defined by epsilon and minpoints.&lt;/p&gt;
&lt;p&gt;You can read on &lt;a href=&quot;http://en.wikipedia.org/wiki/DBSCAN&quot;&gt;wikipedia&lt;/a&gt; about how the sequential version works in detail, however I am going to propose a much more easier to understand version of the algorithm.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Distributed algorithm steps&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Instead of defining a big distributed algorithm that translates the sequential version into some distributed programming model, I have assembled three main steps to get the same result as the sequential version.&lt;br&gt;
However each of these steps are strongly parallelizable in every major programming model (at least I know how it works in MapReduce, BSP and MPI).&lt;/p&gt;
&lt;p&gt;Here are the three steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;compute a distance matrix between the vectors with a given distance measurement&lt;/li&gt;
&lt;li&gt;trivial step to parallelize, can also be merged with the next point&lt;/li&gt;
&lt;li&gt;extract adjacent points via the epsilon threshold and the minpoints restriction&lt;/li&gt;
&lt;li&gt;This step creates an adjacency list/matrix representing a graph&lt;/li&gt;
&lt;li&gt;Noise is filtered at this step of the algorithm&lt;/li&gt;
&lt;li&gt;run a connected component algorithm on the resulting graph of the previous step&lt;/li&gt;
&lt;li&gt;Already done that in &lt;a href=&quot;http://codingwiththomas.blogspot.de/2011/04/graph-exploration-with-hadoop-mapreduce.html&quot;&gt;MapReduce&lt;/a&gt; and &lt;a href=&quot;http://codingwiththomas.blogspot.de/2011/04/graph-exploration-using-apache-hama-and.html&quot;&gt;BSP&lt;/a&gt;, the last BSP version will be updated shortly after Apache Hama 0.5.0 comes out.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;These three simple steps will give you the same result as a DBSCAN. Normally you can merge step 1 with step two, you can simply extract the adjacents points while computing the distances. &lt;/p&gt;
&lt;p&gt;In the end, you will receive n-connected components, every of them will represent a cluster.&lt;/p&gt;
&lt;p&gt;The delta to the points of your original input would be the noise cluster.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt; that the initial step is O(n²) which is obviously pretty bad and not scalable. So think about techniques like &lt;a href=&quot;http://en.wikipedia.org/wiki/Locality-sensitive_hashing&quot;&gt;Similarity Hashing&lt;/a&gt; to speed this step up.&lt;/p&gt;
&lt;p&gt;Pretty easy right? I think it is even more easier than the pseudocode on wikipedia.&lt;/p&gt;
&lt;p&gt;Of course I put up a &lt;a href=&quot;https://github.com/thomasjungblut/thomasjungblut-common/blob/master/src/main/java/de/jungblut/clustering/DBSCAN.java&quot;&gt;sample version (albeit sequential) on my github repo&lt;/a&gt;. There is also the &lt;a href=&quot;https://github.com/thomasjungblut/thomasjungblut-common/blob/master/src/main/java/de/jungblut/clustering/DBSCANClustering.java&quot;&gt;original DBSCAN algorithm for comparison&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There is a nice plot I received when running it:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://1.bp.blogspot.com/-Ee0cBBn1wr4/T6apx5kMTgI/AAAAAAAABig/UONAjcTrP2I/s1600/dbscan.JPG&quot;&gt;&lt;img src=&quot;http://1.bp.blogspot.com/-Ee0cBBn1wr4/T6apx5kMTgI/AAAAAAAABig/UONAjcTrP2I/s320/dbscan.JPG&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;To make the noise more easy to spot, I have made horrible yellow circles arround them with Paint, please forgive me ;)&lt;/p&gt;
&lt;p&gt;So far I haven’t found the time to implement this whole system with Apache Hama. &lt;a href=&quot;http://stackoverflow.com/questions/15863566/need-assistance-with-implementing-dbscan-on-map-reduce/15863699#15863699&quot;&gt;However, if you want to practically use this here are some advices&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;For the distance matrix to compute, better use a heuristic to find close vectors&lt;/li&gt;
&lt;li&gt;Mahout has a MinHashing implementation of such a clustering&lt;/li&gt;
&lt;li&gt;Once you obtained “mini” clusters, you can compute more expensive distance measurements and extract your graph (step two in the above list)&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Nonlinear conjugate gradient method in Java]]></title><description><![CDATA[Hi all, I have been a bit busy for the last few weeks with some projects. But fortunately I found some time on the last weekend to implement…]]></description><link>https://blog.thomasjungblut.com/blogger/nonlinear-conjugate-gradient-method-in/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/nonlinear-conjugate-gradient-method-in/</guid><pubDate>Mon, 27 Feb 2012 22:30:00 GMT</pubDate><content:encoded>&lt;p&gt;Hi all,&lt;/p&gt;
&lt;p&gt;I have been a bit busy for the last few weeks with some projects. But fortunately I found some time on the last weekend to implement a recommandation engine for myself based on what we have done in &lt;a href=&quot;http://ml-class.org/&quot;&gt;ml-class.org&lt;/a&gt; lessons in octave and translate it to a Java version.&lt;/p&gt;
&lt;p&gt;If you attended ml-class you might be familiar that you need to minimize a rather complex cost function based on what the user likes in terms of movies.&lt;br&gt;
However I haven’t found a &lt;strong&gt;simple and not ancient&lt;/strong&gt; Java library containing a fully working conjugate gradient method. Shorthand I decided to translate it from Octave to Java. It took me 5-6 hours to build a Octave-like vector library arround it to translate it quite 1:1. But it was really worth it.&lt;/p&gt;
&lt;p&gt;And here is the &lt;a href=&quot;https://github.com/thomasjungblut/thomasjungblut-common/blob/master/src/main/java/de/jungblut/math/minimize/Fmincg.java&quot;&gt;Fmincg.java&lt;/a&gt; code.&lt;/p&gt;
&lt;p&gt;Fmincg btw stands for &lt;strong&gt;F&lt;/strong&gt;unction &lt;strong&gt;mi&lt;/strong&gt;nimize &lt;strong&gt;n&lt;/strong&gt;onlinear &lt;strong&gt;c&lt;/strong&gt;onjugant &lt;strong&gt;g&lt;/strong&gt;radient. It wasn’t clear for me in the first place and I really started to understand the algorithm when I translated it.&lt;/p&gt;
&lt;p&gt;It works quite like the version in octave, you pass an input vector (which is used as a starting point) and a costfunction along with a number of iterations to do.&lt;br&gt;
Since I’m a hacker by heart, I want to give you a sample code to try it out for yourself.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I have prepared a simple quadratic function for you&lt;br&gt;
f(x) = (4-x)^2+10&lt;/p&gt;
&lt;p&gt;Obviously since this is quadratic this has a global minimum which is easy to spot because I used the binomial version of the function, we will see if fmincg finds it.&lt;/p&gt;
&lt;p&gt;For the algorithm we constantly need to calculate the gradients of the input in our cost function. Therefore we need the derivative which is for our function&lt;br&gt;
f(x)’ = 2x-8&lt;/p&gt;
&lt;p&gt;If you’re a math crack then you know that the f(x) hits (int our case) the minimum where the derivative cut’s the x-axis or y=0.&lt;/p&gt;
&lt;p&gt;Since this is quite hard to visualize, I have made a picture for you:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://3.bp.blogspot.com/-MG11lpkMb1E/T0wAmw7AGiI/AAAAAAAAAXg/6kn9lnY3I34/s1600/graph.png&quot;&gt;&lt;img src=&quot;http://3.bp.blogspot.com/-MG11lpkMb1E/T0wAmw7AGiI/AAAAAAAAAXg/6kn9lnY3I34/s400/graph.png&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Function f(x) and its derivative&lt;/p&gt;
&lt;p&gt;Not difficult to spot, you see the black function is our f(x) whereas the green line is our derivative. And it hits the x-axis right at the minimum of the function. Great!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;How do we code this?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;This is quite simple, I show you the code first:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; startPoint &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token comment&quot;&gt;// start at x=-5  &lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;DenseDoubleVector&lt;/span&gt; start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DenseDoubleVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; startPoint &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token class-name&quot;&gt;CostFunction&lt;/span&gt; inlineFunction &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CostFunction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Tuple&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Double&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DenseDoubleVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;evaluateCost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;  
      &lt;span class=&quot;token class-name&quot;&gt;DenseDoubleVector&lt;/span&gt; input&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      
    &lt;span class=&quot;token comment&quot;&gt;// our function is f(x) = (4-x)^2+10, so we can calculate the cost  &lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; cost &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// the derivative is f(x)&apos; = 2x-8 which is our gradient value  &lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;DenseDoubleVector&lt;/span&gt; gradient &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DenseDoubleVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;\&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Tuple&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Double&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DenseDoubleVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cost&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; gradient&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token class-name&quot;&gt;DenseDoubleVector&lt;/span&gt; minimizeFunction &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Fmincg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;minimizeFunction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;inlineFunction&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; start&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token comment&quot;&gt;// should return 4  &lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Found a minimum at: &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; minimizeFunction&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see we have to allocate the vector which is containing our start “point”. You can set this arbitrary randomly, but you have know that it might not hit the global minimum but rather a local minimum. So different random starting points can yield to different results.&lt;/p&gt;
&lt;p&gt;But not in our case. Now you can implement the cost function the algorithm needs the cost of your function at the given point of the input and the value of the derivative at this point.&lt;br&gt;
So we return this after we put the input “x” in our two equations as a tuple.&lt;/p&gt;
&lt;p&gt;The whole application prints:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Interation 1 | Cost: 10,000000  
Interation 2 | Cost: 10,000000  
[4.0]  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Works! And it outputs the x-value of our minima and the cost is 10, which should be the y-value. Very cool!&lt;br&gt;
&lt;a href=&quot;https://github.com/thomasjungblut/thomasjungblut-common/blob/master/src/test/java/de/jungblut/math/minimize/FmincgTest.java&quot;&gt;You can find this example on Github as well as a unit test.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Please use it if you need it, I have already implemented the collaborative filtering algorithm with it and I guess a backprop neural network will follow soon.&lt;/p&gt;
&lt;p&gt;I really have to admit that I am not a math crack although I am studying computer sciences, but math really makes many things easier and if you take a deeper look behind what you’ve learned in school, it is really beautiful.&lt;/p&gt;
&lt;p&gt;Thanks and bye!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[German Stop Words]]></title><description><![CDATA[Hey all, I’m doing some text mining in the last time, so I needed a reliable list of german stop words. The only real advanced version I…]]></description><link>https://blog.thomasjungblut.com/blogger/german-stop-words/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/german-stop-words/</guid><pubDate>Tue, 24 Jan 2012 11:56:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey all,&lt;/p&gt;
&lt;p&gt;I’m doing some text mining in the last time, so I needed a reliable list of german stop words.&lt;br&gt;
The only real advanced version I have found was the lucene ”&lt;a href=&quot;http://lucene.apache.org/java/3_0_1/api/all/org/apache/lucene/analysis/de/GermanAnalyzer.html&quot;&gt;GermanAnalyzer&lt;/a&gt;”. That is the seed of the following list I wanted to share with you.&lt;/p&gt;
&lt;p&gt;I already formatted this as an array that is put into a HashSet, so you can easily use it within your Java code via HashSet#contains(token).&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashSet&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;GERMAN_STOP_WORDS&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashSet&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;  
     &lt;span class=&quot;token class-name&quot;&gt;Arrays&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;and&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;the&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;of&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;to&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;einer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token string&quot;&gt;&quot;eine&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;eines&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;einem&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;einen&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;der&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;die&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;das&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token string&quot;&gt;&quot;dass&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;daß&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;du&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;er&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;sie&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;es&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;was&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;wer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token string&quot;&gt;&quot;wie&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;wir&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;und&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;oder&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ohne&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mit&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;am&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;im&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token string&quot;&gt;&quot;in&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;aus&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;auf&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ist&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;sein&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;war&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;wird&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ihr&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token string&quot;&gt;&quot;ihre&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ihres&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ihnen&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ihrer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;als&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;für&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;von&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token string&quot;&gt;&quot;mit&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;dich&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;dir&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mich&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mir&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mein&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;sein&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token string&quot;&gt;&quot;kein&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;durch&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;wegen&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;wird&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;sich&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;bei&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;beim&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token string&quot;&gt;&quot;noch&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;den&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;dem&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;zu&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;zur&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;zum&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;auf&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ein&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token string&quot;&gt;&quot;auch&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;werden&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;an&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;des&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;sein&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;sind&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;vor&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token string&quot;&gt;&quot;nicht&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;sehr&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;um&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unsere&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ohne&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;so&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;da&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;nur&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token string&quot;&gt;&quot;diese&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;dieser&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;diesem&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;dieses&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;nach&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;über&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token string&quot;&gt;&quot;mehr&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;hat&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;bis&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;uns&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unser&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unserer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unserem&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token string&quot;&gt;&quot;unsers&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;euch&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;euers&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;euer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;eurem&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ihr&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ihres&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token string&quot;&gt;&quot;ihrer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ihrem&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;alle&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;vom&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that there are some english words as well, if you don’t need them, they are just in the first section of the array. So you can easily remove them ;)&lt;/p&gt;
&lt;p&gt;If you have a good stemmer, you can remove other words as well.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;How did I extract them?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;These words are the words that had the highest word frequency in a large set (&gt; 10 Mio.) of text and html documents.&lt;/p&gt;
&lt;p&gt;Have fun and good luck!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[BSP k-means Clustering Benchmark]]></title><description><![CDATA[Hey all, in my last post I already wrote about the kmeans clustering with Apache Hama and BSP. Now we have a detailed benchmark of my…]]></description><link>https://blog.thomasjungblut.com/blogger/bsp-k-means-clustering-benchmark/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/bsp-k-means-clustering-benchmark/</guid><pubDate>Mon, 02 Jan 2012 18:23:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey all,&lt;/p&gt;
&lt;p&gt;in my last post I already wrote about the kmeans clustering with Apache Hama and BSP.&lt;br&gt;
Now we have a detailed benchmark of my algorithm.&lt;/p&gt;
&lt;p&gt;Have a look here for the current state taken from here: &lt;a href=&quot;http://wiki.apache.org/hama/Benchmarks&quot;&gt;http://wiki.apache.org/hama/Benchmarks&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Because it will change during the lifetime of Apache Hama, I made a screenshot from the very first benchmark. Maybe to document performance improvements ;)&lt;/p&gt;
&lt;p&gt;Have a look here:&lt;br&gt;
&lt;a href=&quot;http://1.bp.blogspot.com/-_eRLxCTCbsM/TwH1LK9Y5XI/AAAAAAAAAXE/NLgNNl6FNZo/s1600/bench.JPG&quot;&gt;&lt;img src=&quot;http://1.bp.blogspot.com/-_eRLxCTCbsM/TwH1LK9Y5XI/AAAAAAAAAXE/NLgNNl6FNZo/s400/bench.JPG&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Is it faster than MapReduce?&lt;/strong&gt;&lt;br&gt;
Yes! I recently read in the new &lt;a href=&quot;http://www.manning.com/ingersoll/&quot;&gt;“Taming Text” by Grant S. Ingersoll&lt;/a&gt; that the same amount of workload takes the same time, but in minutes instead of seconds.&lt;/p&gt;
&lt;p&gt;However, I want to benchmark it against the same dataset and on the same machines to get a fully comparable result.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Future Work&lt;/strong&gt;&lt;br&gt;
Besides the benchmark against MapReduce and Mahout, I want to show the guys from Mahout that it is reasonable to use BSP as an alternative to MapReduce. I look forward that they use Apache Hama and BSP within the next year as an alternative to MapReduce implementations for various tasks.&lt;/p&gt;
&lt;p&gt;Thanks to &lt;a href=&quot;https://twitter.com/#!/eddieyoon&quot;&gt;Edward&lt;/a&gt; who made this possible!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[k-Means Clustering with BSP (Intuition)]]></title><description><![CDATA[Hey all, I had a bit time to get my k-means clustering running with BSP and Apache Hama. I wanted to share this with you. Actually this is a…]]></description><link>https://blog.thomasjungblut.com/blogger/k-means-clustering-with-bsp-intuition/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/k-means-clustering-with-bsp-intuition/</guid><pubDate>Sat, 10 Dec 2011 09:05:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey all,&lt;/p&gt;
&lt;p&gt;I had a bit time to get my k-means clustering running with BSP and Apache Hama. I wanted to share this with you.&lt;br&gt;
Actually this is a sequel to a series that I have announced long ago: &lt;a href=&quot;http://codingwiththomas.blogspot.com/2011/05/series-k-means-clustering-mapreduce-bsp.html&quot;&gt;Series: K-Means Clustering (MapReduce | BSP)&lt;/a&gt;.&lt;br&gt;
You may remember that I have already made a post about K-Means and MapReduce, now I want you to show that k-means clustering with BSP is much faster than the MapReduce one.&lt;br&gt;
Don’t expect a benchmark in this post, but I will give you a real comparision a bit later once Apache Hama 0.4.0 rolls out.&lt;br&gt;
So this post is mainly about the algorithm itself and what my ideas were to make it running and scalable.&lt;br&gt;
I’m going to make a next post which is containing more code and explain more clearly how it works. But code is still changing, so this will take a bit more time.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Quick note right at the beginning:&lt;/strong&gt; As I mentioned it, I am currently developing with a Apache Hama 0.4.0 SNAPSHOT, since it hasn’t been released yet.&lt;/p&gt;
&lt;p&gt;Let’s step into it!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Model Classes&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We need some kind of &lt;em&gt;Vector&lt;/em&gt; and something that is going to represent our &lt;em&gt;Center&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;These are very basic, actually it is just a wrapper object with an array of doubles and some convenience methods. A &lt;em&gt;Center&lt;/em&gt; is just the same like a &lt;em&gt;Vector&lt;/em&gt;, but it also adds some more methods to detect if it has converged or averaging two centers.&lt;/p&gt;
&lt;p&gt;You can have a look on Github at them if you’re interested.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/thomasjungblut/thomasjungblut-common/blob/master/src/de/jungblut/clustering/model/Vector.java&quot;&gt;Vector.java&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/thomasjungblut/thomasjungblut-common/blob/master/src/de/jungblut/clustering/model/ClusterCenter.java&quot;&gt;ClusterCenter.java&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Idea behind k-means with Apache Hama’s BSP&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Before really showing you the algorithm in the source code, I’d like to tell you what my plan and intention was. &lt;/p&gt;
&lt;p&gt;In a typical clustering scenario you will have much much more points than centers/means. So n  &gt;&gt;  k (”&gt;&gt;” for much larger than), where n is our number of vectors and k is our number of centers. &lt;/p&gt;
&lt;p&gt;Since Apache Hama 0.4.0 will provide us with a new I/O system it makes it really easy to iterate over a chunk of the input on disk over and over again, we can use this fact and put all our centers into RAM.&lt;/p&gt;
&lt;p&gt;The trick in this case is that unlike in graph algorithms, we do not split the centers over the tasks, but every task holds all k-centers in memory. &lt;/p&gt;
&lt;p&gt;So each task gets a part of the big input file and every task has all centers. &lt;/p&gt;
&lt;p&gt;Now we can easily do our assignment step, we just iterate over all input vectors and measure the distance against every center. &lt;/p&gt;
&lt;p&gt;While iterating we find the nearest center for each of the n vectors. To save memory we are going to average our new center “on-the-fly”. Follow the &lt;a href=&quot;http://en.wikipedia.org/wiki/Average#In_data_streams&quot;&gt;Average in data streams&lt;/a&gt; article on Wikipedia, if you’re not familiar with it. &lt;/p&gt;
&lt;p&gt;At the end of the assignment step, we have in each task the “on-the-fly” computed average new centers. &lt;/p&gt;
&lt;p&gt;Now we are going to broadcast each of this computed averages to the other tasks.&lt;/p&gt;
&lt;p&gt;Then we are going to sync so all messages can be delivered.&lt;/p&gt;
&lt;p&gt;Afterwards we are iterating in each task through the messages and averaging all incoming centers if they belong to the same “old” mean. &lt;/p&gt;
&lt;p&gt;I know this is difficult to explain, but please consult this picture, it is about the exchange of the locally computed mean for two tasks.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://3.bp.blogspot.com/-J9JImXsqb2I/TtuteUeY3ZI/AAAAAAAAAWw/XBenuFxet8A/s1600/messageExchange.png&quot;&gt;&lt;img src=&quot;http://3.bp.blogspot.com/-J9JImXsqb2I/TtuteUeY3ZI/AAAAAAAAAWw/XBenuFxet8A/s320/messageExchange.png&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Message exchange with mean calculation&lt;/p&gt;
&lt;p&gt;As you can see on this picture, we have two tasks which have calculated “their version” of a new mean. Since this isn’t the “global mean” we have to calculate a new mean that will be consistent across all the tasks and is still the correct mathematical mean.&lt;br&gt;
We apply the “Average on data streams” strategy. Each task is going to get the local computed averages from each other task and is reconstructing the global mean.&lt;/p&gt;
&lt;p&gt;Since this calculation is the same on every task, the means are still globally consistent across the tasks just with the cost of one global synchronization. Fine!&lt;br&gt;
Actually this is the whole intuition behind it. As the algorithm moves forward, this whole computation is running all over again until the centers converged = don’t change anymore.&lt;br&gt;
This is much faster than MapReduce, because you don’t have to submit a new job for a new computation step.&lt;br&gt;
In BSP the superstep is less costly than running a MapReduce job, therefore it is faster for this kind of tasks.&lt;/p&gt;
&lt;p&gt;When you plot the result, you come up with something that looks like this:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://1.bp.blogspot.com/-kiZ1mNwiLvo/TtudNH4pGrI/AAAAAAAAAWo/ldCDDjFHTmY/s1600/kmeans_2.PNG&quot;&gt;&lt;img src=&quot;http://1.bp.blogspot.com/-kiZ1mNwiLvo/TtudNH4pGrI/AAAAAAAAAWo/ldCDDjFHTmY/s320/kmeans_2.PNG&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;K-Means BSP Clustering with K=3&lt;/p&gt;
&lt;p&gt;In one of the upcoming posts, I’m going to explain you the code in detail.&lt;/p&gt;
&lt;p&gt;If you are interested in the code and can’t wait, you can have a look at it in my Github here:&lt;br&gt;
&lt;a href=&quot;https://github.com/apache/hama/tree/trunk/ml/src/main/java/org/apache/hama/ml/kmeans&quot;&gt;K-Means BSP Code&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The code will randomly create some vectos and assigns k initial centers to the first k-created records. You can run it via a main-method in your IDE or to your local-mode Hama cluster.&lt;/p&gt;
&lt;p&gt;See you!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Apache Hama realtime processing]]></title><description><![CDATA[Hi there, today is about realtime processing with Apache Hama. One day, Edward told me about a guy, who told him, that he uses Hama for…]]></description><link>https://blog.thomasjungblut.com/blogger/apache-hama-realtime-processing/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/apache-hama-realtime-processing/</guid><pubDate>Mon, 24 Oct 2011 17:56:00 GMT</pubDate><content:encoded>&lt;p&gt;Hi there,&lt;/p&gt;
&lt;p&gt;today is about realtime processing with Apache Hama.&lt;br&gt;
One day, &lt;a href=&quot;https://twitter.com/#!/eddieyoon&quot;&gt;Edward&lt;/a&gt; told me about a guy, who told him, that he uses Hama for realtime processing.&lt;/p&gt;
&lt;p&gt;At first this is quite a strange/new thing, because inherently BSP is used (just like MapReduce) for batch processing. It has several advantages over MapReduce, especially in graph and mathematical use cases.&lt;/p&gt;
&lt;p&gt;I think this new “feature” is the greatest advantage over MapReduce.&lt;br&gt;
Let me clarify a bit how it works.&lt;/p&gt;
&lt;p&gt;At first you will have some tasks which are going to be our so called &lt;strong&gt;event collectors&lt;/strong&gt;. In my example this will be a single master task.&lt;br&gt;
Anyways, the trick is now that the event collectors are waiting for new events to come, or even poll for new events that happened, they do it in a while loop. Something which is possible in MapReduce though.&lt;/p&gt;
&lt;p&gt;Now you can built a &lt;a href=&quot;http://zone.ni.com/devzone/cda/tut/p/id/3023&quot;&gt;producer/consumer pattern&lt;/a&gt; on top of this. Which just says, your &lt;strong&gt;event collectors&lt;/strong&gt; are messaging &lt;strong&gt;computation tasks&lt;/strong&gt; to do some computation on the data we have just sent. This will allow you to do more complex stream analysis in near-realtime.&lt;br&gt;
We will see this in an example a bit later.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Why is this better than a MapReduce job?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;If you run a MapReduce job, you can straight poll for data available inside a while loop, too. But without a messaging system between the tasks you are forced to write your data into HDFS to make it available for a broader amount of tasks to parallelize your workload.&lt;br&gt;
Since Hadoop has lots of job scheduling and setup overhead, this is not realtime anymore. That is now degenerating to batch processing.&lt;br&gt;
For those of you who are familiar with &lt;a href=&quot;http://incubator.apache.org/giraph/&quot;&gt;Giraph&lt;/a&gt;, it is similar to that MapReduce Job, where tasks messaging with other MapReduce tasks. Sadly they just focused on graph computing and are strongly dependend on input from filesytem.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example: Realtime Twitter Message Processing&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Yes, we can analyse Twitter data streams in BSP in realtime!&lt;br&gt;
What do we need?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Twitter Library, in this case Twitter4J&lt;/li&gt;
&lt;li&gt;Latest Hama, in this case this is a 0.4.0 snapshot. You can use 3.0 as well, with minor code changes.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let’s dive directly into it and look how to setup the job.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;HamaConfiguration&lt;/span&gt; conf &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HamaConfiguration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// set the user we want to analyse  &lt;/span&gt;
    conf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;twitter.user.name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;tjungblut&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// I&apos;m always testing in localmode so I use 2 tasks.  &lt;/span&gt;
    conf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;bsp.local.tasks.maximum&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;BSPJob&lt;/span&gt; bsp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BSPJob&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;conf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    bsp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setJobName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Twitter stream processing&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    bsp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setBspClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;DataStreamProcessing&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    bsp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;waitForCompletion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I think this is pretty standard, the trick is here to set the desired username of the guy who you want to analyse.&lt;br&gt;
In my case this is my twitter nick “tjungblut”.&lt;/p&gt;
&lt;p&gt;I omit the setup method and the fields now, if you have questions on what I’ve done there, feel free to comment on this post.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The real (time) processing&lt;/strong&gt;&lt;br&gt;
Let’s step directly to the processing and the mimic of the producer/consumer pattern.&lt;br&gt;
The idea is simple: A master task is polling for new “Tweets” and is sending this directly to our computation tasks (fieldname is otherPeers, which contains all tasks but the master task).&lt;br&gt;
This happens while our computation tasks are waiting for new “food” to arrive.&lt;br&gt;
Once our computation tasks get a message, they can directly start with their computation.&lt;/p&gt;
&lt;p&gt;Let’s see how the master tasks is doing the job:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bsp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BSPPeer&lt;/span&gt; bspPeer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KeeperException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isMaster&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
          &lt;span class=&quot;token comment&quot;&gt;// this should get us the least 20 tweets of this user  &lt;/span&gt;
          &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Status&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; statuses &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; twitter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getUserTimeline&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
          &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Status&lt;/span&gt; s &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; statuses&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            &lt;span class=&quot;token comment&quot;&gt;// deduplicate  &lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;alreadyProcessedStatusses&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
              &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Got new status from: &quot;&lt;/span&gt;  
                  &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot; with message &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
              &lt;span class=&quot;token comment&quot;&gt;// we distribute messages to the other peers for  &lt;/span&gt;
              &lt;span class=&quot;token comment&quot;&gt;// processing via user id partitioning  &lt;/span&gt;
              &lt;span class=&quot;token comment&quot;&gt;// so a task gets all messages for a user  &lt;/span&gt;
              bspPeer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;  
                  otherPeers\&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; otherPeers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
                  &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LongMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
          &lt;span class=&quot;token comment&quot;&gt;// sync before we get new statusses again.  &lt;/span&gt;
          bspPeer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// computation task stuff  &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note: I’ve ommitted a lot of details (try/catchs) and pre-mature optimizations which can be found in the code.&lt;/p&gt;
&lt;p&gt;As you can see the event collector (aka master task) is polling the twitter API to get the newest tweets of a given user.&lt;br&gt;
Now the master is sending the new messages to our computation task.&lt;br&gt;
Note that there is a simple trick to distribute the work equally to the tasks. In our case we have just a single user we are listening on, and two tasks. So this won’t do anything but sending this directly to another task.&lt;br&gt;
You can change this behaviour by either listening to the public timeline or changing the distribution of the message by using the message id instead of the user id. I hope you get the gist ;)&lt;/p&gt;
&lt;p&gt;In short: We are listening to a specific user and therefore every message goes from the collector directly to the computation task. In our case we have only 2 tasks, so increasing the tasks will just cause one task to be idle the whole time.&lt;/p&gt;
&lt;p&gt;Let’s have a look at the slave task (aka computation task).&lt;/p&gt;
&lt;p&gt;This is very simple:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// we are not the master task... so lets do this:  &lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token comment&quot;&gt;// wait for some work...  &lt;/span&gt;
        bspPeer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;LongMessage&lt;/span&gt; message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LongMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; bspPeer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCurrentMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
          &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Got work in form of text: &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
              &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot; for the userid: &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getTag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;longValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see, this is a pretty simple consumer.&lt;br&gt;
You could now add some logic to it. For example to track the communication between a person and others: How often, how much and what content.&lt;/p&gt;
&lt;p&gt;In my case, this looks like this:&lt;br&gt;
&lt;a href=&quot;http://2.bp.blogspot.com/-6MS0x-aEbys/TqWlhBnqlhI/AAAAAAAAAV4/I8F_P9Ou0Z0/s1600/hama-realtime.PNG&quot;&gt;&lt;img src=&quot;http://2.bp.blogspot.com/-6MS0x-aEbys/TqWlhBnqlhI/AAAAAAAAAV4/I8F_P9Ou0Z0/s320/hama-realtime.PNG&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Note that it directly came up after it has been send.&lt;br&gt;
Now, this is a real cool thing!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Imagine:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;If you would have unlimited access to the public timeline (sadly this is capped by 150 requests/h) and you have enough computational power in your cluster, you can do your own trending topics!&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://2.bp.blogspot.com/-LkdKw6IG5Tw/TqWmN0PwYaI/AAAAAAAAAWA/ua7DRkD3CHw/s1600/twittertrends.PNG&quot;&gt;&lt;img src=&quot;http://2.bp.blogspot.com/-LkdKw6IG5Tw/TqWmN0PwYaI/AAAAAAAAAWA/ua7DRkD3CHw/s1600/twittertrends.PNG&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Of course you can do everything else you want to.&lt;/p&gt;
&lt;p&gt;I hope this has been quite “illuminating” for you and shows you how to enable realtime processing if you have Hama.&lt;/p&gt;
&lt;p&gt;Of course you can checkout my sourcecode my github. The class we just talked about is available here:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/thomasjungblut/thomasjungblut-common/blob/master/src/de/jungblut/bsp/DataStreamProcessing.java&quot;&gt;https://github.com/thomasjungblut/thomasjungblut-common/blob/master/src/de/jungblut/bsp/DataStreamProcessing.java&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Have fun and good luck!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Apache Hama upcoming features]]></title><description><![CDATA[Hi all, for me it is a pleasure to bring you a couple new things and announcements in this blog post. Apache Hama 4.0 is on its way, and I…]]></description><link>https://blog.thomasjungblut.com/blogger/apache-hama-upcoming-features/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/apache-hama-upcoming-features/</guid><pubDate>Mon, 24 Oct 2011 16:59:00 GMT</pubDate><content:encoded>&lt;p&gt;Hi all,&lt;/p&gt;
&lt;p&gt;for me it is a pleasure to bring you a couple new things and announcements in this blog post.&lt;/p&gt;
&lt;p&gt;Apache Hama 4.0 is on its way, and I want to introduce several pieces of fancyness before we dive into the realtime processing (will be the follow up blog post).&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Revised BSP execution flow&lt;/li&gt;
&lt;li&gt;Multiple Tasks per groom&lt;/li&gt;
&lt;li&gt;YARN integration &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Revised BSP execution flow&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The first point is a very good improvement. Writing BSP is totally convenient now.&lt;/p&gt;
&lt;p&gt;Let’s take a look at the implementation of a BSP in Hama 3.0:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;OldBSP&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BSP&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bsp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BSPPeerProtocol&lt;/span&gt; arg0&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KeeperException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// TODO Auto-generated method stub  &lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setConf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Configuration&lt;/span&gt; conf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// TODO Auto-generated method stub  &lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Configuration&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getConf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// TODO Auto-generated method stub  &lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You see it in my eclipse generated subclass. You &lt;strong&gt;have to&lt;/strong&gt; override a plenty of methods.&lt;br&gt;
Two of them (if you are not familiar with Hadoop) seem to be very strange. What is that configuration? And why do I need to set this in my code?&lt;/p&gt;
&lt;p&gt;Well, this is now history. We have revised the design and now shipping with default implementations of every method in the BSP class.&lt;/p&gt;
&lt;p&gt;Additionally we have added a setup and a cleanup method. Setup is now called before the computation starts, cleanup after your computation has been done.&lt;/p&gt;
&lt;p&gt;Let’s see:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NewBSP&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BSP&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BSPPeer&lt;/span&gt; peer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KeeperException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;peer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bsp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BSPPeer&lt;/span&gt; peer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KeeperException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bsp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;peer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cleanup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BSPPeer&lt;/span&gt; peer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cleanup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;peer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It is a lot more intuitive isn’t it? Now YOU can control the methods you need to override. And it is fully transparent when the methods are called.&lt;/p&gt;
&lt;p&gt;And the best side-effect is that you can send messages and trigger a barrier sync while in setup!&lt;br&gt;
This enables you now to send initial messages to other tasks and distributed information which hasn’t been set in the configuration.&lt;br&gt;
BTW: Your jobs configuration can now be obtained via peer.getConfiguration().&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Multiple Tasks per groom&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Yeah, we made the step to multitasking. In Hama 3.0 we only had a single task inside the groom.&lt;br&gt;
This didn’t really utilize the machines, because while executing a single BSP, other cores might be unused.&lt;br&gt;
Like in Hadoop this is now configurable per host. So you can set the number of tasks which should be executed on a machine.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;YARN integration&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;If you don’t know what YARN actually is, let me clarify a bit. YARN stands for &lt;strong&gt;Y&lt;/strong&gt;et &lt;strong&gt;A&lt;/strong&gt;nother &lt;strong&gt;R&lt;/strong&gt;esource &lt;strong&gt;N&lt;/strong&gt;egotiator.&lt;br&gt;
This is Hadoops new architecture. If you want to learn more, have a look at &lt;a href=&quot;http://twitter.com/#!/acmurthy&quot;&gt;Aruns&lt;/a&gt; slides &lt;a href=&quot;http://www.slideshare.net/hortonworks/nextgen-apache-hadoop-mapreduce&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If you now know what the new Hadoop is, I’m proud to tell you that Apache Hama will be a part of it.&lt;br&gt;
We implemented our own application to fit with the new YARN module and bring Hama to your Hadoop 23.0 cluster.&lt;br&gt;
No more setup and configuration of additional daemons!&lt;/p&gt;
&lt;p&gt;We managed to get a first BSP (Serialize Printing) running on a YARN cluster.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://1.bp.blogspot.com/-NUl3Y1C_CBk/TqWYTGdMXNI/AAAAAAAAAVs/v63UzshyjjQ/s1600/yarn.png&quot;&gt;&lt;img src=&quot;http://1.bp.blogspot.com/-NUl3Y1C_CBk/TqWYTGdMXNI/AAAAAAAAAVs/v63UzshyjjQ/s400/yarn.png&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Serialize Printing on YARN&lt;/p&gt;
&lt;p&gt;That is soo great!&lt;/p&gt;
&lt;p&gt;We are still in development, so please follow &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-431&quot;&gt;HAMA-431&lt;/a&gt; if you are interested.&lt;/p&gt;
&lt;p&gt;Thanks for your attention, and please follow us on the &lt;a href=&quot;http://incubator.apache.org/hama/mail-lists.html&quot;&gt;mailing list&lt;/a&gt;! We are happy to answer your questions if you have one.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Ant Colony Optimization for TSP Problems]]></title><description><![CDATA[Code can be found on (Github) Hi there, I recently focused on playing around with ant colony AI (artificial intelligence) methods, as part…]]></description><link>https://blog.thomasjungblut.com/blogger/ant-colony-optimization-for-tsp/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/ant-colony-optimization-for-tsp/</guid><pubDate>Tue, 30 Aug 2011 17:40:00 GMT</pubDate><content:encoded>&lt;p&gt;Code can be found on (&lt;a href=&quot;https://github.com/thomasjungblut/antcolonyopt&quot;&gt;Github&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;Hi there,&lt;/p&gt;
&lt;p&gt;I recently focused on playing around with ant colony AI (artificial intelligence) methods, as part of my second semester undergraduation project in Software Engineering.&lt;/p&gt;
&lt;p&gt;Wikipedia’s definition for Ant Colony Optimization is the following:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In computer science and operations research, the &lt;strong&gt;ant colony optimization&lt;/strong&gt; algorithm &lt;strong&gt;(ACO)&lt;/strong&gt; is a probabilistic technique for solving computational problems which can be reduced to finding good paths through graphs.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Unlike previous posts, it is a multithreaded solution which runs best on a single machine and not in a cluster and this post is about TSP (&lt;a href=&quot;http://en.wikipedia.org/wiki/Travelling_salesman_problem&quot;&gt;Traveling Salesman Problem&lt;/a&gt;) and not about finding shortest paths in a graph.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The Input&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;At first, we have to decide which input we take. In my case, this task was a university assignment so I have to use the given one. It is the Berlin52 problem which should be solved with the less costly route along the 52 best known / famous places in Berlin.&lt;br&gt;
You can download an euclidian 2D coordinate version of it &lt;a href=&quot;http://www2.iwr.uni-heidelberg.de/groups/comopt/software/TSPLIB95/tsp/&quot;&gt;here&lt;/a&gt;. Just look for the “berlin52.tsp.gz” file. There is also an already calculated optimal solution &lt;a href=&quot;http://www2.iwr.uni-heidelberg.de/groups/comopt/software/TSPLIB95/tsp/berlin52.opt.tour.gz&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Plotting the file is going to show a cool roundtrip:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://1.bp.blogspot.com/-G_IM3Kbxwmk/Tl9GqfNfJZI/AAAAAAAAATc/erg6Iwpzu1w/s1600/tsp.png&quot;&gt;&lt;img src=&quot;http://1.bp.blogspot.com/-G_IM3Kbxwmk/Tl9GqfNfJZI/AAAAAAAAATc/erg6Iwpzu1w/s400/tsp.png&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The file content looks quite like this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;1 565.0 575.0&lt;br&gt;
2 25.0 185.0&lt;br&gt;
3 345.0 750.0&lt;br&gt;
4 945.0 685.0&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;On the leftmost side is the ID of the vertex, in the middle is the x-coordinate and on the rightmost side is the y-coordinate in the euclidian plane.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The Algorithm&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;This algorithm is a mimicry of the real-life behaviour of ants. As you might know, Ants are quite smart in finding their way between their colony and their food source. A lot of workers are walking through the proximate environment and if they find some food, they leave a pheromone trail.&lt;br&gt;
Some of the other ants are still searching for other paths, but the most of them are following the pheromone trail- making this path even more attractive. But over time the pherome trail is starting to decay / evaporate, so it is losing its attractiveness. Due to the time component, a long way has a very low density of the pheromone, because the pherome trail along the longer path is evaporating faster. Thus a very short path has a higher density of pheromones and is more attractive to the workers converging onto an approximately optimal path for our TSP problem.&lt;/p&gt;
&lt;p&gt;For the problem, we are dropping ants on random vertices in our graph. Each ant is going to evaluate the next best destination vertex based on this following formula:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://upload.wikimedia.org/math/e/1/3/e1320f5f72b21e5766dfa7e29b536883.png&quot;&gt;&lt;img src=&quot;http://upload.wikimedia.org/math/e/1/3/e1320f5f72b21e5766dfa7e29b536883.png&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;It is about the probabiliy “p” for an ant called “k” to move to the vertex described by “x” and “y”.&lt;br&gt;
The variable “Tau” is the amount of pheromone deposited on the edge between “xy”. It gets raised by “alpha” which is a heuristic parameter describing how greedy the algorithm is in finding its path across the graph. This is going to be multiplied by our apriori knowledge of how “good” the edge is. In our case this is the inverted distance (1 / distance) between x and y. This gets raised by “beta” which is also a heuristic parameter, which describes how fast the ants are going to converge to a steady solution. To get a transition probability to a vertex, each gets divided by the sum of the numerator over all possible left destination vertices.&lt;/p&gt;
&lt;p&gt;The next equation is about adjusting the pheromone matrix, which is described by the following formula:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://upload.wikimedia.org/math/1/7/b/17b189b13928502c7a2e5fd7fbdc6184.png&quot;&gt;&lt;img src=&quot;http://upload.wikimedia.org/math/1/7/b/17b189b13928502c7a2e5fd7fbdc6184.png&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;“Tau” is the amount of absolute pheromone which gets deposited for worker “k” on the “xy” edge. “Rho” is a factor between 0-1 which represents the decay of the pheromone. This gets multiplied by the current amount of pheromone deposited and we just add updated new pheromone to it (which is the delta “Tau”). Delta “Tau” is an equatation too:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://upload.wikimedia.org/math/6/d/b/6db065218c956a4a7af6da99aaeca5d1.png&quot;&gt;&lt;img src=&quot;http://upload.wikimedia.org/math/6/d/b/6db065218c956a4a7af6da99aaeca5d1.png&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Wikipedia.org&lt;/p&gt;
&lt;p&gt;It is just “Q” by the accumulated distance of the path so far.&lt;/p&gt;
&lt;p&gt;Finish! That is all we need to start the implementation!&lt;/p&gt;
&lt;p&gt;The whole thing works like this:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Initialize the best distance to infinity&lt;/li&gt;
&lt;li&gt;Choose a random vertex in the graph where to plant your ant&lt;/li&gt;
&lt;li&gt;Let the ant work their best paths using the formulas from above&lt;/li&gt;
&lt;li&gt;Let the ant update the pheromones on our graph&lt;/li&gt;
&lt;li&gt;If the worker returned with a new best distance update our currently best distance&lt;/li&gt;
&lt;li&gt;Start from 2. until we found our best path or we have reached our maximum amount of workers.&lt;/li&gt;
&lt;li&gt;Output the best distance&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The single worker will now return with a path which he has taken and with a corresponding distance. Now you can decide if you are confident with the result, or going to let the worker calculate more of them.&lt;/p&gt;
&lt;p&gt;So let’s see how we can multithread this.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;How to Multithread&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In this case, multithreading is very easy. Each worker unit (in my repository called “Agent”) is a single thread. In Java we have a cool thread pool construct called &lt;em&gt;ExecutorService&lt;/em&gt; and a completion service which tells us when workers finished.&lt;/p&gt;
&lt;p&gt;We are submitting a few workers for to the pool, they work on the same resources and once completed we get a reponse of the completion service.&lt;/p&gt;
&lt;p&gt;Woot? Shared resources? Yes we need some sort of synchronization. In our case when writing to the pheromone matrix. In my latest implementation I used lock-free updates using Guava’s AtomicDouble.&lt;/p&gt;
&lt;p&gt;The whole algorithm is not going to change, we are just working in parallel.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The Result&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;After a lot of parameter testing you can find a very good solution:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://4.bp.blogspot.com/-EOFi4Zc7xUk/Tl0drCu-6iI/AAAAAAAAATY/sMfSaPsWb8o/s1600/ant.png&quot;&gt;&lt;img src=&quot;http://4.bp.blogspot.com/-EOFi4Zc7xUk/Tl0drCu-6iI/AAAAAAAAATY/sMfSaPsWb8o/s1600/ant.png&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Console output of my algorithm, finding a very close solution to the optimal distance for Berlin52&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Parameter Testing&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Because there are a hell lot of parameters (5) in there, we have to write an testing utility which calculates the best parameters for our problem (aka GridSearch).&lt;/p&gt;
&lt;p&gt;We only care about the distance to the optimal solution:&lt;br&gt;
In the grid search we only want to keep the lowest possible mean distance to the optimal solution (measured over multiple repetitions) and a very low variance.&lt;/p&gt;
&lt;p&gt;For Berlin52, the best parameters using 200k agents I found are:&lt;/p&gt;
&lt;p&gt;Alpha = 0.1&lt;br&gt;
Beta = 9&lt;br&gt;
Q = 1e-4&lt;br&gt;
P = 0.8&lt;/p&gt;
&lt;p&gt;So feel free to check out the code in the repository and let it run.&lt;br&gt;
And please feel free to use this as a hint for your own implementation, or even improve it via a pull request.&lt;/p&gt;
&lt;p&gt;Thanks for your interest and have fun :-)&lt;br&gt;
Bye!&lt;/p&gt;
&lt;p&gt;Here’s the link to the repository again: &lt;a href=&quot;https://github.com/thomasjungblut/antcolonyopt&quot;&gt;https://github.com/thomasjungblut/antcolonyopt&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Apache Hama Partitioning Improved]]></title><description><![CDATA[Hey guys, my work phase is over and I’m back to university next week so I’m having a bit more time to write here. The first free time…]]></description><link>https://blog.thomasjungblut.com/blogger/apache-hama-partitioning-improved/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/apache-hama-partitioning-improved/</guid><pubDate>Sat, 20 Aug 2011 10:36:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey guys,&lt;/p&gt;
&lt;p&gt;my work phase is over and I’m back to university next week so I’m having a bit more time to write here.&lt;/p&gt;
&lt;p&gt;The first free time yesterday focussed on generating random data for Apache Hama / Apache Whirr and for my pagerank algorithm. &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-420&quot;&gt;HAMA-420&lt;/a&gt; is the related issue on Jira.&lt;/p&gt;
&lt;p&gt;After a lot of stress with the broken DMOZ file, I came along that partitioning takes far to long for some (1-3) million vertices. I already knew this issue, because it always took nearly 10 minutes to partition the sequencefile (1,26GB) of my SSSP(Single Source Shortest Paths) algorithm.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Where were the problems?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Actually, there were two major problems I saw.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt; Structure of the in- and output File&lt;/li&gt;
&lt;li&gt; Zlib Compression&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So first off the structure, for SSSP it looked like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;K           /                V   
Vertex[Text] / AdjacentVertex : Weight [Text]  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Every line contained one(!) vertex and it’s adjacent. Someone of you might notice that this is quite verbose.
We used this structure for both, the input and the partitioned files.&lt;/p&gt;
&lt;p&gt;The second thing is the standard compression that comes with SequenceFiles, it is the zLib codec which you have to explicitly turn off. Otherwise compression takes nearly 80% of the writing time without any real effort in file sizes.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;How to deal with it?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;These two problems were quite easy to solve. The first thing is to change structure and put adjacent vertices along with their origin vertex into one line of input textfile.&lt;/p&gt;
&lt;p&gt;To be quite general for inputs I sticked with textfiles (this is very common and readable in every editor) and directly write into a sequencefile which is key/value composal of a vertex and an array of vertices.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Processing&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The new architecture works on the input textfile and reads each line and passes it into an abstract method.&lt;br&gt;
So everyone can implement their own input-textfile-parser and put it into the vertex the BSP needs. Which then gets directly partitioned via hash and gets written into the sequencefile of the groom.&lt;/p&gt;
&lt;p&gt;Later on we have to extend this with various stuff of compression, inputformat, recordreader and other partitioning ways.&lt;/p&gt;
&lt;p&gt;The groom will then just read the sequencefile objects and will put them into ram. So no more text deserialization has to be done: CHEERS!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Comparision new vs old&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The result is overwhelming! See it in my Calc Sheet:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://3.bp.blogspot.com/-Js2lDIfGysk/TotPhmgqJuI/AAAAAAAAAVk/RHx7ZlftE6Q/s1600/improvement.PNG&quot;&gt;&lt;img src=&quot;http://3.bp.blogspot.com/-Js2lDIfGysk/TotPhmgqJuI/AAAAAAAAAVk/RHx7ZlftE6Q/s1600/improvement.PNG&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;This is just a great improvement. It get’s comitted as &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-423&quot;&gt;HAMA-423&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Thanks and Bye!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Dealing with "OutOfMemoryError" in Hadoop]]></title><description><![CDATA[Hey all, some of you may have seen some kind of OutOfMemoryError in your Hadoop jobs, which looks like this: java.lang.OutOfMemoryError…]]></description><link>https://blog.thomasjungblut.com/blogger/dealing-with-outofmemoryerror-in-hadoop/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/dealing-with-outofmemoryerror-in-hadoop/</guid><pubDate>Sat, 09 Jul 2011 10:51:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey all,&lt;/p&gt;
&lt;p&gt;some of you may have seen some kind of OutOfMemoryError in your Hadoop jobs, which looks like this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;java.lang.OutOfMemoryError: unable to create new native thread&lt;/strong&gt;&lt;br&gt;
at java.lang.Thread.start0(Native Method)&lt;br&gt;
at java.lang.Thread.start(Thread.java:597)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This is mainly what is the theme of today’s blog post. I’ll be writing about what causes this to happen and how to solve it.&lt;/p&gt;
&lt;p&gt;As it is currently Juli 2011, I refer to Hadoop 0.20.2 since this is the latest stable release.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The Cause&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I’ve seen many OutOfMemoryErrors in my short life. But this error isn’t a “my jvm run out of heap” error. We’ll usually see this in deeper in the stacktrace, in my case this was caused by &lt;em&gt;FileSystem.create()&lt;/em&gt;. So this error is causing a OOM(will refer to it for OutOfMemory), but not in your JVM. The process that gets started by Hadoop which will execute your task, can’t allocate more memory on your host-system.&lt;/p&gt;
&lt;p&gt;What does &lt;em&gt;FileSystem.create()&lt;/em&gt; do to let your host system get out of memory?&lt;br&gt;
Well, I laughed at it first, too. It was setting the permissions with CHMOD.&lt;/p&gt;
&lt;p&gt;The first time I’ve seen this error in the logs, I googled it. I came across a blogpost which rants about several concerns with Hadoop I come across every day (e.G. Zombie Tasks, XCievers), but it tells the truth.&lt;/p&gt;
&lt;p&gt;Let’s see what they wrote on this kinds of error:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Terrible with memory usage&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We used to have problems with Hadoop running out of memory in various contexts. Sometimes our tasks would randomly die with out of memory exceptions, and sometimes reducers would error during the shuffle phase with “Cannot allocate memory” errors. These errors didn’t make a lot of sense to us, since the memory we allocated for the TaskTrackers, DataNodes, and tasks was well under the total memory for each machine.&lt;/p&gt;
&lt;p&gt;We traced the problem to a sloppy implementation detail of Hadoop. It turns out that Hadoop sometimes shells out to do various things with the local filesystem.&lt;br&gt;
[…]&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Source: &lt;a href=&quot;http://tech.backtype.com/the-dark-side-of-hadoop&quot;&gt;http://tech.backtype.com/the-dark-side-of-hadoop&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;What I’ve seen is that the &lt;em&gt;RawLocalFileSystem&lt;/em&gt; is going to create a file on the disk and is setting the permission on it with a given FSPermission object which will represent an equal call to CHMOD “XXX” on your system’s shell.&lt;br&gt;
In fact, Hadoop is going to launch a process using the ProcessBuilder, to just CHMOD the file it just created.&lt;/p&gt;
&lt;p&gt;I guess you are now asking yourself, why this is going to cause an OOM error. If you not already followed the link I’ve provided above, I recommend to do so.&lt;br&gt;
But I’m going to clarify this a bit more.&lt;/p&gt;
&lt;p&gt;The ProcessBuilder in Java under linux will fork a child process. This process is allocating the same amount of memory as its parent process did. So for example you’ve provided your Hadoop Job to allocate 1G of Heap per Task, you’ll end up temporary using 2G of your hostsystem when calling &lt;em&gt;FileSystem.create()&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Let me explain a bit more about the fork() in linux.&lt;br&gt;
When calling fork(), linux is going to setup a new task-structure which is going to be a full copy of the parent process. The process is going to get a new process-id and is using the same memory as its parent process. Everything seems fine, but if one of them is going to modify or write something in the memory, the memory will be duplicated. This is called &lt;strong&gt;copy on write&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;If you’re able to read german, I recommend you the book “C und Linux” of “Martin Gräfe”. It is very well explained there (although it is in a C context).&lt;/p&gt;
&lt;p&gt;I had a job which downloads lots (millions) of files and creates a new file for it inside a mapper. This is going to be parallized so we have multiple task per host machine. The funny thing is, that each task is going to shell-out and CHMOD’ing the file it just created, if other jobs are going to run then, they are simply failing, because they cannot allocate enough memory for their JVM. So did the tasks itself.&lt;/p&gt;
&lt;p&gt;The worst thing is to confuse this with JVM OOM’s, they are dependend on what you’re task is doing. So if you’re having a 2GB HashMap to compute things faster in RAM, but your JVM has only 1GB Heap, this is clearly a JVM OOM since no more Heap can be allocated INSIDE.&lt;br&gt;
A usual fix for this is to increase the heapsize of the JVM with -Xmx2G or -Xmx2048M. &lt;strong&gt;Don’t do this in this case of Host-OOMs!&lt;/strong&gt; This will even worse the problem. Especially in this specific problem, a child process will then allocate even more RAM, which probably yields in faster failure.&lt;/p&gt;
&lt;p&gt;Now let’s see how to solve this.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Solve the problem&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;“tech.backtype.com” is saying, that adding a lot of swap space is going to solve the problem. I am not a fan of lot’s of swap space on Hadoop nodes, mainly because there is a high chance that tasks are getting swapped (due to misconfiguration, other processes etc). And JVM’s are not constructed to work correctly when swapped. So you can think of really degrading performance once a task gets swapped. I was suprised that they told that everything got far more stable afterwards. Hell they must have the worst problems on their cluster.&lt;/p&gt;
&lt;p&gt;I’ve backtracked the problem to FileSyste.create(). Actually it was &lt;em&gt;create(FileSystem fs, Path file, FsPermission permission)&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Actually, this will cause CHMOD to be forked twice. So the first fix was to use the non-static methods.&lt;br&gt;
Using the non-setting FSPermission methods like &lt;em&gt;create(Path path)&lt;/em&gt; will cause a process to be forked anyways.&lt;br&gt;
So you have to call the abstract method in FileSystem directly. It has this signature:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Path&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
  &lt;span class=&quot;token class-name&quot;&gt;FsPermission&lt;/span&gt; permission&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; overwrite&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; bufferSize&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;short&lt;/span&gt; replication&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; blockSize&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
  &lt;span class=&quot;token class-name&quot;&gt;Progressable&lt;/span&gt; progress&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The way I prevent Hadoop from forking the process is going to set the permission to &lt;em&gt;null&lt;/em&gt;.&lt;br&gt;
This will cause a NullPointerException in the NameNode while setting the permission in the distributed FileSystem (the permissions you can see in the webfrontend). This is because the DFSClient is going to RPC the NameNode to register the new created file in the NameNode.&lt;br&gt;
So you have to patch your NameNode by adding a null-check in the setPermission method.&lt;br&gt;
Like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setPermission&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; src&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FsPermission&lt;/span&gt; permissions&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;permissions &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
       permissions &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FsPermission&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDefault&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    namesystem&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setPermission&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;src&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; permissions&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt; that this is going to not work if you’re running Hadoop with lots of different users. I have just one user, which is also the user on the host-system. So this won’t cause any problems in my case.&lt;/p&gt;
&lt;p&gt;And be aware that adding this nifty “hack” to your code will cause your job to not run on the LocalFileSystem, since this isn’t null-safe, too.&lt;/p&gt;
&lt;p&gt;Now each task is not going to fork any process at all.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Set-intersection and -difference with Hadoop]]></title><description><![CDATA[Hi there, first off a short message: I am currently a bit busy so I need a bit of time for the BSP K-Means-Clustering I promised in one of…]]></description><link>https://blog.thomasjungblut.com/blogger/set-intersection-and-difference-with/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/set-intersection-and-difference-with/</guid><pubDate>Sat, 25 Jun 2011 17:01:00 GMT</pubDate><content:encoded>&lt;p&gt;Hi there,&lt;/p&gt;
&lt;p&gt;first off a short message:&lt;br&gt;
I am currently a bit busy so I need a bit of time for the BSP K-Means-Clustering I promised in one of the previous posts. I am going to contribute this as an example for Apache Hama and not for my GSoC trunk (where to you can find a link now on the right below the twitter box!). Although I am going to setup a github to store my new code things. I’ll link this on the sidebar, too.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The real beginning&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;So I came across &lt;a href=&quot;http://stackoverflow.com/questions/6469171/computing-set-intersection-and-set-difference-of-the-records-of-two-files-with-ha&quot;&gt;a question on stackoverflow&lt;/a&gt; some days ago. It was about computing the set-intersection and -difference with Hadoop’s MapReduce. I simply wanted to share my solution with you, this is the main reason of this blog post.&lt;/p&gt;
&lt;p&gt;The question was about only two files, we are going to scale this up to “n”-files since this is why we need hadoop ;)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The input&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Let’s assume (like in the question) that we have a file that is looking like this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;File 1 contains following lines:&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;a&lt;br&gt;
b&lt;br&gt;
c&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;em&gt;File 2 contains following lines:&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;a&lt;br&gt;
d&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;p&gt;Actually it is pretty simple, we have to make sure that these lines are stored in different text files.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The Mapper&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The main focus and trick in the mapper is how to get the name of the file the task is currently working on.&lt;br&gt;
Let’s have a look at my mapper implementation, called FileMapper:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FileMapper&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Mapper&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LongWritable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt; fileName&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LongWritable&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Context&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
          &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
       context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fileName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Context&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
          &lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
       &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;FileSplit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getInputSplit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
       fileName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
       context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fileName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The trick is that when we are importing textfiles, the input split is of the type filesplit which let’s you get the path and the name of the file.&lt;/p&gt;
&lt;p&gt;The main problem is here to know how many files you’ve got at all. There can be a nifty hack to just emit the first line of the mapper output with a key that is guranteed to be the first input in our reducer like a plain “a”. This is the last line in the setup method.&lt;/p&gt;
&lt;p&gt;Now we are going to emit each text line as the key and the filename as the value.&lt;br&gt;
Then we get a bunch of key / values that look like this, key and value are seperated by space and assuming the files names are File1 and File2:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;    a File1 // nifty haxx  
    b File1  
    c File1  
    d File1  
  
    a File2 // nifty haxx  
    d File2  
    e File2  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Obviously reducing them will get you an input like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;    a File1,File2 // our nifty hack :))  
    b File1  
    c File1  
    d File1,File2  
    e File2  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Once again pretty straightforward. Now we can see a clear structure and know what we have to do in our reducer.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The Reducer&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Now let’s have a look at our reducer:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FileReducer&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Reducer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashSet&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; fileNameSet &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashSet&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      
    &lt;span class=&quot;token keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token constant&quot;&gt;LINES_IN_COMMON&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;reduce&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Iterable&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; values&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Context&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
            &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token comment&quot;&gt;// add for our first key every file to our set  &lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// make sure that this action is the first of the entire reduce step  &lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;toString&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; values&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
                fileNameSet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            &lt;span class=&quot;token comment&quot;&gt;// now add evey incoming value to a temp set  &lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;HashSet&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; set &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashSet&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; values&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
                set&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
              
            &lt;span class=&quot;token comment&quot;&gt;// perform checks  &lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;set&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; fileNameSet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
                &lt;span class=&quot;token comment&quot;&gt;// we know that this must be an intersection of all files  &lt;/span&gt;
                context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;LINES_IN_COMMON&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
                &lt;span class=&quot;token comment&quot;&gt;// do anything what you want with the difference  &lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
   
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see we are just using our “hack” to build a set of files we had in our input. And now we are just checking if we have full intersection over all files and incrementing a counter on that.&lt;/p&gt;
&lt;p&gt;What you’re doing with the set difference is left up to you, maybe you want to ignore them and do something with the intersecting lines.&lt;br&gt;
Have a try with some files on project gutenberg! I would be pretty interested how many lines are equal in different books.&lt;/p&gt;
&lt;p&gt;Here in germany were some discussions about plagiarism, maybe this can be helpful to find intersection of many books / papers very fast.&lt;/p&gt;
&lt;p&gt;I’ve just wanted to point out a possible solution of how to deal with such a problem in mapreduce.&lt;/p&gt;
&lt;p&gt;Thanks for your attention and support :)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[k-Means Clustering with MapReduce]]></title><description><![CDATA[Hi all, just finished the MapReduce side implementation of k-Means clustering. Notice that this is a series that contains this post and a…]]></description><link>https://blog.thomasjungblut.com/blogger/k-means-clustering-with-mapreduce/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/k-means-clustering-with-mapreduce/</guid><pubDate>Wed, 25 May 2011 14:45:00 GMT</pubDate><content:encoded>&lt;p&gt;Hi all,&lt;/p&gt;
&lt;p&gt;just finished the MapReduce side implementation of k-Means clustering. Notice that this is a series that contains this post and a follow-up one which implements the same algorithm using BSP and Apache Hama.&lt;/p&gt;
&lt;p&gt;Note that this is just an example to explain you k-means clustering and &lt;em&gt;how&lt;/em&gt; it can be easily solved and implemented with MapReduce.&lt;br&gt;
If you want to use a more generic version of k-means, you should head over to &lt;a href=&quot;http://mahout.apache.org/&quot;&gt;Apache Mahout&lt;/a&gt;. Mahout provides k-means clustering and other fancy things on top of Hadoop MapReduce. &lt;strong&gt;This code is also not thought for production usage, you can cluster quite small datasets from 300m to 10g very well with it, for lager sets please take the Mahout implementation.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The clustering itself&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We need some vectors (which dimension doesn’t matter, hopefully they have all the same dimension). These vectors representing our data, and then we need k-centers. These centers are vectors too, sometimes they are just a subset of the input vectors, but sometimes they are random points or points-of-interest to which we are going to cluster them.&lt;/p&gt;
&lt;p&gt;Since this is a MapReduce version I tell you what keys and values we are using. This is really simple, because we are just using a vector, a vector can be a clustercenter as well. So we treat our clustercenter-vectors always like keys, and the input vectors are simple values.&lt;/p&gt;
&lt;p&gt;The clustering itself works like this then:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;In the map step&lt;/li&gt;
&lt;li&gt;Read the cluster centers into memory from a sequencefile&lt;/li&gt;
&lt;li&gt;Iterate over each cluster center for each input key/value pair. &lt;/li&gt;
&lt;li&gt;Measure the distances and save the nearest center which has the lowest distance to the vector&lt;/li&gt;
&lt;li&gt;Write the clustercenter with its vector to the filesystem.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;In the reduce step (we get associated vectors for each center)&lt;/li&gt;
&lt;li&gt;Iterate over each value vector and calculate the average vector. (Sum each vector and devide each part by the number of vectors we received).&lt;/li&gt;
&lt;li&gt;This is the new center, save it into a SequenceFile.&lt;/li&gt;
&lt;li&gt;Check the convergence between the clustercenter that is stored in the key object and the new center.&lt;/li&gt;
&lt;li&gt;If it they are not equal, increment an update counter&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Run this whole thing until nothing was updated anymore.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pretty easy, isn’t it?:D&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Model&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Let’s have a look at the involved models:&lt;/p&gt;
&lt;p&gt;Vector class:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WritableComparable&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
 &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; vector&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
 &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
 &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; l &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;vector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;vector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;l&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;arraycopy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;vector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;vector&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; l&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
 &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;vector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
 &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
 &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;DataOutput&lt;/span&gt; out&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeInt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;vector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; vector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
   out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeDouble&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;vector&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
 &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
 &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;readFields&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;DataInput&lt;/span&gt; in&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; size &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; in&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readInt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  vector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;size&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; size&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
   vector&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; in&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readDouble&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
 &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
 &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;compareTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
  &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; equals &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; vector&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
     &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; c &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; vector&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;vector&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
     &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.0d&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
     &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
   &lt;span class=&quot;token comment&quot;&gt;// get and set omitted  &lt;/span&gt;
  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You see everything is pretty standard. The &lt;em&gt;compareTo&lt;/em&gt; method is just checking equality, just because we don’t need an inner ordering- but we want the same keys to get in the same chunk. Be aware that we are returning 1 if they are not equal. Hadoop’s quicksort is only swapping the element if it is greater than the other one. &amp;#x3C;- This is a great tip ;)&lt;/p&gt;
&lt;p&gt;If you are not sure aware about this hack, please reimplement this correctly.&lt;/p&gt;
&lt;p&gt;The cluster center is basically just an “has-a-vector” class that just delegates the read/write/compareTo method to the vector. It is just devided so we can exactly differ between a center and a vector, altough it is the same.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The distance measurement&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I’ve spoken in the algorithm-description about a distance measuring. But I left this open. Let’s declare some things:&lt;/p&gt;
&lt;p&gt;We need a measurement of a distance between two vectors, especially between a center and a vector.&lt;br&gt;
I’ve came up with the manhattan distance because it doesn’t require much computation overhead like square-rooting (Euclidian distance) and it is not too complex.&lt;br&gt;
Let’s have a look:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;measureDistance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ClusterCenter&lt;/span&gt; center&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; sum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; length &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
   sum &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;center&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCenter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;  
     &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; sum&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see, just a sum of each part of the vectors difference. So easy!!! Let’s head to the map implementation…&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The Mapper&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Let’s assume that there is a list or a list-like sequencefile-iterating interface that is called centers. It contains ClusterCenter objects that represent the current centers. The DistanceMeasurer class contains the static method we defined in the last part.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// setup and cleanup stuffz omitted  &lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
 &lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ClusterCenter&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Context&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
   &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
  &lt;span class=&quot;token class-name&quot;&gt;ClusterCenter&lt;/span&gt; nearest &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; nearestDistance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Double&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;MAX&lt;/span&gt;\_VALUE&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ClusterCenter&lt;/span&gt; c &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; centers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
   &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; dist &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DistanceMeasurer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;measureDistance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nearest &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    nearest &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    nearestDistance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; dist&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nearestDistance &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; dist&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
     nearest &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
     nearestDistance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; dist&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nearest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Like told in the introduction, it’s just a looping and a measuring. Always keeping a reference to the nearest center. Afterwards we are writing it out.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The Reducer&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Once again let’s have a list or a list-like sequencefile-iterating interface that is called centers. Here we need it for storage reasons.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// setup and cleanup stuffz omitted once again  &lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
 &lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;reduce&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ClusterCenter&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Iterable&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; values&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
   &lt;span class=&quot;token class-name&quot;&gt;Context&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
  &lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt; newCenter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; vectorList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LinkedList&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; vectorSize &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCenter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  newCenter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;vectorSize&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; values&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
   vectorList&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    newCenter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; newCenter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
   newCenter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; newCenter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getVector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;  
     &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; vectorList&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
  &lt;span class=&quot;token class-name&quot;&gt;ClusterCenter&lt;/span&gt; center &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ClusterCenter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;newCenter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  centers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;center&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt; vector &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; vectorList&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
   context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;center&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; vector&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;center&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;converged&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
   context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;CONVERGED&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So sorry, but this got a bit more bulky than I initially thought it could be. Let me explain: The first loop only dumps the values in the iterable into a list and sums up each component of the vector in a newly created center. Then we are averaging it in another loop and we are writing the new center along with each vector we held in memory the whole time. Afterwards we are just checking if the vector has changed, this method is just a delegating to the underlying vectors compareTo. If the centers are not equal it returns true. And therefore it updates an counter. Actually the name of the counter is misleading, it should be named “updated”. If you are now asking how we are controlling the recursion part, head over here and look how it should work: &lt;a href=&quot;http://codingwiththomas.blogspot.com/2011/04/controlling-hadoop-job-recursion.html&quot;&gt;Controlling Hadoop MapReduce recursion&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I don’t want anyone to leave without a working example ;) SO here is our 2-dimensional input: k-Centers:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(1,1);(5,5)  

```Input vectors:  
Vector [vector=[16.0, 3.0]]  
Vector [vector=[7.0, 6.0]]  
Vector [vector=[6.0, 5.0]]  
Vector [vector=[25.0, 1.0]]  
Vector [vector=[1.0, 2.0]]  
Vector [vector=[3.0, 3.0]]  
Vector [vector=[2.0, 2.0]]  
Vector [vector=[2.0, 3.0]]  
Vector [vector=[-1.0, -23.0]]  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now the jobs getting scheduled over and over again and the output looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;ClusterCenter [center=Vector [vector=[13.5, 3.75]]] / Vector [vector=[16.0, 3.0]]  
ClusterCenter [center=Vector [vector=[13.5, 3.75]]] / Vector [vector=[7.0, 6.0]]  
ClusterCenter [center=Vector [vector=[13.5, 3.75]]] / Vector [vector=[6.0, 5.0]]  
ClusterCenter [center=Vector [vector=[13.5, 3.75]]] / Vector [vector=[25.0, 1.0]]  
ClusterCenter [center=Vector [vector=[1.4, -2.6]]] / Vector [vector=[1.0, 2.0]]  
ClusterCenter [center=Vector [vector=[1.4, -2.6]]] / Vector [vector=[3.0, 3.0]]  
ClusterCenter [center=Vector [vector=[1.4, -2.6]]] / Vector [vector=[2.0, 2.0]]  
ClusterCenter [center=Vector [vector=[1.4, -2.6]]] / Vector [vector=[2.0, 3.0]]  
ClusterCenter [center=Vector [vector=[1.4, -2.6]]] / Vector [vector=[-1.0, -23.0]]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So we see that the two initial centers were moved to (1.4,-2.6) and to (13.5,3.75). Cool thing :D&lt;/p&gt;
&lt;p&gt;Here is the code:&lt;br&gt;
&lt;a href=&quot;https://github.com/thomasjungblut/mapreduce-kmeans&quot;&gt;https://github.com/thomasjungblut/mapreduce-kmeans&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The code is located in the &lt;em&gt;de.jungblut.clustering.mapreduce&lt;/em&gt; package, if you click run on the KMeansClusteringJob the example data is getting loaded and you can step through the code if you are interested. If you want to run it on your cluster, I assume that you’re using 2.2, if not, then you have to take care of the up/downgrade for yourself.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt; that if you are submitting this to a real cluster files like _logs or _SUCCESS may be in the directory of your job. This will break the outputter at the end of the Job.&lt;br&gt;
Either remove the files or modify the method.&lt;br&gt;
Also note that if you run this with a large file, the number of reducers should be set to 1, otherwise there will be file collisions (See the reducer’s cleanup method). This can be done better, but I’ll leave this to you ;)&lt;/p&gt;
&lt;p&gt;Thank you very much.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Series: K-Means Clustering (MapReduce | BSP)]]></title><description><![CDATA[Hi all, I was a bit busy last time so I hadn’t that much time to blog. Several days ago after PageRank I had an idea to implement k-means…]]></description><link>https://blog.thomasjungblut.com/blogger/series-k-means-clustering-mapreduce-bsp/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/series-k-means-clustering-mapreduce-bsp/</guid><pubDate>Sat, 21 May 2011 07:07:00 GMT</pubDate><content:encoded>&lt;p&gt;Hi all,&lt;/p&gt;
&lt;p&gt;I was a bit busy last time so I hadn’t that much time to blog.&lt;br&gt;
Several days ago after PageRank I had an idea to implement k-means clustering with Apache Hama and BSP.&lt;br&gt;
Now I’ve decided to first implement a MapReduce implementation of it, since this is very simple: Reading the centers in setup’s method and calculate the distance from each vector to the centers in map phase. In the reduce phase we are going to calculate new cluster centers.&lt;/p&gt;
&lt;p&gt;This is very very straightforward. So this will be a series about a MapReduce implementation and a better one with BSP.&lt;/p&gt;
&lt;p&gt;‘till then!&lt;/p&gt;
&lt;p&gt;Greetzz&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Shortest Path Finding with Apache Hama]]></title><description><![CDATA[Hi guys, I’ve finished my Google Summer of Code task. Really! Remember today is the 7th of may. And the actualy coding period goes until mid…]]></description><link>https://blog.thomasjungblut.com/blogger/shortest-path-finding-with-apache-hama/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/shortest-path-finding-with-apache-hama/</guid><pubDate>Sat, 07 May 2011 09:30:00 GMT</pubDate><content:encoded>&lt;p&gt;Hi guys,&lt;/p&gt;
&lt;p&gt;I’ve finished my Google Summer of Code task. Really! Remember today is the 7th of may. And the actualy coding period goes until mid September.&lt;/p&gt;
&lt;p&gt;Okay obviously I’ve just finished the task itself, developing a new example with BSP. Since Hama does not require HBase anymore I have decided to split the tasks.&lt;br&gt;
One example (which I have submitted) is a straight single source shortest path implementation described in Google Pregel’s paper.&lt;br&gt;
The second one will be a HBase version using Dijkstra and its extend A*. The second won’t be committed to the codebase of Hama, just because I don’t want to add the old HBase dependency once again.&lt;/p&gt;
&lt;p&gt;So in the end everyone won: I used HBase to get more familiar with BigTable, Hama has a shortest path example and I can code the whole summer long knowing that I’ve finished my task ;D&lt;/p&gt;
&lt;p&gt;Okay ‘nuff talked, let’s dive into the algorithm!&lt;/p&gt;
&lt;p&gt;Like in &lt;a href=&quot;http://codingwiththomas.blogspot.com/2011/04/pagerank-with-apache-hama.html&quot;&gt;PageRank&lt;/a&gt; you should be familiar withthe idea behind the partitioning, read the Pregel paper and this time you should be familiar with (single source) shortest path finding.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Short summary of the algorithm&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;First off I just briefly describe how it should work, and then how I solved it.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Initialize all vertices’ cost to reach it to INFINITY, just the start vertex will have cost 0&lt;/li&gt;
&lt;li&gt;initially send the new cost to all adjacent vertex containing the new cost plus the edge weight between them&lt;/li&gt;
&lt;li&gt;Reviewing messages: if the cost coming from a message is lower than the actual cost, update the cost and send a message to the adjacent vertices, containing the new cost plus the edge weight between them (similar to the last step)&lt;/li&gt;
&lt;li&gt;Repeat the last step until no updates can be made anymore.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That is pretty much it.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;How we do it!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;First we need a model class that represents a shortest path vertex. It has a name/ID, a weight and a cost. The cost is the cost with the vertex can be reached from our starting vertex.&lt;br&gt;
A vertex will have an ID, that is just the hashcode of the name. I wanted a common way to partition a vertex so I’ve just set this based on the name called it ID. Watch out, when adding e.G. cities with the same name.&lt;/p&gt;
&lt;p&gt;I will skip the whole partitioning step, you can read the other posts to learn more about it, shortly described it is just a modulo function that will spread the vertices to different sequencefiles. These sequencefiles will get read during job initilization and mapped into memory.&lt;/p&gt;
&lt;p&gt;So let’s step into the code…&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Fields we need&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Because we store this time the cost and weights into a modelling vertex we just need a adjacency list and a lookup map.&lt;br&gt;
This looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ShortestPathVertex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ShortestPathVertex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; adjacencyList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashMap&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ShortestPathVertex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ShortestPathVertex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ShortestPathVertex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; vertexLookupMap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashMap&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ShortestPathVertex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Basically we are storing a vertex to its adjacents and the name to the vertex itself. I’ll tell you later why we need a lookup map.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Initialization&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In the init phase we need to map our adjacency list into ram, get our start vertex (just create it, we need it for equality check in the following loop which will just check the name)&lt;br&gt;
The following loop will just init the costs and send it to the adjacents.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bsp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BSPPeerProtocol&lt;/span&gt; peer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KeeperException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// map our input into ram  &lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;mapAdjacencyList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;conf&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; peer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// get the start vertex  &lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ShortestPathVertex&lt;/span&gt; start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ShortestPathVertex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
        conf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;shortest.paths.start.vertex.id&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// get our master groom  &lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; master &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; conf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;MASTER_TASK&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// init the vertices  &lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ShortestPathVertex&lt;/span&gt; v &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; adjacencyList&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;keySet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;start&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setCost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token comment&quot;&gt;// INF  &lt;/span&gt;
        v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setCost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;MAX_VALUE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
      &lt;span class=&quot;token comment&quot;&gt;// initial message bypass  &lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;sendMessageToNeighbors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;peer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;The send method&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The send method takes advantage of the partitioning, to get the target groom where the vertex is actually stored.&lt;br&gt;
It will bascially send a message containing the name of the vertex it targets and the cost it can be reached through the vertex in the parameter line.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sendMessageToNeighbors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BSPPeerProtocol&lt;/span&gt; peer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
      &lt;span class=&quot;token class-name&quot;&gt;ShortestPathVertex&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
    &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt; outgoingEdges &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; adjacencyList&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ShortestPathVertex&lt;/span&gt; adjacent &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; outgoingEdges&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; mod &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;adjacent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAllPeerNames&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAllPeerNames&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;mod&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
          &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IntegerMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;adjacent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
              id&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;MAX_VALUE&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
                  &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; adjacent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getWeight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Main Loop&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Very simple is the main loop, it is a while(true) loop that will break if no updates can be made anymore.&lt;br&gt;
So we are just parsing incoming messages, comparing the cost with the current cost. If the new cost is lower, then update it, put it into a queue and increment a local update counter.&lt;/p&gt;
&lt;p&gt;Now we need the lookup map, to get fast access to the actual cost in the vertex.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; updated &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;updated&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; updatesMade &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
      &lt;span class=&quot;token class-name&quot;&gt;IntegerMessage&lt;/span&gt; msg &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token class-name&quot;&gt;Deque&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ShortestPathVertex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; updatedQueue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LinkedList&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ShortestPathVertex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msg &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IntegerMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCurrentMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;ShortestPathVertex&lt;/span&gt; vertex &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; vertexLookupMap&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getTag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token comment&quot;&gt;// check if we need an distance update  &lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;vertex&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; msg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
          updatesMade&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
          updatedQueue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;vertex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
          vertex&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setCost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
      &lt;span class=&quot;token comment&quot;&gt;// synchonize with all grooms if there were updates  &lt;/span&gt;
      updated &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;broadcastUpdatesMade&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;peer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; master&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updatesMade&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token comment&quot;&gt;// send updates to the adjacents of the updated vertices  &lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ShortestPathVertex&lt;/span&gt; vertex &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; updatedQueue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token function&quot;&gt;sendMessageToNeighbors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;peer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; vertex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Afterwards we are sending the updatecounter to a master groom that will evaluate and check if updates can be applied. I leave this method out, you can check out the pagerank error method. It is roughly the same.&lt;/p&gt;
&lt;p&gt;If we have updates to apply, we just send them to the neighbor edges again.&lt;br&gt;
Then we are just repeating until the master says: no updates can occur anymore.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Submit your own SequenceFile adjacency list&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;This is of course an example, so you can submit this to your own cluster and give it the input you like. I have designed the input like this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The adjacencylist contains two text fields on each line. The key&lt;br&gt;
component is the name of a vertex, the value is a ”:” separated Text&lt;br&gt;
field that contains the name of the adjacent vertex leftmost and the&lt;br&gt;
weight on the rightmost side.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;K            /                V   
Vertex[Text] / AdjacentVertex : Weight [Text]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;p&gt;So you can setup a sequencefile like this (obviously I won’t write any binary code here :p ):&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Berlin /  Paris : 25&lt;br&gt;
Berlin / London : 40&lt;br&gt;
London / Paris : 10&lt;br&gt;
etc.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The basic usage of the command line arguments are:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;name of the start vertex&gt; &amp;#x3C;optional: output path&gt; &amp;#x3C;optional: path of your own sequencefile&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;So you can run this with:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;hama/bin/hama jar ../hama-0.x.0-examples.jar sssp Berlin /srv/tmp/ /home/user/myOwnGraph.seq&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I’ve submitted this as a patch here: &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-359&quot;&gt;https://issues.apache.org/jira/browse/HAMA-359&lt;/a&gt;&lt;br&gt;
So feel free to check it out, I hope it will get comitted soon. Never the less, it is contained also in my trunk on google code: &lt;a href=&quot;http://code.google.com/p/hama-shortest-paths/&quot;&gt;http://code.google.com/p/hama-shortest-paths/&lt;/a&gt;&lt;br&gt;
Class is called: &lt;strong&gt;de.jungblut.hama.bsp.ShortestPaths&lt;/strong&gt;&lt;br&gt;
Just run the main method ;)&lt;/p&gt;
&lt;p&gt;Have fun with it!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Google Summer of Code]]></title><description><![CDATA[Hey all, maybe you’ve read it already on Twitter, I got picked for GSoC2k11 :D Of course I’m very proud and want to thank everybody who…]]></description><link>https://blog.thomasjungblut.com/blogger/google-summer-of-code/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/google-summer-of-code/</guid><pubDate>Sun, 01 May 2011 16:02:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey all,&lt;/p&gt;
&lt;p&gt;maybe you’ve read it already on Twitter, I got picked for GSoC2k11 :D&lt;br&gt;
Of course I’m very proud and want to thank everybody who helped me across the way. Especially my mentor: Edward J. Yoon.&lt;/p&gt;
&lt;p&gt;If you don’t know what my project actually was, have a look at &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-359&quot;&gt;Development of Shortest Path Finding Algorithm.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Basically I want to create a scalable solution, that takes a HUGE graph :) and and provides a fast solution of SSSP (single source shortest path) problems.&lt;br&gt;
Like I already told in the Apache’s Jira issue, I focus on a distributed Dijkstra algorithm that uses an adjacency list. So at first I’ll focus on sparse graphs. The adjacency list is stored into a BigTable structure, in my case this will be HBase.&lt;/p&gt;
&lt;p&gt;After I finished this, I will focus on a refinement of partitioning and if I have enough time I extend the Dijkstra with an A* heuristic.&lt;/p&gt;
&lt;p&gt;These steps are basically my plan for this summer :)&lt;/p&gt;
&lt;p&gt;Right now I started my first commit of Dijkstra’s algorithm, it currently contains the old BSP version which I started with weeks ago to get familiar with Apache Hama. It is actually a working example, so feel free to check out the code and run its main method. This will start a local multithreaded BSP with some sample data of the german wikipedia page of Dijkstra’s algorithm.&lt;br&gt;
The class is located here: &lt;strong&gt;de.jungblut.hama.bsp.BSPDijkstra&lt;/strong&gt;.&lt;br&gt;
The repository can be found here: &lt;a href=&quot;http://code.google.com/p/hama-shortest-paths/&quot;&gt;http://code.google.com/p/hama-shortest-paths/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Please star this project and the jira issue :D&lt;/p&gt;
&lt;p&gt;I’ll keep you updated on every change and thoughts I made. &lt;br&gt;
Thank you very much: Edward, Apache Software Foundation and Google!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Profiling Apache Hama BSP's]]></title><description><![CDATA[Hi all, sometimes you aren’t aware of why your application is performing slow or slower than before and you need a profiler to know in which…]]></description><link>https://blog.thomasjungblut.com/blogger/profiling-apache-hama-bsps/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/profiling-apache-hama-bsps/</guid><pubDate>Sat, 23 Apr 2011 15:09:00 GMT</pubDate><content:encoded>&lt;p&gt;Hi all,&lt;/p&gt;
&lt;p&gt;sometimes you aren’t aware of why your application is performing slow or slower than before and you need a profiler to know in which methods the most time is spent.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Which profiler should I use?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;That depends on your needs, I prefer &lt;a href=&quot;http://www.yourkit.com/&quot;&gt;YourKit&lt;/a&gt;. It has a fairly good thread monitoring and cool inspectations. Most of the time I’m searching for memory leaks or why a thread has deadlocked, so this profiler is a very helpful tool for these cases.&lt;/p&gt;
&lt;p&gt;This time we are focussing on the profiling of a BSP method / class. Or: How you can profile your own Hama application inside of a cluster.&lt;/p&gt;
&lt;p&gt;In my case I’m using VM’s with Ubuntu, and Windows 7 on my host machine. This might be a common setup. YourKit itself is written in Java and it can be executed on Unix as well.&lt;br&gt;
We are going to start the application with the profiler agent and tunnel the profiler port with Putty to our host machine: in my case Windows.&lt;/p&gt;
&lt;p&gt;Let’s go!&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Download Yourkit &lt;a href=&quot;http://www.yourkit.com/download/index.jsp&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Install Yourkit and &lt;a href=&quot;http://www.chiark.greenend.org.uk/%7Esgtatham/putty/download.html&quot;&gt;Putty&lt;/a&gt; (if you’re running windows, otherwise you can just use your shell) on your host machine.&lt;/li&gt;
&lt;li&gt;Download Yourkit for the server machine and untar it&lt;/li&gt;
&lt;li&gt;Look for the shared object (libyjpagent.so) in the yjp-9.5.5/bin/linux-x86-32 directory. Note: Make sure you pick the right version for your JVM. 32 bit if you aren’t sure, 64 bit else.&lt;/li&gt;
&lt;li&gt;Copy it under a path that is more readable like “/usr/local/yk/libyjpagent.so”&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Now is YourKit setup properly and we have to set the agent to the Hama configuration on the BSPMaster.&lt;br&gt;
Look into your “hama-site.xml” and if the property key “bsp.child.java.opts” isn’t set yet, you have to override it with that:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt; &lt;property&gt;&lt;br&gt;
&lt;name&gt;bsp.child.java.opts&lt;/name&gt;&lt;br&gt;
&lt;value&gt;-Xmx1024m -agentpath:/usr/local/yk/libyjpagent.so&lt;/value&gt;&lt;br&gt;
&lt;/property&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Sure you’ll have to replace the agentpath with the path you copy your shared object to. Make sure you have chown’d it with the user that runs Hama. Note: The heap limit is just a copy of the default value in hama-default.xml. Anything configured in hama-default.xml will be overridden by the hama-site.xml configuration parameters.&lt;/p&gt;
&lt;p&gt;Now you have to make sure that this libyjpagent.so is on EVERY machine on your cluster. Hama currently can’t just let a few tasks start with the profiler (Like Hadoop), you’ll have to provide this for every groom.&lt;/p&gt;
&lt;p&gt;If this is working, you can just start DFS, start BSPMaster and the agent will be started within. You can see this in your groom’s log by an entry like this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;2011-04-22 17:45:53,104 INFO org.apache.hama.bsp.TaskRunner: attempt_201104221744_0001_000001_0 [YourKit Java Profiler 9.5.5] Loaded. Log file: /home/hadoop/.yjp/log/1864.log&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Don’t forget to take a look into the log file to determine on which port the agent is broadcasting information. This is necassary for the remote connection of Putty.&lt;br&gt;
In every cases yourkit will test your ports by starting with 10000, if its blocked, it picks 10001 and so on.&lt;br&gt;
In the log you should see something equal to this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[YourKit Java Profiler 9.5.5] [0.539]: Profiler agent is listening on port &lt;strong&gt;10001&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Ok now we have to setup our Putty on our Windows system.&lt;br&gt;
Enter all your information on the Session tab: like the hostname of the BSPMaster. In my case this is &lt;a href=&quot;mailto:thomasjungblut@192.168.56.102&quot;&gt;thomasjungblut@192.168.56.102&lt;/a&gt; and port 22.&lt;/p&gt;
&lt;p&gt;Now switch to the Connection-&gt;SSH-&gt;Tunnels tab and add a new tunnel.&lt;br&gt;
For port 10001 it will be:&lt;br&gt;
Sourceport 10001, Destination raynor:10001, Local and Auto.&lt;br&gt;
The destination host:port pair is the host:port of your BSPMaster.&lt;/p&gt;
&lt;p&gt;Now open up the session, login and the profiling data will be tunneled over this port.&lt;/p&gt;
&lt;p&gt;Inside of YourKit you’ll have to click: “Connect to remote application” and enter localhost:10001 (or the other port if YourKit gave you another).&lt;br&gt;
Congratulations, you connected to your running application inside of your cluster.&lt;/p&gt;
&lt;p&gt;Just a tip if you are profiling Hama. You’ll have to deactivate the apache.org filter under Settings-&gt;Filter. Otherwise every method call will be filtered. BUT if you just want your own application to profile, this is just noise of the framework. So you can filter it.&lt;/p&gt;
&lt;p&gt;Good luck and have fun!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Apache Hama network throughput]]></title><description><![CDATA[Hey I’ve read about a new task: Improve output of RandBench example This is basically about some more output. But this actually caused me to…]]></description><link>https://blog.thomasjungblut.com/blogger/apache-hama-network-throughput/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/apache-hama-network-throughput/</guid><pubDate>Sun, 17 Apr 2011 12:05:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey I’ve read about a new task: &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-377&quot;&gt;Improve output of RandBench example&lt;/a&gt;&lt;br&gt;
This is basically about some more output. But this actually caused me to measure the throughput of my virtual Hama cluster.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;My cluster&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Some months ago I decided to get rid of my real hardware server and just go along with &lt;a href=&quot;http://www.xtremeforum.de/index.php?page=Attachment&amp;#x26;attachmentID=131&amp;#x26;h=0cd80e1236c15326fdebdd9ee9d5d53648cdf9d4&quot;&gt;one massive machine&lt;/a&gt; that will host multiple virtual machines. I have now two different virtual hosts (virtualbox ftw) with 2 cores and 1gig of memory each.&lt;br&gt;
The hosts are connected by a virtual Intel PRO/1000 MT Desktop card.&lt;br&gt;
On server is configured as a namenode, datanode, bspmaster and groom. The other machine is just a datanode and a groom.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;RandBench&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Randbench is just a simple looping utility that will send a constant size data packet randomly across your cluster.&lt;br&gt;
If you are familiar with BSP you know that you can put messages into a local queue, which is nothing else than storing the packet into the local random access memory. This doesn’t really need to be benchmarked. So we can assume that if we run this on a two host cluster there is a 50% probability that the message will be send to the other host over the network. Every host executing its BSP method will actually twice the data send.&lt;br&gt;
On a two host cluster you can actually assume that the size of the data we are giving at startup will be send to the other host.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Startup Options&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In my little test we are going to use these parameters: bench 524288 100 2000.&lt;br&gt;
The first number represents the message size in bytes (so this is 512kb), the second argument telling the benchmark how often we are sending this message in a superstep. And the last argument is the number of supersteps.&lt;br&gt;
This will sum up to a total size of 97,65625gb. Note that the benchmark is also sending a string as the message tag which tells where the message comes from and goes to. This will cause the data send to be a bit higher.&lt;br&gt;
In my case this is 30 bytes (“karrigan:61000 to raynor:61000”, yea my vhosts are starcraft characters:P) for each messages that has been sent. So 100 * 2k supersteps will result in 200000 messages with 30 bytes each will sum up to 6000000 bytes, that is roughly 5,7 mb. This won’t be a great deal compared to the 97g of byte arrays.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Result&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Afterwards the benchmark tells you how much time this test took:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;11/04/17 13:07:57 INFO bsp.BSPJobClient: The total number of supersteps: 2000&lt;br&gt;
Job Finished in 1502.107 seconds&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Now we can calculate the average networking throughput, because we know how much data we’ve sent in a delta of time.&lt;br&gt;
97gb / 1502.107s = 66mb/s&lt;/p&gt;
&lt;p&gt;Note that…&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;these timings are VM based so I will disclaim a conclusion here&lt;/li&gt;
&lt;li&gt;the data send is a dummy data array filled with zeros&lt;/li&gt;
&lt;li&gt;we can therefore greatly run into caching&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[PageRank with Apache Hama]]></title><description><![CDATA[Hey, some days ago I read in the Hama-dev mailing list about the Nutch project that want a PageRank implementation: Hi all, Anyone…]]></description><link>https://blog.thomasjungblut.com/blogger/pagerank-with-apache-hama/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/pagerank-with-apache-hama/</guid><pubDate>Sat, 16 Apr 2011 16:02:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey,&lt;/p&gt;
&lt;p&gt;some days ago I read in the Hama-dev mailing list about the Nutch project that want a PageRank implementation:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Hi all,&lt;br&gt;
Anyone interested in PageRank and collaborating w/ Nutch project? :-)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://www.mail-archive.com/hama-dev@incubator.apache.org/msg03849.html&quot;&gt;Source&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;So I thought, that I can do this. I already implemented PageRank with MapReduce. Why don’t we go for a BSP version?:D&lt;br&gt;
This is basically what this blog post is about.&lt;/p&gt;
&lt;p&gt;Let’s make a few assumptions:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We have an adjacency list (web-graphs are sparse) of webpages and their unweighted edges&lt;/li&gt;
&lt;li&gt;A working partitioning &lt;a href=&quot;http://codingwiththomas.blogspot.com/2011/04/apache-hama-partitioning.html&quot;&gt;like here&lt;/a&gt;. (You must not implement it, but should know how it works)&lt;/li&gt;
&lt;li&gt;We have read the Pregel Paper (&lt;a href=&quot;http://blog.udanax.org/2010/06/summary-of-google-pregel.html&quot;&gt;or at least the summary&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Familiarity with &lt;a href=&quot;http://en.wikipedia.org/wiki/PageRank&quot;&gt;PageRank&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Web Graph Layout&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;This is the adjacency list. On the leftmost side is the vertexID of the webpage, followed by the outlinks that are seperated by tabs.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1 2 3  
2  
3 1 2 5  
4 5 6  
5 4 6  
6 4  
7 2 4  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This will be pretty printed a graph like this:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://2.bp.blogspot.com/-5O4suZbk0lU/TamvQMd-zJI/AAAAAAAAAQU/bs5a-G5yAIs/s1600/Unbenannt.PNG&quot;&gt;&lt;img src=&quot;http://2.bp.blogspot.com/-5O4suZbk0lU/TamvQMd-zJI/AAAAAAAAAQU/bs5a-G5yAIs/s320/Unbenannt.PNG&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I have colored them by the incoming links, the vertex with the most in-links is the brightest, the vertex with few or no in-links is more darker.&lt;br&gt;
We will see that vertex 2 should get a high PageRank, 4, 5 and 6 should get a more or less equal rank and so on.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Short summary of the algorithm&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I am now referring to the Google Pregel paper. At first we need a modelling class that will represent a vertex and holds its own tentative PageRank. In my case we are storing the tentative PageRank along with the id of a vertex in a HashMap.&lt;br&gt;
In the first superstep we set the tentative PageRank to 1 / n. Where n is the number of vertices in the whole graph.&lt;br&gt;
In each of the steps we are going to send for every vertex its PageRank, devided by the number of its outgoing edges, to all adjacent vertices in the graph.&lt;br&gt;
So from the second step we are receiving messages with a tentative PageRank of a vertex that is adjacent. Now we are summing up these messages for each vertex “i” and using this formula:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;P(i) = 0.15/NumVertices() + 0.85 * sum&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This is the new tentative PageRank for a vertex “i”.&lt;br&gt;
I’m not sure whether NumVertices() returns the number of all vertices or just the number of adjacent vertices. I’ll assume that this is the count of all vertices in the graph, this would then be a constant. Now adding the damping factor multiplying this by the sum of the received tentatives of the adjacent vertices.&lt;/p&gt;
&lt;p&gt;We are looping these steps until convergence to a given error will be archived. This error is just a sum of absoluting the difference between the old tentative PageRank and the new one of each vertex.&lt;br&gt;
Or we can break if we are reaching a iteration that is high enough.&lt;/p&gt;
&lt;p&gt;We are storing the old PageRank as a copy of the current PageRank (simple HashMap).&lt;br&gt;
The error will thus be a local variable that we are going to sync with a master task- he will average them and broadcasts it back to all the slaves.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Code&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Let’s look at the fields we need:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;private static int MAX\_ITERATIONS = 30;  
 // alpha is 0.15/NumVertices()  
 private static double ALPHA;  
 private static int numOfVertices;  
 private static double DAMPING\_FACTOR = 0.85;  
 // this is the error we want to archieve  
 private static double EPSILON = 0.001;  
  
        HashMap&amp;lt;Integer, List&amp;lt;Integer&gt;&gt; adjacencyList = new HashMap&amp;lt;Integer, List&amp;lt;Integer&gt;&gt;();  
 // normally this is stored by a vertex, but I don&apos;t want to create a new  
 // model for it  
 HashMap&amp;lt;Integer, Double&gt; tentativePagerank = new HashMap&amp;lt;Integer, Double&gt;();  
 // backup of the last pagerank to determine the error  
 HashMap&amp;lt;Integer, Double&gt; lastTentativePagerank = new HashMap&amp;lt;Integer, Double&gt;();  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Keep in mind that every task just has a subgraph of the graph. So these structures will hold just a chunk of PageRank.&lt;/p&gt;
&lt;p&gt;Let’s get into the init phase of the BSP:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;@Override  
 public void bsp(BSPPeerProtocol peer) throws IOException, KeeperException,  
   InterruptedException {  
  fs = FileSystem.get(getConf());  
  String master = conf.get(MASTER\_TASK);  
  // setup the datasets  
  adjacencyList = mapAdjacencyList(getConf(), peer);  
  // init the pageranks to 1/n where n is the number of all vertices  
  for (int vertexId : adjacencyList.keySet())  
   tentativePagerank  
     .put(vertexId, Double.valueOf(1.0 / numOfVertices));  
  
...  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Like we said, we are reading the data chunk from HDFS and going to set the tentative pagerank to 1/n.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Main Loop&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// while the error not converges against epsilon do the pagerank stuff  
  double error = 1.0;  
  int iteration = 0;  
  // if MAX\_ITERATIONS are set to 0, ignore the iterations and just go  
  // with the error  
  while ((MAX\_ITERATIONS &gt; 0 &amp;amp;&amp;amp; iteration &amp;lt; MAX\_ITERATIONS)  
    || error &gt;= EPSILON) {  
  
   peer.sync();  
  
   if (iteration &gt;= 1) {  
    // copy the old pagerank to the backup  
    copyTentativePageRankToBackup();  
    // sum up all incoming messages for a vertex  
    HashMap&amp;lt;Integer, Double&gt; sumMap = new HashMap&amp;lt;Integer, Double&gt;();  
    IntegerDoubleMessage msg = null;  
    while ((msg = (IntegerDoubleMessage) peer.getCurrentMessage()) != null) {  
     if (!sumMap.containsKey(msg.getTag())) {  
      sumMap.put(msg.getTag(), msg.getData());  
     } else {  
      sumMap.put(msg.getTag(),  
        msg.getData() + sumMap.get(msg.getTag()));  
     }  
    }  
    // pregel formula:  
    // ALPHA = 0.15 / NumVertices()  
    // P(i) = ALPHA + 0.85 \* sum  
    for (Entry&amp;lt;Integer, Double&gt; entry : sumMap.entrySet()) {  
     tentativePagerank.put(entry.getKey(),  
       ALPHA + (entry.getValue() \* DAMPING\_FACTOR));  
    }  
  
    // determine the error and send this to the master  
    double err = determineError();  
    error = broadcastError(peer, master, err);  
   }  
   // in every step send the tentative pagerank of a vertex to its  
   // adjacent vertices  
   for (int vertexId : adjacencyList.keySet())  
    sendMessageToNeighbors(peer, vertexId);  
  
   iteration++;  
  }  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I guess this is self explaining. The function broadcastError() will send the determined error to a master task, he will average all incoming errors and broadcasts this back to the slaves (similar to aggregators in the Pregel paper).&lt;br&gt;
Let’s take a quick look at the determineError() function:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;private double determineError() {  
  double error = 0.0;  
  for (Entry&amp;lt;Integer, Double&gt; entry : tentativePagerank.entrySet()) {  
   error += Math.abs(lastTentativePagerank.get(entry.getKey())  
     - entry.getValue());  
  }  
  return error;  
 }  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Like I described in the summary we are just summing up the errors that is a difference between the old and the new rank.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Output&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Finally we are able to run this and receive a fraction between 0 and 1 that will represent the PageRank of each site.&lt;br&gt;
I was running this with a convergence error of 0.000001 and a damping factor of 0.85. This took about 17 iterations.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;\------------------- RESULTS --------------------  
2 | 0.33983048615390526  
4 | 0.21342628110369394  
6 | 0.20495452025114747  
5 | 0.1268811487940641  
3 | 0.0425036157080356  
1 | 0.0425036157080356  
7 | 0.02990033228111791  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This will result in about 1.0 in the sum of all ranks, which is correct.&lt;br&gt;
Note that the output if you are running this job is not guaranteed to be sorted, I did this to give you a better view.&lt;/p&gt;
&lt;p&gt;We’ll see that we were quite good in our guessing of the PageRank in the beginning.&lt;/p&gt;
&lt;p&gt;I think this is all, if you are interested in testing / running this- feel free to do so.&lt;br&gt;
This class and test data is located in my Summer of Code repository under: &lt;a href=&quot;http://code.google.com/p/hama-shortest-paths/&quot;&gt;http://code.google.com/p/hama-shortest-paths/&lt;/a&gt;&lt;br&gt;
The classes name is &lt;em&gt;de.jungblut.hama.bsp.PageRank&lt;/em&gt;.&lt;br&gt;
Just execute the main method, it will run a local multithreaded BSP on your machine.&lt;/p&gt;
&lt;p&gt;Star this project and vote for my &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-359&quot;&gt;GSoC task&lt;/a&gt;. :)&lt;/p&gt;
&lt;p&gt;Thank you.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Apache Hama Partitioning]]></title><description><![CDATA[Hello there! I was a bit busy today after I’ve read the Google Pregel paper. It described quite good “how to think like a vertex” and how…]]></description><link>https://blog.thomasjungblut.com/blogger/apache-hama-partitioning/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/apache-hama-partitioning/</guid><pubDate>Tue, 12 Apr 2011 15:51:00 GMT</pubDate><content:encoded>&lt;p&gt;Hello there!&lt;/p&gt;
&lt;p&gt;I was a bit busy today after I’ve read the Google Pregel paper. It described quite good “how to think like a vertex” and how they are partition data across their cluster.&lt;br&gt;
I wanted to share this new knowledge with you and I’ve shortly rewritten my Graph Exploration algorithm. It can be found as the post below or just following &lt;a href=&quot;http://codingwiththomas.blogspot.com/2011/04/graph-exploration-using-apache-hama-and.html&quot;&gt;this link&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Just a short summary of what we are going to change:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Partition the vertices across the servers.&lt;/li&gt;
&lt;li&gt;Messages that are related to a specific vertex will just go to the server the vertex was partitioned to.&lt;/li&gt;
&lt;li&gt;The master task just keeps track of when the task is finished (no updates were made).&lt;/li&gt;
&lt;li&gt;Each task has its own output.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Partitioning&lt;/strong&gt;&lt;br&gt;
I really felt dumb today after I read the Pregel paper. They are just partitioning the data with a hashfunction. And I was like running several MapReduce jobs to determine the optimal distribution of an adjacency list. So scratch that, we just use a simple HashFunction that is none other than returning the id of the vertex. If you are having for example Vertex IDs’ from 0-100 and you have to distribute it over 5 machines, just loop to 100 and modulo it with the 5 machines. Life can be so simple. sic!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;How to distribute?&lt;/strong&gt;&lt;br&gt;
First off we share the common FileSystem across the servers. The idea is that every server get’s its own SequenceFile where the data is stored in. Let’s rush into the code that parses my AdjacencyList textfile into the SequenceFiles for the servers:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;public static List&amp;lt;Path&gt; partitionAdjacencyTextFile(int sizeOfCluster,
  
   Map&amp;lt;String, String&gt; groomNames, Path fileToPartition,
  
   Configuration conf) throws IOException {
  
  // setup the paths where the grooms can find their input
  
  List&amp;lt;Path&gt; partPaths = new ArrayList&amp;lt;Path&gt;(sizeOfCluster);
  
  List&amp;lt;SequenceFile.Writer&gt; writers = new ArrayList&amp;lt;SequenceFile.Writer&gt;(
  
    sizeOfCluster);
  
  FileSystem fs = FileSystem.get(conf);
  
  for (Entry&amp;lt;String, String&gt; entry : groomNames.entrySet()) {
  
   partPaths.add(new Path(fileToPartition.getParent().toString()
  
     + Path.SEPARATOR + &quot;parted&quot; + Path.SEPARATOR
  
     + entry.getValue()));
  
  }
  
  // create a seq writer for that
  
  for (Path p : partPaths) {
  
   fs.delete(p, true);
  
   writers.add(SequenceFile.createWriter(fs, conf, p,
  
     IntWritable.class, IntWritable.class));
  
  }
  
  
  // parse our file
  
  FSDataInputStream data = fs.open(fileToPartition);
  
  BufferedReader br = new BufferedReader(new InputStreamReader(data));
  
  String line = null;
  
  while ((line = br.readLine()) != null) {
  
   String\[\] arr = line.split(&quot;\\t&quot;);
  
   int vId = Integer.parseInt(arr\[0\]);
  
   LinkedList&amp;lt;Integer&gt; list = new LinkedList&amp;lt;Integer&gt;();
  
   for (int i = 0; i &amp;lt; arr.length; i++) {
  
    list.add(Integer.parseInt(arr\[i\]));
  
   }
  
  
   int mod = vId % sizeOfCluster;
  
   System.out.println(vId + &quot; goes to &quot; + partPaths.get(mod));
  
   for (int value : list) {
  
    writers.get(mod).append(new IntWritable(vId),
  
      new IntWritable(value));
  
   }
  
  
  }
  
  data.close();
  
  
  for (SequenceFile.Writer w : writers)
  
   w.close();
  
  
  return partPaths;
  
 }
  
  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Basically we are creating a SequenceFile for each Groom and writing the data with the modulo function into the SequenceFiles. Note that the names of the SequenceFiles are related to the name of the peer. That is because we can simply let each peer find its partition.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;How to pass messages between vertices using partitioning?&lt;/strong&gt;&lt;br&gt;
If we know what kind of partition we used, this is very simple. Look at the layered send method.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;private void send(BSPPeerProtocol peer, BSPMessage msg) throws IOException {
  
  int mod = ((Integer) msg.getTag()) % peer.getAllPeerNames().length;
  
  peer.send(peer.getAllPeerNames()\[mod\], msg);
  
 }
  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The only requirement is, that the indices of peer.getAllPeerNames() are the same we used in the partitioning phase, otherwise it will result in strange behaviour.&lt;/p&gt;
&lt;p&gt;With the help of these two methods we are now able to make the main algorithm use less master-slave communication and therefore use a more collective communication.&lt;br&gt;
But keep in mind that we have to use the master-slave communication to keep track of the main loop. The problem behind it is that if a slave breaks its calculation because there can’t be more updates made in a superstep, the other peers will deadlock in the next sync phase because one slave already has finished.&lt;br&gt;
So we have to sync the updates with a master task and broadcast whether we can break the main loop altogether (if no task can update anymore) or we need another superstep.&lt;/p&gt;
&lt;p&gt;This is actually a bit hacky. In the Pregel paper it is called “voteToHalt”. Have a look at my implementation of the same:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;private boolean voteForHalt(BSPPeerProtocol peer, String master)
  
   throws IOException, KeeperException, InterruptedException {
  
  peer.send(master, new IntegerMessage(&quot;&quot;, activeList.size()));
  
  peer.sync();
  
  if (peer.getPeerName().equals(master)) {
  
   boolean halt = true;
  
   IntegerMessage message;
  
   while ((message = (IntegerMessage) peer.getCurrentMessage()) != null) {
  
    message = (IntegerMessage) peer.getCurrentMessage();
  
    if (message.getData() != 0) {
  
     halt = false;
  
     break;
  
    }
  
   }
  
   peer.clear();
  
   for (String name : peer.getAllPeerNames()) {
  
    peer.send(name, new BooleanMessage(&quot;&quot;, halt));
  
   }
  
  }
  
  
  peer.sync();
  
  BooleanMessage message = (BooleanMessage) peer.getCurrentMessage();
  
  if (message.getData() == true) {
  
   return false;
  
  } else {
  
   return true;
  
  }
  
 }
  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;A bit more human readable it says: Every task sends how many vertices are stored in the activeList and a master decides whether to break or not. This decision is broadcasted again and a false return value will break the outer running loop.&lt;/p&gt;
&lt;p&gt;Keep in mind that this is &lt;strong&gt;not&lt;/strong&gt; very very very optimal.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Output&lt;/strong&gt;&lt;br&gt;
Now we have multiple files in HDFS that can now be read or merged to get the classified components of the graph.&lt;/p&gt;
&lt;p&gt;This snippet is quite generic if you want to use it in your application: feel free to copy and paste ;)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;private static void printOutput(FileSystem fs, Configuration conf)
  
   throws IOException {
  
  System.out.println(&quot;-------------------- RESULTS --------------------&quot;);
  
  FileStatus\[\] stati = fs.listStatus(new Path(conf.get(&quot;out.path&quot;)
  
    + Path.SEPARATOR + &quot;temp&quot;));
  
  for (FileStatus status : stati) {
  
   Path path = status.getPath();
  
   SequenceFile.Reader reader = new SequenceFile.Reader(fs, path, conf);
  
   IntWritable key = new IntWritable();
  
   IntWritable value = new IntWritable();
  
   while (reader.next(key, value)) {
  
    System.out.println(key.get() + &quot; | &quot; + value.get());
  
   }
  
   reader.close();
  
  }
  
 }
  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see, it just fetches the parent directory of the outputs’ and loops over the files while writing the content to STDOUT.&lt;br&gt;
Gladly this helped &lt;a href=&quot;http://stackoverflow.com/questions/5634137/programmatically-reading-the-output-of-hadoop-mapreduce-program&quot;&gt;a guy on Stackoverflow&lt;/a&gt; today. And helped me to get my 500 reputation :)&lt;/p&gt;
&lt;p&gt;Finally it gaves the same output as the other algorithms:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;\-------------------- RESULTS --------------------
  
0 | 0
  
1 | 1
  
2 | 2
  
3 | 2
  
4 | 1
  
5 | 2
  
6 | 2
  
7 | 1
  
8 | 2
  
9 | 0
  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The new class is called: de.jungblut.hama.graph.BSPGraphExplorationPartitioned.&lt;br&gt;
Just execute the main method, it will run a local multithreaded BSP on your machine.&lt;br&gt;
This class is located in my Summer of Code repository under: &lt;a href=&quot;http://code.google.com/p/hama-shortest-paths/&quot;&gt;http://code.google.com/p/hama-shortest-paths/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Star this project or vote for my &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-359&quot;&gt;GSoC task&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The next week I’ll go for a comparision between these three implementations: partitioned-BSP, BSP and MapReduce.&lt;br&gt;
But I guess before it I focus at PageRank. Some guys of Apache Nutch wanted a distributed PageRank in BSP, I’ll go for a working example next time.&lt;br&gt;
The Pregel paper said something about 15 lines of code. Looks like a short task ;)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;[UPDATE]&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;If you are interested in a more faster way to partition, check out the new blog post here:&lt;br&gt;
&lt;a href=&quot;http://codingwiththomas.blogspot.com/2011/08/apache-hama-partitioning-improved.html&quot;&gt;http://codingwiththomas.blogspot.com/2011/08/apache-hama-partitioning-improved.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;bye!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Graph Exploration with Apache Hama]]></title><description><![CDATA[Hey guys, I’ve been busy for a tiny bit of time, but I finished the graph exploration algorithm with Apache Hama recently. This post is…]]></description><link>https://blog.thomasjungblut.com/blogger/graph-exploration-using-apache-hama-and/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/graph-exploration-using-apache-hama-and/</guid><pubDate>Sun, 10 Apr 2011 08:43:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey guys,&lt;br&gt;
I’ve been busy for a tiny bit of time, but I finished the graph exploration algorithm with &lt;a href=&quot;http://incubator.apache.org/hama/&quot;&gt;Apache Hama&lt;/a&gt; recently. This post is about the BSP portation of &lt;a href=&quot;http://codingwiththomas.blogspot.com/2011/04/graph-exploration-with-hadoop-mapreduce.html&quot;&gt;this post&lt;/a&gt;.&lt;br&gt;
So I already told in &lt;a href=&quot;http://codingwiththomas.blogspot.com/2011/04/back-to-blogsphere.html&quot;&gt;this post&lt;/a&gt; how BSP basically works. Now I’m going to tell you what you can do with it in terms of graph exploration. Last post I did this with MapReduce, so let’s go and get into Hama!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;As of today&lt;/strong&gt; this is merely outdated, since Hama 0.5.0, you can use the Pregel-like Graph API and run the connected components example shipped. This will do everything this code below did a year ago.&lt;br&gt;
I just keep that as a part of history, some of the statements still hold true, some parts needs to be updated though.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;BSP Class&lt;/strong&gt;&lt;br&gt;
Like coding a mapper you’ll need to inherit from a baseclass. In Hama this is the BSP class, it is abstract and implements a interface called BSPInterface. BSPInterface has a method that you are going to implement for yourself:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bsp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BSPPeerProtocol&lt;/span&gt; bspPeer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;What is BSPPeerProtocol and how is it getting executed?&lt;/strong&gt;&lt;br&gt;
The BSPPeerProtocol is nothing else than a reference to your local running Groom server. A Groom is similar to Hadoop’s tasktracker. This is also a hint on how your own BSP get’s executed. Hama will launch several tasks inside a Groom and create a new instance of your BSP class per task.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Syncing&lt;/strong&gt;&lt;br&gt;
In BSP it is necessary to synchronize the Grooms’ in order to introduce the messaging phase described &lt;a href=&quot;http://codingwiththomas.blogspot.com/2011/04/back-to-blogsphere.html&quot;&gt;here&lt;/a&gt;. You can simply call the sync() method from your BSPPeerProtocol reference.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Letting code be executed on only one Server / Groom / Task&lt;/strong&gt;&lt;br&gt;
This is actually pretty easy, you could take a look at the &lt;a href=&quot;http://wiki.apache.org/hama/PiEstimator&quot;&gt;PiEstimator example.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Okay I guess this is enough, let’s step into the code. The thoughts are the same like in the MapReduce example:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Initialize the datasets, we have several maps’ storing active vertices, the adjacency list and a map which holds the minimal vertices for each vertex.&lt;/li&gt;
&lt;li&gt;In the first iteration, send a message for each adjacent of a vertex containing the id of the adjacent vertex and it’s currently minimal vertex to a master task. If we are not in the first iteration we are going to loop through the active vertices and their adjacent vertices, broadcasting to every adjacent vertex what the new minimal id is.&lt;/li&gt;
&lt;li&gt;Sync so that every task receives the messages.&lt;/li&gt;
&lt;li&gt;A master task is fetching the results and updating the minimal vertex ids. If a vertex has been updated, we put its id into the “activeVertexMap”. Sending the active vertices to all existing peers.&lt;/li&gt;
&lt;li&gt;Sync again: if we received nothing, just break the main loop resulting in exiting the bsp. If we receive new active vertices, increment the iteration and continue with point 2. &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Input / Output System&lt;/strong&gt;&lt;br&gt;
Maybe you know that Hama has currently no real Input and Output system. So you have to take care for yourself: Manage the data the grooms need for their computation, partitioning and updating.&lt;br&gt;
I hope hat &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-258&quot;&gt;this issue&lt;/a&gt; will be resolved soon, so that this whole management will be inside Hama and is not blowing up your BSP class.&lt;br&gt;
For this example we need two major files: The actual adjacency list and the map that keeps track of the current minimas. If you are a wondering why, the last time we saved this up into a vertex itself. This is true, but I don’t want to add another model for a vertex. This is just a personal reason, so feel free to fork and build your own ;)&lt;br&gt;
Both files are in HDFS, a far more scalable solution would be to store these into a HBase table. But since Hama doesn’t require HBase anymore, I’ll go for a FileSystem-way of storing data.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Source Code&lt;/strong&gt;&lt;br&gt;
If you want to see the full implementation, check it out at &lt;a href=&quot;http://code.google.com/p/hama-shortest-paths/&quot;&gt;http://code.google.com/p/hama-shortest-paths/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Let’s start with the initialization phase in the bsp method:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; master &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; conf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;MASTER&lt;/span&gt;\_TASK&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  fs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FileSystem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getConf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
  &lt;span class=&quot;token comment&quot;&gt;// setup the datasets  &lt;/span&gt;
  adjacencyList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mapAdjacencyList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getConf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token comment&quot;&gt;// setup the local minimas  &lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getPeerName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;master&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
   &lt;span class=&quot;token comment&quot;&gt;// init the minimum map  &lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Entry&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; row &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; adjacencyList&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;entrySet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; localAdjacentMinimum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; row&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; adjacent &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; row&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
     &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;adjacent &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; localAdjacentMinimum&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
      localAdjacentMinimum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; adjacent&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    minimalMap&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;row&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; localAdjacentMinimum&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
   &lt;span class=&quot;token comment&quot;&gt;// save our minimal map to HDFS so that every task can read this  &lt;/span&gt;
   &lt;span class=&quot;token function&quot;&gt;saveMinimalMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see, we are getting from our configuration which groom is currently the master server, aftwards we are initializing the FileSystem and map our adjacency list file into RAM. After that follows code that is only executed by the master.&lt;br&gt;
It simply loops through the list and setups the currently minimum adjacent vertex.&lt;br&gt;
Only the master has write access to the minimalmap file and updates it after each iteration.&lt;br&gt;
That’s it. Let’s step to the main loop.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// real start  &lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; updated &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; iteration &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;updated&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
   &lt;span class=&quot;token comment&quot;&gt;// sync so we can receive the new active messages  &lt;/span&gt;
   peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; activeQueue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LinkedList&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getNumCurrentMessages&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;IntegerMessage&lt;/span&gt; message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IntegerMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; peer  
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCurrentMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getTag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;size&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
     &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;BSPMessage&lt;/span&gt; msg &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msg &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCurrentMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
     message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IntegerMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; msg&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
     activeQueue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
   &lt;span class=&quot;token comment&quot;&gt;// apply updates on the minimal map  &lt;/span&gt;
   &lt;span class=&quot;token function&quot;&gt;applyMinimalMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;First off we are syncing in this loop, in the first iteration it is obvious that nobody would receive a message, but you can also use the sync to keep the grooms at the same line of code. Maybe you already seen this: a server is ahead in computation and the master hadn’t finished writing the map into the HDFS. This groom is no longer consistent to the rest of the cluster.&lt;br&gt;
So we are going to prevent this using sync, in the following iterations this is used to receive the active vertices.&lt;br&gt;
If the list of active vertices is empty we are going to break this while loop- the algorithm is done. Otherwise we are updating the activeQueue with the vertex ids we got. Then we are applying the changes the master could have done to the minimal map (method applyMinimalMap()).&lt;/p&gt;
&lt;p&gt;Let’s advance to the main algorithm.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// main algorithm  &lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;iteration &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Entry&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; row &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; adjacencyList  
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;entrySet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; min &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; minimalMap&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;row&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; adjacent &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; row&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;master&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FullIntegerMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;adjacent&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; min&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; active &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; activeQueue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; min &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; minimalMap&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;active&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; l &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; adjacencyList&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;active&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;l &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; min&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;master&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FullIntegerMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;l&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; min&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  

  peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I guess this is pretty good described in the listing, if we are in the first iteration we are going to send messages to every adjacent of a vertex in the adjacency list. In the following iterations we are just going to loop over the active vertices and sending messages of the new minimum to every adjacent except for the vertex itself.&lt;br&gt;
&gt; Sync step for sending and receiving messages&lt;br&gt;
Don’t worry, now comes the last part ;)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// only the master keeps track of the minimal  &lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getPeerName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;master&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;FullIntegerMessage&lt;/span&gt; msg &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; activeList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LinkedList&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msg &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;FullIntegerMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCurrentMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;minimalMap&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getTag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; msg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      minimalMap&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getTag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; msg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token comment&quot;&gt;// flag as active  &lt;/span&gt;
      activeList&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getTag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// save to hdfs for next iteration  &lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;saveMinimalMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// send messages to all peers containing the size of the  &lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// activelist and the content  &lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; peerName &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAllPeerNames&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
      peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;peerName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IntegerMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;size&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; activeList&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; active &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; activeList&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
      peer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;peerName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IntegerMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; active&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;// increment the iteration  &lt;/span&gt;
    iteration&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This part is only executed by a master groom. We receiving every message and updating the minimalmap. If we updated a vertex we are going to put them into the list of active vertices. Afterwards we are saving our minimal map so the grooms have a fresh state of minimum in their RAM.&lt;br&gt;
Then we are going to send the size of this list along with it’s content. This is necessary for the breaking condition. And don’t forget to increment the iteration variable.&lt;/p&gt;
&lt;p&gt;That’s it. It is the same algorithm we used in MapReduce- translated to BSP.&lt;br&gt;
Wasn’t that difficult, was it?&lt;/p&gt;
&lt;p&gt;If you want to take a close look at how this works, I already posted the project site of my GSoC project above. Feel free to check it out and play a little. The class we were talking about can be found here: de.jungblut.hama.graph.BSPGraphExploration&lt;br&gt;
It comes along with the latest Hama build out of the trunk, it also has a local bsp runner that will multithread grooms on your local machine. Just run the main method as a java application and you’ll see. So be aware when you are running this on your Hama Cluster, there could be some problems with the compatibilty to version 0.2.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Controlling Hadoop MapReduce Job recursion]]></title><description><![CDATA[This post is related to the previous post. Sometimes you coming along problems that need to be solved in a recursive manner. For example the…]]></description><link>https://blog.thomasjungblut.com/blogger/controlling-hadoop-job-recursion/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/controlling-hadoop-job-recursion/</guid><pubDate>Sat, 09 Apr 2011 07:58:00 GMT</pubDate><content:encoded>&lt;p&gt;This post is related to the &lt;a href=&quot;http://codingwiththomas.blogspot.com/2011/04/graph-exploration-with-hadoop-mapreduce.html&quot;&gt;previous post&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Sometimes you coming along problems that need to be solved in a recursive manner. For example the graph exploration algorithm in my previous post.&lt;br&gt;
You have to chain the jobs and let the next job work on the output of the previous job. And of course you need a breaking condition. This could either be a fixed limit of “how many recursions it should do” or “how many recursion it really does”.&lt;br&gt;
Let me focus at the second breaking condition along with my graph exploration example.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Counter&lt;/strong&gt;&lt;br&gt;
First off you should know that in Hadoop you have counters, you may see them after a job ran or in the Webinterface of the Jobtracker. “Famous” counters are the “Map input records” or the “Reduce output records”.&lt;br&gt;
The best of all is that we can setup our own counters, just with the use of enums.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;How to setup Counter?&lt;/strong&gt;&lt;br&gt;
The simplest approach is to just define an enum like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UpdateCounter&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  &lt;span class=&quot;token constant&quot;&gt;UPDATED&lt;/span&gt;  
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now you can manipulate the counter using:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;UpdateCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;UPDATED&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;“context” is the context object you get from your mapper or your reducer.&lt;br&gt;
This line will obviously increment your update counter by 1.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;How to fetch the counter?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;This is as easy as setting up an enum. You are submitting a job like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Configuration&lt;/span&gt; conf &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Configuration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token class-name&quot;&gt;Job&lt;/span&gt; job &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Job&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;conf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setJobName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Graph explorer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setMapperClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;DatasetImporter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setReducerClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ExplorationReducer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token comment&quot;&gt;// leave out the stuff with paths etc.  &lt;/span&gt;
job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;waitForCompletion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Be sure that the job has finished, using waitForCompletion is recommended. Querying the counter during runtime can end in strange results ;)&lt;br&gt;
You can access your counter like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; counter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCounters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ExplorationReducer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;UpdateCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;UPDATED&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;How to get the recursion running?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Now we know how to get the counter. Now setting up a recursion is quite simple. The only thing that you should watch for is already existing paths from older job runs.&lt;br&gt;
Look at this snippet:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// variable to keep track of the recursion depth  &lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; depth &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token comment&quot;&gt;// counter from the previous running import job  &lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; counter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCounters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ExplorationReducer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;UpdateCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;UPDATED&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
  depth&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;counter &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
   &lt;span class=&quot;token comment&quot;&gt;// reuse the conf reference with a fresh object  &lt;/span&gt;
   conf &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Configuration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   &lt;span class=&quot;token comment&quot;&gt;// set the depth into the configuration  &lt;/span&gt;
   conf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;recursion.depth&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; depth &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   job &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Job&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;conf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setJobName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Graph explorer &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; depth&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
   job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setMapperClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ExplorationMapper&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setReducerClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ExplorationReducer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setJarByClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ExplorationMapper&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   &lt;span class=&quot;token comment&quot;&gt;// always work on the path of the previous depth  &lt;/span&gt;
   in &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;files/graph-exploration/depth\_&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;depth &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   out &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;files/graph-exploration/depth\_&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; depth&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
   &lt;span class=&quot;token class-name&quot;&gt;SequenceFileInputFormat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addInputPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;job&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; in&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   &lt;span class=&quot;token comment&quot;&gt;// delete the outputpath if already exists  &lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exists&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
    fs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
   &lt;span class=&quot;token class-name&quot;&gt;SequenceFileOutputFormat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setOutputPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;job&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; out&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setInputFormatClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SequenceFileInputFormat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setOutputFormatClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SequenceFileOutputFormat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setOutputKeyClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LongWritable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setOutputValueClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;VertexWritable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   &lt;span class=&quot;token comment&quot;&gt;// wait for completion and update the counter  &lt;/span&gt;
   job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;waitForCompletion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   depth&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
   counter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCounters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ExplorationReducer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;UpdateCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;UPDATED&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
     &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that if you never incremented your counter it will be always 0. Or it could be null of you never used it in your mapper or reducer.&lt;/p&gt;
&lt;p&gt;Full sourcecodes can always be found here:&lt;br&gt;
&lt;a href=&quot;http://code.google.com/p/hama-shortest-paths&quot;&gt;http://code.google.com/p/hama-shortest-paths/&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Graph Exploration with Apache Hadoop and MapReduce]]></title><description><![CDATA[Hi all, sometimes you will have data where you don’t know how elements of these data are connected. This is a common usecase for graphs…]]></description><link>https://blog.thomasjungblut.com/blogger/graph-exploration-with-hadoop-mapreduce/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/graph-exploration-with-hadoop-mapreduce/</guid><pubDate>Fri, 08 Apr 2011 17:58:00 GMT</pubDate><content:encoded>&lt;p&gt;Hi all,&lt;br&gt;
sometimes you will have data where you don’t know how elements of these data are connected. This is a common usecase for graphs, this is because they are really abstract.&lt;br&gt;
So if you don’t know how your data is looking like, or if you know how it looks like and you just want to determine various graph components, this post is a good chance for you to get the “MapReduce-way” of graph exploration. As already mentioned in my previous post, I ranted about message passing through DFS and how much overhead it is in comparison to BSP.&lt;br&gt;
Just let this be a competition of Apache Hama BSP and Apache Hadoop MapReduce. Both sharing the HDFS as a distributed FileSystem.&lt;br&gt;
Looking at the title you know that this post is about the MapReduce implementation, I write a BSP implementation later and compare this with this MapReduce implementation.&lt;br&gt;
Let’s introduce the prequisites now.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Prequisites&lt;/strong&gt;&lt;br&gt;
We have a graph in a format of an adjacency list looking like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;0  
1    4    7  
2    3    8  
3    5  
4    1  
5    6  
6  
7      
8    3  
9    0  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So the first entry on the left side is always the vertex, therefore all vertices are listed on the leftmost side. Each vertex is described by a number: its id.&lt;br&gt;
Separated by tabs are the vertex ids that are adjacent to the vertex on the leftmost side.&lt;/p&gt;
&lt;p&gt;This is quite abstract so let’s take a look at this pretty picture:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://4.bp.blogspot.com/-Dtk6PB2ynwo/TZ9ESh9LN7I/AAAAAAAAAQM/BSBA0DDUCBs/s1600/Unbenannt.PNG&quot;&gt;&lt;img src=&quot;http://4.bp.blogspot.com/-Dtk6PB2ynwo/TZ9ESh9LN7I/AAAAAAAAAQM/BSBA0DDUCBs/s320/Unbenannt.PNG&quot; alt=&quot;graph with multiple components&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;This is how this graph looks like. As you can see there are three components: [1,4,7];[2,3,5,6,8];[0,9].&lt;br&gt;
In some datasets you want to classify each component to a common key that is unique. In this case it is the most common solution to just let a component be classified by its lowest id. E.G the component [1,4,7] has the lowest id 1. It is the classifier for this component.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;How do we deal with this in MapReduce?&lt;/strong&gt;&lt;br&gt;
First of all I recommend you to read into this &lt;a href=&quot;http://www.umiacs.umd.edu/%7Ejimmylin/publications/Lin_Schatz_MLG2010.pdf&quot;&gt;paper&lt;/a&gt;. It describes a technique named “message passing”.&lt;br&gt;
Simple: The idea behind this is, that you let the vertices pass messages if a new local minima has been found. Afterwards you are just merging the messages with the real vertices and apply updates on the vertices that had a higher minimum.&lt;/p&gt;
&lt;p&gt;So our first task is to write the value class that is representing a vertex AND a message at the same time.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;VertexWritable&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Writable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Cloneable&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
 &lt;span class=&quot;token class-name&quot;&gt;LongWritable&lt;/span&gt; minimalVertexId&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
 &lt;span class=&quot;token class-name&quot;&gt;TreeSet&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LongWritable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; pointsTo&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
 &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; activated&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
          
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;isMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pointsTo &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
   &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;  
   &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And the typical read/write stuff coming with Writable.&lt;br&gt;
So let me explain to you, we have this class representing the Vertex: it has a pointsTo tree that will maintain the adjacent vertex ids and the currently minimalVertexId. And there is also a boolean field that is called “activated”.&lt;br&gt;
There is also a method that determines whether this is representing a message or a vertex.&lt;/p&gt;
&lt;p&gt;The whole thing is just working like this:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Import the vertices from the adjacency list to the ID mapped to Vertex form.&lt;/li&gt;
&lt;li&gt;In the first iteration flag every vertex as activated and write it again.&lt;/li&gt;
&lt;li&gt;If a vertex is activated, loop through the pointsTo tree and write a message with the (for this vertex) minimal vertex to every element of the tree.&lt;/li&gt;
&lt;li&gt;Merge messages with the related vertex and if we found a new minimum activate the vertex. If nothing was updated then deactivate it.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;And then repeat from point 3 until no vertex can be updated anymore.&lt;br&gt;
Part 1 and 3 are inside the Map Task, part 2 and 4 are reduce tasks.&lt;br&gt;
&lt;a href=&quot;http://codingwiththomas.blogspot.com/2011/04/controlling-hadoop-job-recursion.html&quot;&gt;Look here how you can implement a job recursion using Apache Hadoop.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;So after all iteration is done you’ll have the following output:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt; 0 | VertexWritable \[minimalVertexId=0, pointsTo=\[0\]\]  
 1 | VertexWritable \[minimalVertexId=1, pointsTo=\[1, 4, 7\]\]  
 2 | VertexWritable \[minimalVertexId=2, pointsTo=\[2, 3, 8\]\]  
 3 | VertexWritable \[minimalVertexId=2, pointsTo=\[3, 5\]\]  
 4 | VertexWritable \[minimalVertexId=1, pointsTo=\[1, 4\]\]  
 5 | VertexWritable \[minimalVertexId=2, pointsTo=\[5, 6\]\]  
 6 | VertexWritable \[minimalVertexId=2, pointsTo=\[6\]\]  
 7 | VertexWritable \[minimalVertexId=1, pointsTo=\[7\]\]  
 8 | VertexWritable \[minimalVertexId=2, pointsTo=\[3, 8\]\]  
 9 | VertexWritable \[minimalVertexId=0, pointsTo=\[0, 9\]\]  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So you see that we always have every vertex on the left side, but now the minimalVertexId is the classifier for the component. And we have the three lowest component identifiers found: 0,1 and 2!&lt;/p&gt;
&lt;p&gt;So this looks like that now:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://4.bp.blogspot.com/-ceRwD7v693Q/TZ9LR45uwPI/AAAAAAAAAQQ/mzk6osE6Xak/s1600/Unbenannt_end.png&quot;&gt;&lt;img src=&quot;http://4.bp.blogspot.com/-ceRwD7v693Q/TZ9LR45uwPI/AAAAAAAAAQQ/mzk6osE6Xak/s320/Unbenannt_end.png&quot; alt=&quot;classified graph with multiple components&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;If you are now interested in getting all vertices to a component identifier you’ll be able to write a new mapper that will extract the minimalVertexId as a key and the pointsTo elements as a value. So that in the reduce step they’ll be merged together and you can persist your data.&lt;/p&gt;
&lt;p&gt;And if you are interested in more source code you are free to look into my Summer of Code project under: &lt;a href=&quot;http://code.google.com/p/hama-shortest-paths/&quot;&gt;http://code.google.com/p/hama-shortest-paths/&lt;/a&gt;&lt;br&gt;
You’ll find a working algorithm inside of the package called “de.jungblut.mapreduce.graph”. The main function to call is inside the class “DatasetImporter.java”.&lt;br&gt;
The example input used in this post is also in the trunk. So check this out and you are welcome to use it for your own problems ;)&lt;/p&gt;
&lt;p&gt;So the next time I write a BSP that will do the same.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Back to Blogsphere and how BSP works]]></title><description><![CDATA[Hey guys, I’m back! For those of you that do not remember me: I did some cool Robots for Google Wave. Maybe you remember the times where no…]]></description><link>https://blog.thomasjungblut.com/blogger/back-to-blogsphere/</link><guid isPermaLink="false">https://blog.thomasjungblut.com/blogger/back-to-blogsphere/</guid><pubDate>Thu, 07 Apr 2011 22:41:00 GMT</pubDate><content:encoded>&lt;p&gt;Hey guys,&lt;/p&gt;
&lt;p&gt;I’m back! For those of you that do not remember me: I did some cool &lt;a href=&quot;http://botsbytj.blogspot.com/&quot;&gt;Robots for Google Wave&lt;/a&gt;.&lt;br&gt;
Maybe you remember the times where no export function was in Google Wave, I targeted it with my bot called “PorteXy”. It was a Java portation of the existing Google example called &lt;a href=&quot;http://wave-samples-gallery.appspot.com/about_app?app_id=75018&quot;&gt;“Exporty”&lt;/a&gt;. From the count in the AppEngine database table I know a lot of you used it and I wanted to thank you all for your support!&lt;br&gt;
Now we all now that Google Wave passed by and gets an Apache Incubator project, I have to focus on other themes that could potentially be interesting for you. Since the last time, a lot has happened.&lt;br&gt;
I am no pupil anymore, I started working at &lt;a href=&quot;http://testberichte.de/&quot;&gt;testberichte.de&lt;/a&gt;, recently got my &lt;a href=&quot;http://education.oracle.com/pls/web_prod-plq-dad/db_pages.getpage?page_id=41&amp;#x26;p_exam_id=1Z0_851&quot;&gt;OCP&lt;/a&gt; in Java and in the mean time I am studying &lt;a href=&quot;http://www.hwr-berlin.de/en/department-of-cooperative-studies/study-programmes/computer-science/&quot;&gt;Computer Sciences at HWR Berlin&lt;/a&gt;.&lt;br&gt;
You must be thinking: “Oh he must be really busy” - in fact I am not. School kinda sucks, because it is too boring and I have to do something useful. So you’ve probably heard that Google is offering a new Summer of Code this year: &lt;a href=&quot;http://www.google-melange.com/gsoc/homepage/google/gsoc2011&quot;&gt;GSoC2011.&lt;/a&gt; And I decided to apply to it, my first thought was that I am going to apply for the Apache Software Foundation.&lt;br&gt;
Mainly because I worked a lot with &lt;a href=&quot;http://hadoop.apache.org/&quot;&gt;Hadoop&lt;/a&gt; and Distributed Systems in general and loved to use the Apache2 server running my PHP applications or my Tomcat running my Java applications. But Hadoop wasn’t a project eligible for GSoC (Why? I know it has a really large codebase, but there are so many cool task that can be done by students too!), so I had to look for another project. Then I’ve seen Mahout, I used Mahout for k-means clustering recently and looked at the task offering: &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-621&quot;&gt;Support more data import mechanisms&lt;/a&gt;. Are they serious? Just importing raw data into SequenceFiles? Seriously, you can’t use 12(!) weeks for that task coding 40h/week. This would be a task for a weekend, if at all. So I was looking for something more cool and complex, but this should be in Java and somehow related to distributed systems.&lt;/p&gt;
&lt;p&gt;So I came across &lt;a href=&quot;http://incubator.apache.org/hama/&quot;&gt;Apache Hama&lt;/a&gt; and this task is smiling at me: &lt;a href=&quot;https://issues.apache.org/jira/browse/HAMA-359&quot;&gt;Development of Shortest Path Finding Algorithm&lt;/a&gt;. This was the task I’ve searched for, I love distributed Computing and I love Graphs.&lt;br&gt;
You probably know that Hama uses &lt;a href=&quot;http://en.wikipedia.org/wiki/Bulk_synchronous_parallel&quot;&gt;BSP (Bulk synchronous parallel)&lt;/a&gt; for its computing.&lt;br&gt;
This is actually an abstraction to MapReduce. Have a look at this picture on wikipedia:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://upload.wikimedia.org/wikipedia/commons/thumb/e/ee/Bsp.wiki.fig1.svg/1024px-Bsp.wiki.fig1.svg.png&quot;&gt;&lt;img src=&quot;https://upload.wikimedia.org/wikipedia/commons/thumb/e/ee/Bsp.wiki.fig1.svg/1024px-Bsp.wiki.fig1.svg.png&quot; alt=&quot;BSP&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;If you translate MapReduce into BSP, then your map-phase will be the local computation-phase. After that you are going to merge the map output and sort it. That would be the communication phase. Now comes the Barrier Synchronisation: You know that no reducer can run if not all map task completed. So this step is a bit merged with the communication phase, but after that it is entering a new local computation phase: the reduce-phase.&lt;br&gt;
So you see, BSP is not the same like MapReduce, but you can actually describe MapReduce with BSP.&lt;/p&gt;
&lt;p&gt;What is the advantage of using BSP instead of MapReduce in Graph Processing:&lt;br&gt;
Those of you who implemented graph algorithms with MapReduce probably know what a pain it is to pass messages through HDFS and process them in several chained jobs. I believe it was this paper here, what described very well how this works: &lt;a href=&quot;http://www.umiacs.umd.edu/%7Ejimmylin/publications/Lin_Schatz_MLG2010.pdf&quot;&gt;http://www.umiacs.umd.edu/~jimmylin/publications/Lin_Schatz_MLG2010.pdf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Even if you don’t know it how to implement them (maybe I’ll go for a tutorial later on) believe me: this is not optimal!&lt;br&gt;
Why should we pass messages through DFS? Well, just communicate the messages!&lt;br&gt;
And that is the real advantage of BSP, you having less sync (in MapReduce you have 3 major sync steps in a job: the beginning, the reducer and the end. The end, because you can’t run a follow-up job before the last one finishes, and therefore the beginning too) and a more “real-time” messaging than MapReduce.&lt;/p&gt;
&lt;p&gt;BSP is actually used at Google too: &lt;a href=&quot;http://googleresearch.blogspot.com/2009/06/large-scale-graph-computing-at-google.html&quot;&gt;http://googleresearch.blogspot.com/2009/06/large-scale-graph-computing-at-google.html&lt;/a&gt;, you can google for the Pregel paper for further reading.&lt;/p&gt;
&lt;p&gt;In my opinion Apache Hama has a great perspective, because there is no other OpenSource alternative for BSP processing and the best thing of all: I’ll be part of it.&lt;/p&gt;
&lt;p&gt;Back to the shortest path finding. As you can see, I already started to implement a basic Dijkstra and made some thoughts on how this is going to work within a large cluster, mainly in terms of scalability.&lt;br&gt;
If you are interested in shortest paths in large graphs you should definitely bookmark this issue or at least vote it up.&lt;/p&gt;
&lt;p&gt;The application deadline of GSoC is in approx. 10 hours and I hope ASF will pick me :-)&lt;/p&gt;
&lt;p&gt;This was a really large first posting and I want to thank especially &lt;strong&gt;Edward J. Yoon&lt;/strong&gt;, he is my mentor at Apache Hama and told me that I should blog again. This is part of his “young open source stars”-support ;) Visit his &lt;a href=&quot;http://blog.udanax.org/&quot;&gt;blog&lt;/a&gt; or follow him on &lt;a href=&quot;http://twitter.com/#%21/eddieyoon&quot;&gt;twitter&lt;/a&gt;, he is a real genius!&lt;/p&gt;
&lt;p&gt;Obviously you can also follow me on twitter, look at the sidebar on the right side.&lt;/p&gt;
&lt;p&gt;Greetings from Germany!&lt;/p&gt;</content:encoded></item></channel></rss>