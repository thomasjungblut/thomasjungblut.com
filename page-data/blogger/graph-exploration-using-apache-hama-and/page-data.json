{"componentChunkName":"component---src-templates-blog-post-js","path":"/blogger/graph-exploration-using-apache-hama-and/","result":{"data":{"site":{"siteMetadata":{"title":"Coding with Thomas"}},"markdownRemark":{"id":"e67a8629-bf17-5eeb-b54e-1775d53761e2","excerpt":"Hey guys, I’ve been busy for a tiny bit of time, but I finished the graph exploration algorithm with Apache Hama recently. This post is about the BSP portation…","html":"<p>Hey guys,<br>\nI’ve been busy for a tiny bit of time, but I finished the graph exploration algorithm with <a href=\"http://incubator.apache.org/hama/\">Apache Hama</a> recently. This post is about the BSP portation of <a href=\"http://codingwiththomas.blogspot.com/2011/04/graph-exploration-with-hadoop-mapreduce.html\">this post</a>.<br>\nSo I already told in <a href=\"http://codingwiththomas.blogspot.com/2011/04/back-to-blogsphere.html\">this post</a> how BSP basically works. Now I’m going to tell you what you can do with it in terms of graph exploration. Last post I did this with MapReduce, so let’s go and get into Hama!</p>\n<p><strong>As of today</strong> this is merely outdated, since Hama 0.5.0, you can use the Pregel-like Graph API and run the connected components example shipped. This will do everything this code below did a year ago.<br>\nI just keep that as a part of history, some of the statements still hold true, some parts needs to be updated though.</p>\n<p><strong>BSP Class</strong><br>\nLike coding a mapper you’ll need to inherit from a baseclass. In Hama this is the BSP class, it is abstract and implements a interface called BSPInterface. BSPInterface has a method that you are going to implement for yourself:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">bsp</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BSPPeerProtocol</span> bspPeer<span class=\"token punctuation\">)</span>  </code></pre></div>\n<p><strong>What is BSPPeerProtocol and how is it getting executed?</strong><br>\nThe BSPPeerProtocol is nothing else than a reference to your local running Groom server. A Groom is similar to Hadoop’s tasktracker. This is also a hint on how your own BSP get’s executed. Hama will launch several tasks inside a Groom and create a new instance of your BSP class per task.</p>\n<p><strong>Syncing</strong><br>\nIn BSP it is necessary to synchronize the Grooms’ in order to introduce the messaging phase described <a href=\"http://codingwiththomas.blogspot.com/2011/04/back-to-blogsphere.html\">here</a>. You can simply call the sync() method from your BSPPeerProtocol reference.</p>\n<p><strong>Letting code be executed on only one Server / Groom / Task</strong><br>\nThis is actually pretty easy, you could take a look at the <a href=\"http://wiki.apache.org/hama/PiEstimator\">PiEstimator example.</a></p>\n<p>Okay I guess this is enough, let’s step into the code. The thoughts are the same like in the MapReduce example:</p>\n<ol>\n<li>Initialize the datasets, we have several maps’ storing active vertices, the adjacency list and a map which holds the minimal vertices for each vertex.</li>\n<li>In the first iteration, send a message for each adjacent of a vertex containing the id of the adjacent vertex and it’s currently minimal vertex to a master task. If we are not in the first iteration we are going to loop through the active vertices and their adjacent vertices, broadcasting to every adjacent vertex what the new minimal id is.</li>\n<li>Sync so that every task receives the messages.</li>\n<li>A master task is fetching the results and updating the minimal vertex ids. If a vertex has been updated, we put its id into the “activeVertexMap”. Sending the active vertices to all existing peers.</li>\n<li>Sync again: if we received nothing, just break the main loop resulting in exiting the bsp. If we receive new active vertices, increment the iteration and continue with point 2. </li>\n</ol>\n<p><strong>Input / Output System</strong><br>\nMaybe you know that Hama has currently no real Input and Output system. So you have to take care for yourself: Manage the data the grooms need for their computation, partitioning and updating.<br>\nI hope hat <a href=\"https://issues.apache.org/jira/browse/HAMA-258\">this issue</a> will be resolved soon, so that this whole management will be inside Hama and is not blowing up your BSP class.<br>\nFor this example we need two major files: The actual adjacency list and the map that keeps track of the current minimas. If you are a wondering why, the last time we saved this up into a vertex itself. This is true, but I don’t want to add another model for a vertex. This is just a personal reason, so feel free to fork and build your own ;)<br>\nBoth files are in HDFS, a far more scalable solution would be to store these into a HBase table. But since Hama doesn’t require HBase anymore, I’ll go for a FileSystem-way of storing data.</p>\n<p><strong>Source Code</strong><br>\nIf you want to see the full implementation, check it out at <a href=\"http://code.google.com/p/hama-shortest-paths/\">http://code.google.com/p/hama-shortest-paths/</a></p>\n<p>Let’s start with the initialization phase in the bsp method:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">String</span> master <span class=\"token operator\">=</span> conf<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MASTER</span>\\_TASK<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  fs <span class=\"token operator\">=</span> <span class=\"token class-name\">FileSystem</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token function\">getConf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n  <span class=\"token comment\">// setup the datasets  </span>\n  adjacencyList <span class=\"token operator\">=</span> <span class=\"token function\">mapAdjacencyList</span><span class=\"token punctuation\">(</span><span class=\"token function\">getConf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  <span class=\"token comment\">// setup the local minimas  </span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>peer<span class=\"token punctuation\">.</span><span class=\"token function\">getPeerName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>master<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n   <span class=\"token comment\">// init the minimum map  </span>\n   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> row <span class=\"token operator\">:</span> adjacencyList<span class=\"token punctuation\">.</span><span class=\"token function\">entrySet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token keyword\">int</span> localAdjacentMinimum <span class=\"token operator\">=</span> row<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> adjacent <span class=\"token operator\">:</span> row<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n     <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>adjacent <span class=\"token operator\">&lt;</span> localAdjacentMinimum<span class=\"token punctuation\">)</span>  \n      localAdjacentMinimum <span class=\"token operator\">=</span> adjacent<span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n    minimalMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span><span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> localAdjacentMinimum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n   <span class=\"token punctuation\">}</span>  \n   <span class=\"token comment\">// save our minimal map to HDFS so that every task can read this  </span>\n   <span class=\"token function\">saveMinimalMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  <span class=\"token punctuation\">}</span>  </code></pre></div>\n<p>As you can see, we are getting from our configuration which groom is currently the master server, aftwards we are initializing the FileSystem and map our adjacency list file into RAM. After that follows code that is only executed by the master.<br>\nIt simply loops through the list and setups the currently minimum adjacent vertex.<br>\nOnly the master has write access to the minimalmap file and updates it after each iteration.<br>\nThat’s it. Let’s step to the main loop.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// real start  </span>\n  <span class=\"token keyword\">boolean</span> updated <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>  \n  <span class=\"token keyword\">int</span> iteration <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>  \n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>updated<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n   <span class=\"token comment\">// sync so we can receive the new active messages  </span>\n   peer<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n   <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> activeQueue <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>peer<span class=\"token punctuation\">.</span><span class=\"token function\">getNumCurrentMessages</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token class-name\">IntegerMessage</span> message <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IntegerMessage</span><span class=\"token punctuation\">)</span> peer  \n      <span class=\"token punctuation\">.</span><span class=\"token function\">getCurrentMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"size\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>  \n     <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token class-name\">BSPMessage</span> msg <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>msg <span class=\"token operator\">=</span> peer<span class=\"token punctuation\">.</span><span class=\"token function\">getCurrentMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n     message <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IntegerMessage</span><span class=\"token punctuation\">)</span> msg<span class=\"token punctuation\">;</span>  \n     activeQueue<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n   <span class=\"token punctuation\">}</span>  \n   <span class=\"token comment\">// apply updates on the minimal map  </span>\n   <span class=\"token function\">applyMinimalMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>  </code></pre></div>\n<p>First off we are syncing in this loop, in the first iteration it is obvious that nobody would receive a message, but you can also use the sync to keep the grooms at the same line of code. Maybe you already seen this: a server is ahead in computation and the master hadn’t finished writing the map into the HDFS. This groom is no longer consistent to the rest of the cluster.<br>\nSo we are going to prevent this using sync, in the following iterations this is used to receive the active vertices.<br>\nIf the list of active vertices is empty we are going to break this while loop- the algorithm is done. Otherwise we are updating the activeQueue with the vertex ids we got. Then we are applying the changes the master could have done to the minimal map (method applyMinimalMap()).</p>\n<p>Let’s advance to the main algorithm.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// main algorithm  </span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>iteration <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> row <span class=\"token operator\">:</span> adjacencyList  \n      <span class=\"token punctuation\">.</span><span class=\"token function\">entrySet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n      <span class=\"token keyword\">int</span> min <span class=\"token operator\">=</span> minimalMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span><span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> adjacent <span class=\"token operator\">:</span> row<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        peer<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>master<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FullIntegerMessage</span><span class=\"token punctuation\">(</span>adjacent<span class=\"token punctuation\">,</span> min<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n      <span class=\"token punctuation\">}</span>  \n    <span class=\"token punctuation\">}</span>  \n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> active <span class=\"token operator\">:</span> activeQueue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n      <span class=\"token keyword\">int</span> min <span class=\"token operator\">=</span> minimalMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>active<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> l <span class=\"token operator\">:</span> adjacencyList<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>active<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>l <span class=\"token operator\">!=</span> min<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n          peer<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>master<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FullIntegerMessage</span><span class=\"token punctuation\">(</span>l<span class=\"token punctuation\">,</span> min<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span>  \n      <span class=\"token punctuation\">}</span>  \n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>  \n\n  peer<span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </code></pre></div>\n<p>I guess this is pretty good described in the listing, if we are in the first iteration we are going to send messages to every adjacent of a vertex in the adjacency list. In the following iterations we are just going to loop over the active vertices and sending messages of the new minimum to every adjacent except for the vertex itself.<br>\n> Sync step for sending and receiving messages<br>\nDon’t worry, now comes the last part ;)</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// only the master keeps track of the minimal  </span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>peer<span class=\"token punctuation\">.</span><span class=\"token function\">getPeerName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>master<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token class-name\">FullIntegerMessage</span> msg <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> activeList <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>msg <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">FullIntegerMessage</span><span class=\"token punctuation\">)</span> peer<span class=\"token punctuation\">.</span><span class=\"token function\">getCurrentMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>minimalMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">getTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> msg<span class=\"token punctuation\">.</span><span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n      minimalMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">getTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">.</span><span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n      <span class=\"token comment\">// flag as active  </span>\n      activeList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">getTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n      <span class=\"token punctuation\">}</span>  \n    <span class=\"token punctuation\">}</span>  \n    <span class=\"token comment\">// save to hdfs for next iteration  </span>\n    <span class=\"token function\">saveMinimalMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token comment\">// send messages to all peers containing the size of the  </span>\n    <span class=\"token comment\">// activelist and the content  </span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> peerName <span class=\"token operator\">:</span> peer<span class=\"token punctuation\">.</span><span class=\"token function\">getAllPeerNames</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n      peer<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>peerName<span class=\"token punctuation\">,</span>  \n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntegerMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"size\"</span><span class=\"token punctuation\">,</span> activeList<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> active <span class=\"token operator\">:</span> activeList<span class=\"token punctuation\">)</span>  \n      peer<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>peerName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntegerMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> active<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n    <span class=\"token comment\">// increment the iteration  </span>\n    iteration<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span>  \n</code></pre></div>\n<p>This part is only executed by a master groom. We receiving every message and updating the minimalmap. If we updated a vertex we are going to put them into the list of active vertices. Afterwards we are saving our minimal map so the grooms have a fresh state of minimum in their RAM.<br>\nThen we are going to send the size of this list along with it’s content. This is necessary for the breaking condition. And don’t forget to increment the iteration variable.</p>\n<p>That’s it. It is the same algorithm we used in MapReduce- translated to BSP.<br>\nWasn’t that difficult, was it?</p>\n<p>If you want to take a close look at how this works, I already posted the project site of my GSoC project above. Feel free to check it out and play a little. The class we were talking about can be found here: de.jungblut.hama.graph.BSPGraphExploration<br>\nIt comes along with the latest Hama build out of the trunk, it also has a local bsp runner that will multithread grooms on your local machine. Just run the main method as a java application and you’ll see. So be aware when you are running this on your Hama Cluster, there could be some problems with the compatibilty to version 0.2.</p>","frontmatter":{"title":"Graph Exploration with Apache Hama","date":"10th April 2011","description":null},"tableOfContents":"","timeToRead":6},"previous":{"fields":{"slug":"/blogger/controlling-hadoop-job-recursion/"},"frontmatter":{"title":"Controlling Hadoop MapReduce Job recursion"}},"next":{"fields":{"slug":"/blogger/apache-hama-partitioning/"},"frontmatter":{"title":"Apache Hama Partitioning"}}},"pageContext":{"id":"e67a8629-bf17-5eeb-b54e-1775d53761e2","previousPostId":"fef60276-987b-5ff2-bb6d-053747a34caf","nextPostId":"ccc3d38b-5ce4-5d38-afa8-67432bd75a51"}},"staticQueryHashes":["2270107033","2841359383"],"slicesMap":{}}