{"componentChunkName":"component---src-templates-blog-post-js","path":"/blogger/nonlinear-conjugate-gradient-method-in/","result":{"data":{"site":{"siteMetadata":{"title":"Coding with Thomas"}},"markdownRemark":{"id":"684f5398-15bf-5c0a-b0ff-c0e05a82e5a3","excerpt":"Hi all, I have been a bit busy for the last few weeks with some projects. But fortunately I found some time on the last weekend to implement a recommandation…","html":"<p>Hi all,</p>\n<p>I have been a bit busy for the last few weeks with some projects. But fortunately I found some time on the last weekend to implement a recommandation engine for myself based on what we have done in <a href=\"http://ml-class.org/\">ml-class.org</a> lessons in octave and translate it to a Java version.</p>\n<p>If you attended ml-class you might be familiar that you need to minimize a rather complex cost function based on what the user likes in terms of movies.<br>\nHowever I haven’t found a <strong>simple and not ancient</strong> Java library containing a fully working conjugate gradient method. Shorthand I decided to translate it from Octave to Java. It took me 5-6 hours to build a Octave-like vector library arround it to translate it quite 1:1. But it was really worth it.</p>\n<p>And here is the <a href=\"https://github.com/thomasjungblut/thomasjungblut-common/blob/master/src/main/java/de/jungblut/math/minimize/Fmincg.java\">Fmincg.java</a> code.</p>\n<p>Fmincg btw stands for <strong>F</strong>unction <strong>mi</strong>nimize <strong>n</strong>onlinear <strong>c</strong>onjugant <strong>g</strong>radient. It wasn’t clear for me in the first place and I really started to understand the algorithm when I translated it.</p>\n<p>It works quite like the version in octave, you pass an input vector (which is used as a starting point) and a costfunction along with a number of iterations to do.<br>\nSince I’m a hacker by heart, I want to give you a sample code to try it out for yourself.</p>\n<p><strong>Example</strong></p>\n<p>I have prepared a simple quadratic function for you<br>\nf(x) = (4-x)^2+10</p>\n<p>Obviously since this is quadratic this has a global minimum which is easy to spot because I used the binomial version of the function, we will see if fmincg finds it.</p>\n<p>For the algorithm we constantly need to calculate the gradients of the input in our cost function. Therefore we need the derivative which is for our function<br>\nf(x)’ = 2x-8</p>\n<p>If you’re a math crack then you know that the f(x) hits (int our case) the minimum where the derivative cut’s the x-axis or y=0.</p>\n<p>Since this is quite hard to visualize, I have made a picture for you:</p>\n<p><a href=\"http://3.bp.blogspot.com/-MG11lpkMb1E/T0wAmw7AGiI/AAAAAAAAAXg/6kn9lnY3I34/s1600/graph.png\"><img src=\"http://3.bp.blogspot.com/-MG11lpkMb1E/T0wAmw7AGiI/AAAAAAAAAXg/6kn9lnY3I34/s400/graph.png\" alt=\"\"></a></p>\n<p>Function f(x) and its derivative</p>\n<p>Not difficult to spot, you see the black function is our f(x) whereas the green line is our derivative. And it hits the x-axis right at the minimum of the function. Great!</p>\n<p><strong>How do we code this?</strong></p>\n<p>This is quite simple, I show you the code first:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">int</span> startPoint <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">5</span><span class=\"token punctuation\">;</span>  \n<span class=\"token comment\">// start at x=-5  </span>\n<span class=\"token class-name\">DenseDoubleVector</span> start <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DenseDoubleVector</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token keyword\">double</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span> startPoint <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n\n<span class=\"token class-name\">CostFunction</span> inlineFunction <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CostFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n  <span class=\"token annotation punctuation\">@Override</span>  \n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">Tuple</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Double</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">DenseDoubleVector</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">evaluateCost</span><span class=\"token punctuation\">(</span>  \n      <span class=\"token class-name\">DenseDoubleVector</span> input<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n      \n    <span class=\"token comment\">// our function is f(x) = (4-x)^2+10, so we can calculate the cost  </span>\n    <span class=\"token keyword\">double</span> cost <span class=\"token operator\">=</span> <span class=\"token class-name\">Math</span><span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token operator\">-</span>input<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token comment\">// the derivative is f(x)' = 2x-8 which is our gradient value  </span>\n    <span class=\"token class-name\">DenseDoubleVector</span> gradient <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DenseDoubleVector</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token keyword\">double</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span><span class=\"token number\">2</span>\\<span class=\"token operator\">*</span>input<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">8</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n      \n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Tuple</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Double</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">DenseDoubleVector</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>cost<span class=\"token punctuation\">,</span> gradient<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>  \n  \n<span class=\"token class-name\">DenseDoubleVector</span> minimizeFunction <span class=\"token operator\">=</span> <span class=\"token class-name\">Fmincg</span><span class=\"token punctuation\">.</span><span class=\"token function\">minimizeFunction</span><span class=\"token punctuation\">(</span>inlineFunction<span class=\"token punctuation\">,</span> start<span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token comment\">// should return 4  </span>\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Found a minimum at: \"</span> <span class=\"token operator\">+</span> minimizeFunction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </code></pre></div>\n<p>As you can see we have to allocate the vector which is containing our start “point”. You can set this arbitrary randomly, but you have know that it might not hit the global minimum but rather a local minimum. So different random starting points can yield to different results.</p>\n<p>But not in our case. Now you can implement the cost function the algorithm needs the cost of your function at the given point of the input and the value of the derivative at this point.<br>\nSo we return this after we put the input “x” in our two equations as a tuple.</p>\n<p>The whole application prints:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Interation 1 | Cost: 10,000000  \nInteration 2 | Cost: 10,000000  \n[4.0]  </code></pre></div>\n<p>Works! And it outputs the x-value of our minima and the cost is 10, which should be the y-value. Very cool!<br>\n<a href=\"https://github.com/thomasjungblut/thomasjungblut-common/blob/master/src/test/java/de/jungblut/math/minimize/FmincgTest.java\">You can find this example on Github as well as a unit test.</a></p>\n<p>Please use it if you need it, I have already implemented the collaborative filtering algorithm with it and I guess a backprop neural network will follow soon.</p>\n<p>I really have to admit that I am not a math crack although I am studying computer sciences, but math really makes many things easier and if you take a deeper look behind what you’ve learned in school, it is really beautiful.</p>\n<p>Thanks and bye!</p>","frontmatter":{"title":"Nonlinear conjugate gradient method in Java","date":"27th February 2012","description":null},"tableOfContents":"","timeToRead":3},"previous":{"fields":{"slug":"/blogger/german-stop-words/"},"frontmatter":{"title":"German Stop Words"}},"next":{"fields":{"slug":"/blogger/distributed-dbscan-intuition/"},"frontmatter":{"title":"Distributed DBSCAN (Intuition)"}}},"pageContext":{"id":"684f5398-15bf-5c0a-b0ff-c0e05a82e5a3","previousPostId":"c350d7cf-3060-57bc-8ebf-0c7d7ed4e393","nextPostId":"1ae9f529-012b-5af9-b7a8-fba48c95514a"}},"staticQueryHashes":["2270107033","2841359383"],"slicesMap":{}}